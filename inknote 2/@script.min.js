var __extends,FrontEnd,Menu,Modal,Actions,SynthBindings,MouseControl,Inknote;(function(n){function i(n,t){if(n.length===0)return!1;for(var i=0;i<n.length;i++)if(!t(n[i]))return!1;return!0}function r(n,t){if(n===null||n===undefined)return!1;for(var i=0;i<n.length;i++)if(t(n[i]))return!0;return!1}function u(n,t){var r,i;if(n===null||n===undefined)return 0;for(r=0,i=0;i<n.length;i++)t(n[i])&&r++;return r}function f(n,t){var i,r,u;if(n===null||n===undefined)return-Infinity;for(i=-Infinity,r=0;r<n.length;r++)u=t(n[r]),u>i&&(i=u);return i}function e(n,t){var i,r,u;if(n===null||n===undefined)return Infinity;for(i=Infinity,r=0;r<n.length;r++)u=t(n[r]),u<i&&(i=u);return i}function o(n,t){var u=-Infinity,f,i,r;if(n==null)return null;for(i=0;i<n.length;i++)r=t(n[i]),r>u&&(u=r,f=i);return n[f]}function s(n,t){var u=Infinity,f,i,r;if(n==null)return null;for(i=0;i<n.length;i++)r=t(n[i]),r<u&&(u=r,f=i);return n[f]}function h(n,t){if(n===null||n===undefined)return null;for(var i=0;i<n.length;i++)if(t(n[i]))return n[i]}function c(n,t){var r,i;if(n===null||n===undefined)return[];for(r=[],i=0;i<n.length;i++)t(n[i])&&r.push(n[i]);return r}function l(n,t){var r,i;if(n==null||n.length==0)return 0;for(r=0,i=0;i<n.length;i++)r+=t(n[i]);return r}function a(n){return n==null||n.length==0?null:n[n.length-1]}function t(n,i){if(!n||!i||n.length!=i.length)return!1;for(var r=0,u=n.length;r<u;r++)if(n[r]instanceof Array&&i[r]instanceof Array){if(!t(n[r],i[r]))return!1}else if(n[r]!=i[r])return!1;return!0}function v(n){for(var i=[],t=0;t<n.length;t++)i.push(n[t]);return i}n.allItemsAre=i;n.anyItemIs=r;n.countWhere=u;n.maxOutOf=f;n.minOutOf=e;n.getItemWithMax=o;n.getItemWithMin=s;n.getFirstItemWhere=h;n.getItemsWhere=c;n.sum=l;n.last=a;n.arraysAreEqual=t;n.copySimpleArrayFrom=v})(Inknote||(Inknote={})),function(n){function t(){return(new Date).getTime()+""+Math.floor(1e4*Math.random())}function i(n){for(var r="",i=n.split(""),t=0;t<i.length;t++)r+=t==0?i[t].toUpperCase():i[t].toLowerCase();return r}n.getID=t;n.pascalCase=i}(Inknote||(Inknote={})),function(n){function t(n,t,i,r,u,f){var o=t.length,s,e;for(n.beginPath(),n.textAlign="center",n.save(),n.translate(i,r),n.rotate(f/-2),n.rotate(f/o/-2),e=0;e<o;e++)n.rotate(f/o),n.save(),n.translate(0,-1*u),s=t[e],n.font="12px Arial",n.shadowColor="black",n.shadowOffsetX=1,n.shadowOffsetY=1,n.shadowBlur=1,n.fillText(s,0,0),n.restore();n.restore()}n.drawTextAlongArc=t}(Inknote||(Inknote={})),function(n){var t;(function(t){function i(n,t,i,r,u){var f=n-i,e=t-r,o=Math.sqrt(f*f+e*e);return o<=u}function r(t){var i=n.copySimpleArrayFrom(t),r=i.pop();return[r].concat(i)}function u(t,i){for(var e,f,u=n.copySimpleArrayFrom(t),o=n.copySimpleArrayFrom(u),h=t.length,s=0;s<h;s++){for(u=r(u),e=0,f=0;f<u.length;f++)e+=Math.abs(u[f]-i[f]);e<Infinity&&(o=n.copySimpleArrayFrom(u))}return o}function f(n,t){return Math.sqrt(n*n+t*t)}t.isWithinRadius=i;t.alignSimilarArrayTo=u;t.pythagoras=f})(t=n.Maths||(n.Maths={}))}(Inknote||(Inknote={})),function(n){var t;(function(n){var t=function(){function t(n,t){this.x=n;this.y=t}return Object.defineProperty(t.prototype,"abs",{get:function(){return n.pythagoras(this.x,this.y)},enumerable:!0,configurable:!0}),t}();n.Vector2=t})(t=n.Maths||(n.Maths={}))}(Inknote||(Inknote={})),function(n){var t=function(){function t(t){this.displayID=!1;this.staveColour="black";this.noteColour="red";this.textColour="green";this.serverURL="https://lit-basin-6551.herokuapp.com";this.ID=n.getID();this.name=t;this.testMode=!1;this.notationType=n.NotationType.Standard;t||(this.name=this.ID)}return t}();n.Setting=t}(Inknote||(Inknote={})),function(n){var t=function(){function n(){}return n}();n.DrawOptions=t}(Inknote||(Inknote={}));__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t;(function(t){var i=function(){function t(){this.ID=n.getID()}return t}(),r,u,f,e,o,s,h,c,l,a;t.Clef=i,function(n){n[n.GClef=0]="GClef";n[n.CClef=1]="CClef";n[n.FClef=2]="FClef"}(t.ClefType||(t.ClefType={}));r=t.ClefType;u=function(n){function t(){n.apply(this,arguments);this.clefType=r.GClef;this.positionFromTreble=2;this.drawLocation=8}return __extends(t,n),t}(i);t.FrenchViolinClef=u;f=function(n){function t(){n.apply(this,arguments);this.clefType=r.GClef;this.positionFromTreble=0;this.drawLocation=6}return __extends(t,n),t}(i);t.TrebleClef=f;e=function(n){function t(){n.apply(this,arguments);this.clefType=r.CClef;this.positionFromTreble=-2;this.drawLocation=8}return __extends(t,n),t}(i);t.SopranoClef=e;o=function(n){function t(){n.apply(this,arguments);this.clefType=r.CClef;this.positionFromTreble=-4;this.drawLocation=6}return __extends(t,n),t}(i);t.MezzoSopranoClef=o;s=function(n){function t(){n.apply(this,arguments);this.clefType=r.CClef;this.positionFromTreble=-6;this.drawLocation=4}return __extends(t,n),t}(i);t.AltoClef=s;h=function(n){function t(){n.apply(this,arguments);this.clefType=r.CClef;this.positionFromTreble=-8;this.drawLocation=2}return __extends(t,n),t}(i);t.TenorClef=h;c=function(n){function t(){n.apply(this,arguments);this.clefType=r.FClef;this.positionFromTreble=-10;this.drawLocation=4}return __extends(t,n),t}(i);t.BaritoneClef=c;l=function(n){function t(){n.apply(this,arguments);this.clefType=r.FClef;this.positionFromTreble=-12;this.drawLocation=2}return __extends(t,n),t}(i);t.BassClef=l;a=function(n){function t(){n.apply(this,arguments);this.clefType=r.FClef;this.positionFromTreble=-14;this.drawLocation=0}return __extends(t,n),t}(i);t.SubbassClef=a})(t=n.Model||(n.Model={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(){function t(t,i){if(this.top=t,this.bottom=i,this.ID=n.getID(),Math.round(t)!=t||Math.round(i)!=i||t==0||i==0)throw new Error("Time signatures can only take integers");}return t}();t.TimeSignature=i})(t=n.Model||(n.Model={}))}(Inknote||(Inknote={})),function(n){var t=function(){function t(t){this.order=50;this.attached=[];this.ID=n.getID();t&&(this.draw=t)}return Object.defineProperty(t.prototype,"ID",{get:function(){return this.attachedToID||this._id},set:function(n){this._id=n},enumerable:!0,configurable:!0}),t.prototype.attach=function(n){n.attachedToID=this.ID;this.attached.push(n)},t.prototype.draw=function(n){return n.beginPath(),n.arc(this.x,this.y,5,0,2*Math.PI),n.fill(),!1},t.prototype.isOver=function(t,i){for(var f=n.Maths.isWithinRadius(t,i,this.x,this.y,10),u=!1,r=0;r<this.attached.length;r++)this.attached[r].isOver(t,i)&&(u=!0);return f||u},t}();n.Notation=t}(Inknote||(Inknote={})),function(n){var t;(function(n){function r(n){switch(n){case t.A:return"A";case t.Bb:return"Bb";case t.B:return"B";case t.C:return"C";case t.Db:return"Db";case t.D:return"D";case t.Eb:return"Eb";case t.E:return"E";case t.F:return"F";case t.Gb:return"Gb";case t.G:return"G";case t.Ab:return"Ab"}}function i(n){switch(n){case t.A:case t.B:case t.C:case t.D:case t.E:case t.F:case t.G:return!1;case t.Ab:case t.Bb:case t.Db:case t.Eb:case t.Gb:return!0}}function u(n){return!i(n)}n.GetNoteNameFromNoteValue=r,function(n){n[n.A=0]="A";n[n.Bb=1]="Bb";n[n.B=2]="B";n[n.C=3]="C";n[n.Db=4]="Db";n[n.D=5]="D";n[n.Eb=6]="Eb";n[n.E=7]="E";n[n.F=8]="F";n[n.Gb=9]="Gb";n[n.G=10]="G";n[n.Ab=11]="Ab"}(n.NoteValue||(n.NoteValue={}));var t=n.NoteValue;n.IsBlackKey=i;n.IsWhiteKey=u})(t=n.Model||(n.Model={}))}(Inknote||(Inknote={})),function(n){var t;(function(n){(function(n){n[n.Breve=0]="Breve";n[n.SemiBreve=1]="SemiBreve";n[n.Minim=2]="Minim";n[n.Crotchet=3]="Crotchet";n[n.Quaver=4]="Quaver";n[n.SemiQuaver=5]="SemiQuaver";n[n.DemiSemiQuaver=6]="DemiSemiQuaver";n[n.HemiDemiSemiQuaver=7]="HemiDemiSemiQuaver"})(n.NoteLength||(n.NoteLength={}));var t=n.NoteLength})(t=n.Model||(n.Model={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(){function t(t){this.length=t;this.ID=n.getID()}return t}();t.Rest=i})(t=n.Model||(n.Model={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){(function(n){n[n.Sharp=0]="Sharp";n[n.Flat=1]="Flat";n[n.Natural=2]="Natural";n[n.DoubleSharp=3]="DoubleSharp";n[n.DoubleFlat=4]="DoubleFlat"})(t.AccidentalType||(t.AccidentalType={}));var r=t.AccidentalType,i=function(){function i(i,r,u){this.ID=n.getID();this.isPlaying=!1;this.value=i;this.octave=r;(u===null||u===undefined)&&(u=t.NoteLength.Crotchet);this.length=u}return i}();t.Note=i})(t=n.Model||(n.Model={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(){function t(t){this.ID=n.getID();this.notes=t}return t}();t.Chord=i})(t=n.Model||(n.Model={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(){function t(t){this.ID=n.getID();this.content=t}return t}();t.Text=i})(t=n.Model||(n.Model={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(){function t(){this.ID=n.getID();this.items=[]}return t}();t.Bar=i})(t=n.Model||(n.Model={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(){function t(t){this.name=t;this.ID=n.getID();this.bars=[];this.visible=!0}return t}();t.Instrument=i})(t=n.Model||(n.Model={}))}(Inknote||(Inknote={})),function(n){var t=function(){function t(t){this.colour="#FFFFFF";this.bpm=120;this.pause=!1;this.ID=n.getID();this.name=t;this.hover=!1;this.instruments=[];this.instruments.push(new n.Model.Instrument("Guitar"));t||(this.name="Untitled")}return t}();n.Project=t}(Inknote||(Inknote={})),function(n){var t=function(){function n(){this.isNote=!0}return Object.defineProperty(n,"Instance",{get:function(){return(this._instance===null||this._instance===undefined)&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n}();n.DrawingSettings=t}(Inknote||(Inknote={})),function(n){var t=function(){function n(){this.noteControlsHidden=!1;this.loggingLevel=2}return n}();n.TempData=t}(Inknote||(Inknote={})),function(n){var t;(function(n){(function(n){n[n.NOTE=0]="NOTE";n[n.REST=1]="REST";n[n.CHORD=2]="CHORD";n[n.CLEF=3]="CLEF";n[n.TIMESIGNATURE=4]="TIMESIGNATURE";n[n.TEXT=5]="TEXT"})(n.ItemIdentifier||(n.ItemIdentifier={}));var t=n.ItemIdentifier})(t=n.Compressed||(n.Compressed={}))}(Inknote||(Inknote={})),function(n){var t;(function(n){var t=function(){function t(t,i,r){this.v=t;this.o=i;this.l=r;this.i=n.ItemIdentifier.NOTE}return t}();n.CompressedNote=t})(t=n.Compressed||(n.Compressed={}))}(Inknote||(Inknote={})),function(n){var t;(function(n){var t=function(){function t(t){this.notes=t;this.i=n.ItemIdentifier.CHORD}return t}();n.CompressedChord=t})(t=n.Compressed||(n.Compressed={}))}(Inknote||(Inknote={})),function(n){var t;(function(n){var t=function(){function t(t){this.l=t;this.i=n.ItemIdentifier.REST}return t}();n.CompressedRest=t})(t=n.Compressed||(n.Compressed={}))}(Inknote||(Inknote={})),function(n){var t;(function(n){(function(n){n[n.FRENCH_VIOLIN=0]="FRENCH_VIOLIN";n[n.TREBLE=1]="TREBLE";n[n.SOPRANO=2]="SOPRANO";n[n.MEZZ_SOPRANO=3]="MEZZ_SOPRANO";n[n.ALTO=4]="ALTO";n[n.TENOR=5]="TENOR";n[n.BARITONE=6]="BARITONE";n[n.BASS=7]="BASS";n[n.SUBBASS=8]="SUBBASS"})(n.CompressedClefType||(n.CompressedClefType={}));var i=n.CompressedClefType,t=function(){function t(t){this.v=t;this.i=n.ItemIdentifier.CLEF}return t}();n.CompressedClef=t})(t=n.Compressed||(n.Compressed={}))}(Inknote||(Inknote={})),function(n){var t;(function(n){var t=function(){function t(t,i){this.t=t;this.b=i;this.i=n.ItemIdentifier.TIMESIGNATURE}return t}();n.CompressedTimeSignature=t})(t=n.Compressed||(n.Compressed={}))}(Inknote||(Inknote={})),function(n){var t;(function(n){var t=function(){function t(){this.i=n.ItemIdentifier.TEXT}return t}();n.CompressedText=t})(t=n.Compressed||(n.Compressed={}))}(Inknote||(Inknote={})),function(n){var t;(function(n){var t=function(){function n(){this.items=[]}return n}();n.Bar=t})(t=n.Compressed||(n.Compressed={}))}(Inknote||(Inknote={})),function(n){var t;(function(n){var t=function(){function n(n){this.name=n;this.v=!0;this.bars=[]}return n}();n.Instrument=t})(t=n.Compressed||(n.Compressed={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(){function t(t){this.name=t;this.colour="#FFFFFF";this.ID=n.getID();this.instruments=[];t||(this.name=this.ID)}return t}();t.CompressedProject=i})(t=n.Compressed||(n.Compressed={}))}(Inknote||(Inknote={})),function(n){var t;(function(n){var t=function(){function n(n,t,i,r){this.name=n;this.notesInKey=t;this.sharps=i;this.flats=r}return n.prototype.countSharps=function(){return this.sharps.length},n.prototype.countFlats=function(){return this.flats.length},n}();n.Key=t})(t=n.Model||(n.Model={}))}(Inknote||(Inknote={})),function(n){var t;(function(n){var t=function(){function n(n,t){this.name=n;this.intervals=t}return n}();n.KeyType=t})(t=n.Model||(n.Model={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){function u(i){for(var u=n.Maths.alignSimilarArrayTo(i,t.C_MAJOR.notesInKey),f=[],r=0;r<u.length;r++)u[r]==t.C_MAJOR.notesInKey[r]+1&&f.push(t.C_MAJOR.notesInKey[r]);return f}function f(i){for(var u=n.Maths.alignSimilarArrayTo(i,t.C_MAJOR.notesInKey),f=[],r=0;r<u.length;r++)u[r]==t.C_MAJOR.notesInKey[r]-1&&f.push(t.C_MAJOR.notesInKey[r]);return f}function e(r){var a,o,s,h,e,c,l,v;for(r||(r=0),a=[],o=0;o<i.length;o++){s=i[o];for(h in t.NoteValue)if(isNaN(h)){for(e=[],c=new t.Note(parseInt(t.NoteValue[h]),4,1),c.value=(c.value+r)%12,l=0;l<s.intervals.length;l++)v=n.getNoteOfDistance(c,s.intervals[l]),e.push(v.value);a.push(new t.Key(h+" "+s.name,e,u(e),f(e)))}}return a}var i=[new t.KeyType("major",[0,2,4,5,7,9,11]),new t.KeyType("melodic minor",[0,2,3,5,7,8,10]),new t.KeyType("harmonic minor",[0,2,3,5,7,8,11])],r;t.C_MAJOR=new t.Key("C_MAJOR",[t.NoteValue.C,t.NoteValue.D,t.NoteValue.E,t.NoteValue.F,t.NoteValue.G,t.NoteValue.A,t.NoteValue.B],[],[]);r=function(){function n(){}return Object.defineProperty(n,"Instance",{get:function(){return n._instance||(n._instance=new n),n._instance},enumerable:!0,configurable:!0}),n.prototype.getAllKeys=function(n){return e(n)},n}();t.KeyHolder=r})(t=n.Model||(n.Model={}))}(Inknote||(Inknote={})),function(n){var t;(function(n){function t(n,t){for(var i=0;i<t.notesInKey.length;i++)if(n.value==t.notesInKey[i])return!0;return!1}n.NoteIsInKey=t})(t=n.Model||(n.Model={}))}(Inknote||(Inknote={})),function(n){(function(n){n[n.Standard=0]="Standard";n[n.UPPER_lower=1]="UPPER_lower";n[n.DoReMi=2]="DoReMi"})(n.NotationType||(n.NotationType={}));var t=n.NotationType}(Inknote||(Inknote={})),function(n){var t;(function(n){var t=function(){function n(n,t,i,r){this.baseNote=n;this.rootNote=t;this.minor=i;this.annotations=r}return Object.defineProperty(n.prototype,"name",{get:function(){throw new Error("Not implemented");},enumerable:!0,configurable:!0}),n}();n.DoReMiChordNotation=t})(t=n.ChordNotation||(n.ChordNotation={}))}(Inknote||(Inknote={})),function(n){var t;(function(n){function t(n){return["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B",][n]}var i=function(){function n(n,t,i,r){this.baseNote=n;this.rootNote=t;this.minor=i;this.annotations=r}return Object.defineProperty(n.prototype,"name",{get:function(){var n=t(this.rootNote.value);return this.minor&&(n+="m"),n=n+this.annotations,this.baseNote.value!=this.rootNote.value&&(n+="/"+t(this.baseNote.value)),n},enumerable:!0,configurable:!0}),n}();n.StandardChordNotation=i})(t=n.ChordNotation||(n.ChordNotation={}))}(Inknote||(Inknote={})),function(n){var t;(function(n){function t(n){return["C","Cis","D","Dis","E","F","Fis","G","Gis","A","B","H",][n]}var i=function(){function n(n,t,i,r){this.baseNote=n;this.rootNote=t;this.minor=i;this.annotations=r}return Object.defineProperty(n.prototype,"name",{get:function(){var n=t(this.rootNote.value);return this.minor&&(n=n.toLowerCase()),n=n+this.annotations,this.baseNote.value!=this.rootNote.value&&(n+="/"+t(this.baseNote.value)),n},enumerable:!0,configurable:!0}),n}();n.UPPER_lowerChordNotation=i})(t=n.ChordNotation||(n.ChordNotation={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(){function i(){this.ID=n.getID();this.order=100;this.text="Free licence"}return i.prototype.isOver=function(n,t,i){var u=n>i.width-120,f=n<i.width-10,e=t>10,o=t<30,r=u&&f&&e&&o;return this.hover=r?!0:!1,r},i.prototype.click=function(){n.Managers.PageManager.Current.page=n.Managers.Page.Licence},i.prototype.draw=function(n,i){return n.fillStyle=t.Colours.white,n.strokeStyle=t.Colours.black,this.hover&&(n.strokeStyle=t.Colours.orange),n.beginPath(),n.rect(i.width-120,10,110,20),n.lineWidth=1,n.fill(),n.stroke(),n.fillStyle=t.Colours.black,n.font=t.Fonts.standard,n.beginPath(),n.textAlign="center",n.fillText(this.text,i.width-65,25),this.hover&&(n.beginPath(),n.font=t.Fonts.small,n.textAlign="right",n.fillText("Click to upgrade your licence",i.width-10,45)),!0},i}();t.Licence=i})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(n){n.Fonts={title:"40px Josefin Sans",large:"18px Josefin Sans",standard:"12px Josefin Sans",small:"10px Josefin Sans",watermark:"42px Josefin Sans",halfHeight:"30px Arial"}})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(n){n.Colours={white:"white",orange:"orange",lightOrange:"rgba(255,150,0,0.5)",tan:"rgb(220, 142, 66)",lightTan:"rgb(240, 162, 86)",peach:"rgb(250, 222, 196)",black:"rgb(10,10,10)",watermarkGray:"rgba(120,120,120,0.1)",shadowGray:"rgba(70,70,70,0.3)",lightGray:"lightgray",gray:"darkgray",darkgray:"gray",darkerGray:"rgb(100,100,100)",darkestGray:"rgb(80,80,80)",translucentBlack:"rgba(0,0,0,0.2)",faintBlue:"rgb(245,245,255)",lightBlue:"lightblue",midBlue:"rgb(100,130,240)",brightRed:"rgb(255,0,0)",negativeRed:"rgb(255, 129, 129)",negativeHoverRed:"rgb(255,150,150)",green:"rgb(50,200,50)"}})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(){function i(){this.ID=n.getID();this.order=-10;this.mouse={x:-100,y:-100};this.t=0;this.spinners=[]}return Object.defineProperty(i,"Instance",{get:function(){return i._instance||(i._instance=new i),i._instance},enumerable:!0,configurable:!0}),i.prototype.isOver=function(n,t){return this.mouse.x=n,this.mouse.y=t,!1},i.prototype.draw=function(n,i){return this.t++,n.save(),n.beginPath(),n.translate(i.width/2,i.height/2),n.rotate(-Math.PI/4),n.font=t.Fonts.watermark,n.textAlign="center",n.fillStyle=t.Colours.watermarkGray,n.fillText("with ♥ - inknote",0,0),n.restore(),!0},i}();t.Background=i})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(){function i(t,i){this.y=t;this.name=i;this.order=10;this.ID=n.getID();this.x=30;this.width=0}return i.prototype.isOver=function(){return!1},i.prototype.draw=function(n,i){this.name&&(n.beginPath(),n.fillStyle=t.Colours.black,n.strokeStyle=t.Colours.black,n.font=t.Fonts.small,n.textAlign="left",n.fillText(this.name,this.x+10,this.y-15),n.textAlign="center");this.width=i.width-this.x*2;for(var r=0;r<5;r++)n.beginPath(),n.strokeStyle=t.Colours.black,n.moveTo(this.x,this.y+10*r),n.lineTo(i.width-this.x,this.y+10*r),n.stroke();return!0},i}();t.Stave=i})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){function e(i){var r=null;switch(i.clefType){case n.Model.ClefType.GClef:r=new t.GClef(i.drawLocation);break;case n.Model.ClefType.CClef:r=new t.CClef(i.drawLocation);break;case n.Model.ClefType.FClef:r=new t.FClef(i.drawLocation)}return r}var i=function(n){function t(t){n.call(this);this.drawPosition=t;this.lineHeight=10}return __extends(t,n),t}(n.Notation),r,u,f;t.Clef=i;r=function(n){function i(){n.apply(this,arguments)}return __extends(i,n),i.prototype.draw=function(n){var i=this.lineHeight/2,r=i*Math.sin(Math.PI/4);return n.beginPath(),n.fillStyle=t.Colours.black,n.strokeStyle=t.Colours.black,(this.hover||this.select)&&(n.fillStyle=t.Colours.orange,n.strokeStyle=t.Colours.orange),n.moveTo(this.x+r/2,this.y+3*i),n.lineTo(this.x-r,this.y-4*i),n.bezierCurveTo(this.x-3*i,this.y-11*i,this.x+5*i,this.y-9*i,this.x,this.y-4*i),n.bezierCurveTo(this.x-2*i,this.y-3*i,this.x-4*i,this.y-2*i,this.x-2*i,this.y+r),n.bezierCurveTo(this.x-2*r,this.y+3*r,this.x,this.y+2*r,this.x+r,this.y+r),n.bezierCurveTo(this.x+4*r,this.y-2*i,this.x-4*r,this.y-2*i,this.x-r,this.y+r),n.bezierCurveTo(this.x-3*r,this.y-i,this.x+3*r,this.y-i,this.x+r,this.y+r),n.bezierCurveTo(this.x,this.y+2*r,this.x-2*r,this.y+3*r,this.x-2*i,this.y+r),n.bezierCurveTo(this.x-3*i,this.y-2*i,this.x-i,this.y-3*i,this.x,this.y-4*i),n.bezierCurveTo(this.x+4*i,this.y-8*i,this.x-2*i,this.y-10*i,this.x-r,this.y-4*i),n.lineTo(this.x+r/2,this.y+3*i),n.fill(),n.stroke(),n.beginPath(),n.moveTo(this.x+r/2,this.y+3*i),n.bezierCurveTo(this.x+r,this.y+5*i,this.x-2*r,this.y+5*i,this.x-i,this.y+4*i),n.stroke(),n.beginPath(),n.arc(this.x-i,this.y+4*i,r,0,2*Math.PI),n.fill(),!0},i}(i);t.GClef=r;u=function(n){function i(){n.apply(this,arguments)}return __extends(i,n),i.prototype.draw=function(n){var i=this.lineHeight/2;return n.beginPath(),n.fillStyle=t.Colours.black,n.strokeStyle=t.Colours.black,(this.hover||this.select)&&(n.fillStyle=t.Colours.orange,n.strokeStyle=t.Colours.orange),n.lineWidth=4,n.moveTo(this.x-4,this.y+2*this.lineHeight),n.lineTo(this.x-4,this.y-2*this.lineHeight),n.stroke(),n.lineWidth=1,n.beginPath(),n.moveTo(this.x,this.y+2*this.lineHeight),n.lineTo(this.x,this.y-2*this.lineHeight),n.stroke(),n.beginPath(),n.moveTo(this.x,this.y),n.bezierCurveTo(this.x+i,this.y,this.x+i,this.y-i,this.x+i,this.y-i),n.bezierCurveTo(this.x+2*i,this.y,this.x+2*i,this.y-5*i,this.x+i,this.y-3*i),n.bezierCurveTo(this.x+3*i,this.y-6*i,this.x+3*i,this.y+i,this.x+i,this.y-i),n.fill(),n.stroke(),n.beginPath(),n.moveTo(this.x,this.y),n.bezierCurveTo(this.x+i,this.y,this.x+i,this.y+i,this.x+i,this.y+i),n.bezierCurveTo(this.x+2*i,this.y,this.x+2*i,this.y+5*i,this.x+i,this.y+3*i),n.bezierCurveTo(this.x+3*i,this.y+6*i,this.x+3*i,this.y-i,this.x+i,this.y+i),n.fill(),n.stroke(),!0},i}(i);t.CClef=u;f=function(n){function i(){n.apply(this,arguments)}return __extends(i,n),i.prototype.draw=function(n){var i=this.lineHeight/2,r;return n.fillStyle=t.Colours.black,this.hover&&(n.fillStyle=t.Colours.orange),this.select&&(n.fillStyle=t.Colours.orange,n.strokeStyle=t.Colours.orange),n.beginPath(),n.arc(this.x,this.y,i,0,2*Math.PI),r=i*Math.sin(Math.PI/4),n.moveTo(this.x-r,this.y+r),n.bezierCurveTo(this.x-i,this.y,this.x-2*i,this.y-this.lineHeight,this.x+i*3/2,this.y-this.lineHeight),n.bezierCurveTo(this.x+4*i,this.y-i*3/2,this.x+4*i,this.y+2*i,this.x,this.y+2*this.lineHeight),n.bezierCurveTo(this.x+3*i,this.y+2*i,this.x+3*i,this.y,this.x+i*3/2,this.y-this.lineHeight),n.bezierCurveTo(this.x-i,this.y-this.lineHeight,this.x-i/2,this.y,this.x,this.y),n.fill(),n.beginPath(),n.arc(this.x+4*i,this.y-i,i/2,0,2*Math.PI),n.arc(this.x+4*i,this.y+i,i/2,0,2*Math.PI),n.fill(),!0},i}(i);t.FClef=f;t.getDrawingFromClef=e})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(n){function i(t,i){n.call(this);this.top=t;this.bottom=i}return __extends(i,n),i.prototype.draw=function(n){return n.beginPath(),n.fillStyle=t.Colours.black,(this.hover||this.select)&&(n.fillStyle=t.Colours.orange),n.font=t.Fonts.halfHeight,n.textAlign="center",n.fillText(this.top+"",this.x,this.y),n.fillText(this.bottom+"",this.x,this.y+20),this.select&&(n.beginPath(),n.strokeStyle=t.Colours.orange,n.rect(this.x-15,this.y-25,30,50),n.stroke()),!0},i}(n.Notation);t.TimeSignature=i})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){function i(n,t,i,r){n.beginPath();n.moveTo(t-r/5,i+r*4/3);n.lineTo(t-r/5,i-r*6/5);n.moveTo(t+r/5,i+r*6/5);n.lineTo(t+r/5,i-r*4/3);n.stroke();n.beginPath();n.lineWidth=2;n.moveTo(t-r/2,i-r/4);n.lineTo(t+r/2,i-r*3/4);n.moveTo(t-r/2,i+r*3/4);n.lineTo(t+r/2,i+r/4);n.stroke()}var r=function(n){function r(){n.apply(this,arguments)}return __extends(r,n),r.prototype.draw=function(n){return n.strokeStyle=t.Colours.black,n.fillStyle=t.Colours.black,this.select&&(n.beginPath(),n.arc(this.x,this.y,10,0,2*Math.PI),n.strokeStyle=t.Colours.orange,n.fillStyle=t.Colours.orange,n.stroke()),this.hover&&(n.strokeStyle=t.Colours.orange,n.fillStyle=t.Colours.orange),i(n,this.x,this.y,10),n.lineWidth=1,!0},r}(n.Notation);t.Sharp=r})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){function i(n,t,i,r){n.beginPath();n.moveTo(t-r/2,i-r/2);n.bezierCurveTo(t+r/2,i-r/4,t+r/2,i+r/4,t-r/2,i+r/2);n.bezierCurveTo(t,i,t,i,t-r/2,i-r/2);n.fill();n.beginPath();n.moveTo(t-r/2,i+r/2);n.lineTo(t-r/2,i-r*3/2);n.stroke()}var r=function(n){function r(){n.apply(this,arguments)}return __extends(r,n),r.prototype.draw=function(n){return n.strokeStyle=t.Colours.black,n.fillStyle=t.Colours.black,this.select&&(n.beginPath(),n.arc(this.x,this.y,10,0,2*Math.PI),n.strokeStyle=t.Colours.orange,n.fillStyle=t.Colours.orange,n.stroke()),this.hover&&(n.strokeStyle=t.Colours.orange,n.fillStyle=t.Colours.orange),i(n,this.x,this.y,10),!0},r}(n.Notation);t.Flat=r})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){function i(n,t,i,r){n.beginPath();n.moveTo(t-r/4,i+r*3/4);n.lineTo(t-r/4,i-r*3/2);n.moveTo(t+r/4,i+r*3/2);n.lineTo(t+r/4,i-r*3/4);n.stroke();n.beginPath();n.lineWidth=2;n.moveTo(t-r/4,i-r/4);n.lineTo(t+r/4,i-r*3/4);n.moveTo(t-r/4,i+r*3/4);n.lineTo(t+r/4,i+r/4);n.stroke()}var r=function(n){function r(){n.apply(this,arguments)}return __extends(r,n),r.prototype.draw=function(n){return n.strokeStyle=t.Colours.black,n.fillStyle=t.Colours.black,this.select&&(n.beginPath(),n.arc(this.x,this.y,10,0,2*Math.PI),n.strokeStyle=t.Colours.orange,n.fillStyle=t.Colours.orange,n.stroke()),this.hover&&(n.strokeStyle=t.Colours.orange,n.fillStyle=t.Colours.orange),i(n,this.x,this.y,10),n.lineWidth=1,!0},r}(n.Notation);t.Natural=r})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){function r(i,r,u,f,e){if(i.fillStyle=t.Colours.black,i.strokeStyle=t.Colours.black,f.isPotential&&(i.fillStyle=t.Colours.midBlue,i.strokeStyle=t.Colours.midBlue),f.isPlaying&&(i.strokeStyle=t.Colours.green,i.fillStyle=t.Colours.green),f.select&&(i.beginPath(),i.arc(r,u,e,0,2*Math.PI),i.strokeStyle=t.Colours.orange,i.fillStyle=t.Colours.orange,i.stroke()),f.hover&&(i.strokeStyle=t.Colours.orange,i.fillStyle=t.Colours.orange),f.noteLength==n.Model.NoteLength.Breve){i.lineWidth=2;return}if(i.beginPath(),i.arc(r,u,e/2,0,2*Math.PI,!1),f.noteLength==n.Model.NoteLength.SemiBreve)i.lineWidth=2,i.stroke(),i.lineWidth=1;else if(f.noteLength==n.Model.NoteLength.Minim?(i.lineWidth=2,i.stroke(),i.lineWidth=1):i.fill(),i.beginPath(),f.stemUp){if(i.moveTo(r+e/2-.5,u),i.lineTo(r+e/2-.5,u-e*7/2),i.stroke(),f.noteLength>n.Model.NoteLength.Crotchet)for(var s=r+e/2-.5,o=u-e*7/2,c=f.noteLength-n.Model.NoteLength.Crotchet,h=0;c>=1;)i.beginPath(),i.moveTo(s,o),i.bezierCurveTo(s+1,o+10,s+15,o+13,s+7,o+25),i.bezierCurveTo(s+13,o+13,s,o+8,s,o+15),i.fill(),i.stroke(),c--,h==0?o+=10:o-=h==1?20:10,h++}else if(i.moveTo(r-e/2+.5,u),i.lineTo(r-e/2+.5,u+e*7/2),i.stroke(),f.noteLength>n.Model.NoteLength.Crotchet)for(var s=r+.5-e/2,o=u+e*7/2,c=f.noteLength-n.Model.NoteLength.Crotchet,h=0;c>=1;)i.beginPath(),i.moveTo(s,o),i.bezierCurveTo(s+1,o-10,s+15,o-13,s+7,o-25),i.bezierCurveTo(s+13,o-13,s,o-8,s,o-15),i.fill(),i.stroke(),c--,h==0?o-=10:o+=h==1?20:10,h++}var i=function(n){function t(t){n.call(this);this.stemUp=t;this.isPotential=!1;this.isPlaying=!1}return __extends(t,n),t}(n.Notation),u,f,e,o,s,h,c,l;t.Note=i;u=function(i){function r(){i.apply(this,arguments);this.noteLength=n.Model.NoteLength.Breve}return __extends(r,i),r.prototype.draw=function(n){return n.beginPath(),n.fillStyle=t.Colours.white,n.strokeStyle=t.Colours.black,this.isPlaying&&(n.strokeStyle=t.Colours.green),(this.hover||this.select)&&(n.strokeStyle=t.Colours.orange),n.moveTo(this.x-5,this.y-5),n.lineTo(this.x-5,this.y+5),n.moveTo(this.x+5,this.y-5),n.lineTo(this.x+5,this.y+5),n.lineWidth=2,n.moveTo(this.x-5,this.y-3),n.lineTo(this.x+5,this.y-3),n.moveTo(this.x-5,this.y+3),n.lineTo(this.x+5,this.y+3),n.lineWidth=1,n.stroke(),this.select&&(n.beginPath(),n.arc(this.x,this.y,10,0,2*Math.PI),n.strokeStyle=t.Colours.orange,n.fillStyle=t.Colours.orange,n.stroke()),!0},r}(i);t.Breve=u;f=function(t){function i(){t.apply(this,arguments);this.noteLength=n.Model.NoteLength.SemiBreve}return __extends(i,t),i.prototype.draw=function(n){return r(n,this.x,this.y,this,10),!0},i}(i);t.SemiBreve=f;e=function(t){function i(){t.apply(this,arguments);this.noteLength=n.Model.NoteLength.Minim}return __extends(i,t),i.prototype.draw=function(n){return r(n,this.x,this.y,this,10),!0},i}(i);t.Minim=e;o=function(t){function i(){t.apply(this,arguments);this.noteLength=n.Model.NoteLength.Crotchet}return __extends(i,t),i.prototype.draw=function(n){return r(n,this.x,this.y,this,10),!0},i}(i);t.Crotchet=o;s=function(t){function i(){t.apply(this,arguments);this.noteLength=n.Model.NoteLength.Quaver}return __extends(i,t),i.prototype.draw=function(n){return r(n,this.x,this.y,this,10),!0},i}(i);t.Quaver=s;h=function(t){function i(){t.apply(this,arguments);this.noteLength=n.Model.NoteLength.SemiQuaver}return __extends(i,t),i.prototype.draw=function(n){return r(n,this.x,this.y,this,10),!0},i}(i);t.SemiQuaver=h;c=function(t){function i(){t.apply(this,arguments);this.noteLength=n.Model.NoteLength.DemiSemiQuaver}return __extends(i,t),i.prototype.draw=function(n){return r(n,this.x,this.y,this,10),!0},i}(i);t.DemiSemiQuaver=c;l=function(t){function i(){t.apply(this,arguments);this.noteLength=n.Model.NoteLength.HemiDemiSemiQuaver}return __extends(i,t),i.prototype.draw=function(n){return r(n,this.x,this.y,this,10),!0},i}(i);t.HemiDemiSemiQuaver=l})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(n){function i(t,i){n.call(this);this.order=45;this.x=t;this.y=i}return __extends(i,n),i.prototype.draw=function(n){return n.beginPath,n.lineWidth=1,n.strokeStyle=t.Colours.black,(this.hover||this.select)&&(n.strokeStyle=t.Colours.orange),n.moveTo(this.x-10,this.y),n.lineTo(this.x+10,this.y),n.stroke(),!0},i}(n.Notation);t.LedgerLine=i})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){function u(n,i){i.select&&(n.beginPath(),n.arc(i.x,i.y,10,0,2*Math.PI),n.strokeStyle=t.Colours.orange,n.fillStyle=t.Colours.orange,n.stroke());n.strokeStyle=t.Colours.black;n.fillStyle=t.Colours.black;(i.hover||i.select)&&(n.strokeStyle=t.Colours.orange,n.fillStyle=t.Colours.orange)}function d(n,t,i,r){n.beginPath();n.moveTo(t,i-r);n.lineTo(t+r/1,i-r);n.lineTo(t+r/1,i+r);n.lineTo(t,i+r);n.lineTo(t,i-r);n.fill()}function f(n,t,i,r){n.beginPath();n.moveTo(t,i);n.lineTo(t+2*r,i);n.lineTo(t+2*r,i+r/2);n.lineTo(t,i+r/2);n.lineTo(t,i);n.fill()}function e(n,t,i,r){n.beginPath();n.moveTo(t,i);n.lineTo(t+2*r,i);n.lineTo(t+2*r,i-r/2);n.lineTo(t,i-r/2);n.lineTo(t,i);n.fill()}function o(n,t,i,r){n.beginPath();n.moveTo(t,i);n.quadraticCurveTo(t+r,i-r/2,t,i-r);n.quadraticCurveTo(t+2*r,i,t+r/2,i+r/2);n.quadraticCurveTo(t-r,i+r,t+r/2,i+3*r/2);n.quadraticCurveTo(t-r/2,i+7*r/4,t,i+5*r/2);n.quadraticCurveTo(t-3*r/2,i+6*r/4,t+r/2,i+3*r/2);n.quadraticCurveTo(t-2*r,i+r/2,t,i);n.fill();n.stroke()}function i(n,t,i,r){n.beginPath();n.arc(t,i,r/4,0,2*Math.PI);n.fill();n.moveTo(t,i);n.bezierCurveTo(t+r/2,i+r,t+3*r/2,i+r/2,t+2*r,i);n.bezierCurveTo(t+3*r/2,i+r/2,t+r/2,i+r,t-r/5,i+r*.75/4);n.stroke();n.fill();n.moveTo(t+2*r,i);n.lineTo(t,i+r*4);n.stroke()}function s(n,t,r,u){i(n,t,r,u);i(n,t-u,r+2*u,u)}function h(n,t,r,u){i(n,t,r,u);i(n,t-u,r+2*u,u);i(n,t+u,r-2*u,u)}function c(n,t,r,u){i(n,t,r,u);i(n,t-u,r+2*u,u);i(n,t+u,r-2*u,u);i(n,t-u*2,r+4*u,u)}var r=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t}(n.Notation),l,a,v,y,p,w,b,k;t.Rest=r;l=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.draw=function(n){return u(n,this),d(n,this.x,this.y,10),!0},t}(r);t.BreveRest=l;a=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.draw=function(n){return u(n,this),f(n,this.x,this.y,5),!0},t}(r);t.SemiBreveRest=a;v=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.draw=function(n){return u(n,this),e(n,this.x,this.y,5),!0},t}(r);t.MinimRest=v;y=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.draw=function(n){return u(n,this),o(n,this.x,this.y,5),!0},t}(r);t.CrotchetRest=y;p=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.draw=function(n){return u(n,this),i(n,this.x,this.y,5),!0},t}(r);t.QuaverRest=p;w=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.draw=function(n){return u(n,this),s(n,this.x,this.y,5),!0},t}(r);t.SemiQuaverRest=w;b=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.draw=function(n){return u(n,this),h(n,this.x,this.y,5),!0},t}(r);t.DemiSemiQuaverRest=b;k=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.draw=function(n){return u(n,this),c(n,this.x,this.y,5),!0},t}(r);t.HemiDemiSemiQuaverRest=k})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(n){function i(){n.apply(this,arguments)}return __extends(i,n),i.prototype.draw=function(n){return n.fillStyle=t.Colours.black,this.select&&(n.fillStyle=t.Colours.orange),n.font=t.Fonts.small,n.beginPath(),n.fillText(this.content,this.x,this.y),!0},i}(n.Notation);t.DrawText=i})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(i){function r(){i.apply(this,arguments);this.ID=n.getID();this.order=20;this.hasError=!1}return __extends(r,i),r.prototype.isOver=function(n,t){var i=n<this.x+this.width,r=n>this.x,u=t>this.y,f=t<this.y+this.height;return i&&r&&u&&f},r.prototype.draw=function(n){return n.beginPath(),n.strokeStyle=this.hover||this.select?t.Colours.orange:t.Colours.black,this.select&&(n.lineWidth=2),n.moveTo(this.x,this.y),n.lineTo(this.x,this.y+this.height),n.moveTo(this.x+this.width,this.y),n.lineTo(this.x+this.width,this.y+this.height),n.stroke(),this.select&&(n.beginPath(),n.moveTo(this.x,this.y+this.height+10),n.lineTo(this.x+this.width,this.y+this.height+10),n.stroke()),n.lineWidth=1,this.hasError&&(n.beginPath(),n.globalAlpha=.2,n.fillStyle=t.Colours.negativeRed,n.fillRect(this.x,this.y,this.width,this.height),n.globalAlpha=1),this.barNumber&&(n.beginPath(),n.fillStyle=t.Colours.black,n.fillText(this.barNumber+"",this.x,this.y-5)),!0},r}(n.Notation);t.Bar=i})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(){function i(){this.ID=n.getID();this.t=0;this.x=0;this.y=0;this.order=100;this.hover=!1;this.select=!1;this.x=5;this.y=7;var i=this;i.draw=function(r,u){return this.t++,r.beginPath(),r.fillStyle=t.Colours.translucentBlack,r.rect(0,0,u.width,u.height),r.fill(),r.beginPath(),r.fillStyle="orange",r.arc(u.width/2,u.height/2,80,0,2*Math.PI),r.fill(),n.drawTextAlongArc(r,"Loading",u.width/2,u.height/2,90,1),r.beginPath(),r.fillStyle="black",r.arc(50*Math.sin(i.t/100)*Math.sin(i.t/50)+u.width/2,50*Math.sin(i.t/100)*Math.cos(i.t/50)+u.height/2,10*Math.abs(Math.sin(i.t/100)),0,2*Math.PI),r.arc(-50*Math.sin(i.t/100)*Math.sin(i.t/50)+u.width/2,-50*Math.sin(i.t/100)*Math.cos(-i.t/50)+u.height/2,10*Math.abs(Math.sin(i.t/100)),0,2*Math.PI),r.fill(),!0}}return i.prototype.isOver=function(t,i){return n.Maths.isWithinRadius(t,i,this.x,this.y,10)},i}();t.LoadingSplash=i})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(){function i(i){this.ID=n.getID();this.x=0;this.order=100;this.hover=!1;this.select=!1;this.name=i;this.x=0;var r=this;r.draw=function(i,u){if(r.select){i.beginPath();i.fillStyle=t.Colours.white;var f=n.Managers.ProjectManager.Instance.currentProject.name.length*30+100;i.rect(u.width/2-f/2,this.y+60,f,50);i.strokeStyle=t.Colours.lightOrange;i.lineWidth=10;i.stroke();this.name.length>0?(i.beginPath(),i.fillStyle=t.Colours.black,i.font=t.Fonts.small,i.textAlign="center",i.fillText("Click delete to clear text",u.width/2,this.y+50),i.fill()):(i.beginPath(),i.fillStyle=t.Colours.black,i.font=t.Fonts.small,i.textAlign="center",i.fillText("Please type a project name",u.width/2,this.y+50),i.fill())}return i.beginPath(),i.fillStyle=t.Colours.orange,i.font=t.Fonts.title,i.textAlign="center",i.fillText(r.name,u.width/2,this.y+100),i.fill(),r.hover&&(i.beginPath(),i.rect(u.width/2-50,this.y+105,100,10),i.fill(),r.select||(i.beginPath(),i.font=t.Fonts.small,i.fillStyle=t.Colours.black,i.textAlign="center",i.fillText("Click to edit project name",u.width/2,this.y+50),i.fill())),!0}}return Object.defineProperty(i.prototype,"y",{get:function(){return-n.ScrollService.Instance.y},set:function(){return},enumerable:!0,configurable:!0}),i.prototype.isOver=function(n,t,i){return t<this.y+100&&t>this.y+65&&n>i.width/2-150&&n<i.width/2+150},i}();t.Name=i})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(){function i(i){this.name=i;this.ID=n.getID();this.order=10;this.hover=!1;this.select=!1;this.colour="#FFFFFF";var r=this;r.draw=function(n){(r.hover||r.select)&&(n.fillStyle=t.Colours.lightBlue,n.beginPath(),n.rect(r.x-60,r.y-60,120,140),n.fill());var u=n.createLinearGradient(r.x-50,r.y-50,r.x+50,r.y+50),i=20;return r.select?(u.addColorStop(0,t.Colours.lightTan),i=0):u.addColorStop(0,t.Colours.tan),u.addColorStop(1,t.Colours.peach),n.fillStyle=u,n.beginPath(),n.moveTo(r.x-50,r.y+50),n.lineTo(r.x+50,r.y+50),n.lineTo(r.x+50,r.y-50),n.lineTo(r.x-i,r.y-50),n.lineTo(r.x-50,r.y-i),n.fill(),n.beginPath(),n.moveTo(r.x-(i+4),r.y-45),n.lineTo(r.x-45,r.y-45),n.lineTo(r.x-45,r.y-(i+4)),n.strokeStyle=t.Colours.black,n.fillStyle=t.Colours.white,n.fill(),n.stroke(),n.beginPath(),n.rect(r.x+30,r.y+30,15,15),n.fillStyle=r.colour,n.fill(),n.stroke(),n.beginPath(),n.fillStyle=t.Colours.black,n.textAlign="center",n.fillText(r.name,r.x,r.y+70),r.hover&&(n.strokeStyle=t.Colours.midBlue,n.beginPath(),n.rect(r.x-60,r.y-60,120,140),n.stroke()),!0}}return i.prototype.isOver=function(n,t){return n<this.x+50&&n>this.x-50?t<this.y+80&&t>this.y-50:!1},i}();t.File=i})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(n){function i(n,i,r,u,f){for(var e=n.split(""),h=[],o=u/e.length,c=0,s=0;s<e.length;s++)h.push(new t(e[s],i+o*c+o/2,r+f/2,o-2,f-2)),c++;return h}function r(n,i,r,u,f){for(var e=n,h=[],o=u/e.length,c=0,s=0;s<e.length;s++)h.push(new t(e[s],i+o*c+o/2,r+f/2,o-2,f-4)),c++;return h}var t=function(){function t(n,t,i,r,u){this.name=n;this.x=t;this.y=i;this.width=r;this.height=u}return t.prototype.draw=function(t){if(this.name!=""){t.beginPath();t.rect(this.x-this.width/2,this.y-this.height/2,this.width,this.height);var i=t.createLinearGradient(this.x-this.width/2,this.y-this.height/2,this.x+this.width/2,this.y+this.height/2);this.hover?i.addColorStop(0,n.Colours.lightBlue):i.addColorStop(0,n.Colours.darkestGray);i.addColorStop(1,n.Colours.black);t.fillStyle=i;t.fill();t.beginPath();t.fillStyle=n.Colours.white;t.textAlign="center";t.font=n.Fonts.large;t.fillText(this.name,this.x,this.y+5)}},t.prototype.isOver=function(n,t){if(this.name=="")return!1;var i=n>this.x-this.width/2,r=n<this.x+this.width/2,u=t>this.y-this.height/2,f=t<this.y+this.height/2;return i&&r&&u&&f},t}();n.KeyboardKey=t;n.keysFromString=i;n.keysFromArray=r})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(){function i(){this.ID=n.getID();this.order=210;this.cSize={x:0,y:0};var i=this;i.draw=function(n,r){var u,f;for((r.width!=i.cSize.x||r.height!=i.cSize.y)&&(i.cSize={x:r.width,y:r.height},i.keys=[],i.keys=i.keys.concat(t.keysFromString("qwertyuiop",0,r.height/2+0*r.height,r.width,r.height/8)),i.keys=i.keys.concat(t.keysFromString("asdfghjkl-",0,r.height/2+r.height/8,r.width,r.height/8)),i.keys=i.keys.concat(t.keysFromString("zxcvbnm,./",0,r.height/2+r.height/4,r.width,r.height/8)),i.keys=i.keys.concat(t.keysFromArray(["|<"," "," "," ","Delete"],0,r.height/2+3*r.height/8,r.width,r.height/8))),n.font=t.Fonts.standard,n.lineWidth=1,n.strokeStyle=t.Colours.black,n.beginPath(),u=n.createLinearGradient(0,r.height/2,r.width/2,r.height),u.addColorStop(0,t.Colours.darkestGray),u.addColorStop(1,t.Colours.darkerGray),n.fillStyle=u,n.rect(0,r.height/2,r.width,r.height/2),n.fill(),f=0;f<i.keys.length;f++)i.keys[f].draw(n,r);return!0}}return Object.defineProperty(i,"Instance",{get:function(){return i._instance||(i._instance=new i),i._instance},enumerable:!0,configurable:!0}),i.prototype.isOver=function(n,t){for(var r=!1,i=0;i<this.keys.length;i++)this.keys[i].isOver(n,t)?(this.keys[i].hover=!0,r=!0):this.keys[i].hover=!1;return r},i.prototype.click=function(t){for(var u=n.Managers.ProjectManager.Instance,i=u.currentProject,r=0;r<this.keys.length;r++)this.keys[r].isOver(t.clientX,t.clientY-50)&&(this.keys[r].name=="Delete"?u.selectID==i.ID&&(i.name=""):this.keys[r].name=="|<"?u.selectID==i.ID&&(i.name=i.name.substr(0,i.name.length-1)):(console.log(this.keys[r].name),i.name=n.pascalCase(i.name+this.keys[r].name)))},i}();t.Keyboard=i})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){function r(t,r,u,f,e){for(var h,s=[],l=[],o=0;o<t.length;o++){if(h=t[o],!h.click||!h.text){n.log("bad item in menu array");continue}s.push(h)}var v=s.length,c=f/v,a=0;for(o=0;o<s.length;o++)l.push(new i(s[o].text,a*c+c/20,u+e/10,c-c/10,8*e/10,s[o].click,s[o].negative)),a++;return l}var i=function(){function n(n,t,i,r,u,f,e){this.negative=e;this.text=n;this.x=t;this.y=i;this.width=r;this.height=u;this.click=f}return n.prototype.isOver=function(n,t){var i=n>=this.x,r=n<=this.x+this.width,u=t<=this.y+this.height,f=t>=this.y;return i&&r&&u&&f},n.prototype.draw=function(n){n.beginPath();var i=n.createLinearGradient(this.x,this.y,this.x+this.width,this.y+this.height);this.hover?i.addColorStop(0,t.Colours.lightBlue):i.addColorStop(0,t.Colours.gray);i.addColorStop(1,t.Colours.white);n.fillStyle=i;this.negative&&(n.fillStyle=t.Colours.negativeRed,this.hover&&(n.fillStyle=t.Colours.negativeHoverRed));n.rect(this.x,this.y,this.width,this.height);n.fill();this.hover&&(n.strokeStyle=t.Colours.white,n.stroke());n.beginPath();n.fillStyle=t.Colours.black;n.textAlign="center";n.fillText(this.text,this.x+this.width/2,this.y+this.height/2+5);n.fill()},n}();t.BottomMenuButton=i;t.createMenuFromArray=r})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(){function i(){this.ID=n.getID();this.order=150;this.buttons=[];var i=this;i.draw=function(r,u){i.buttons.length<1?i.buttons=t.createMenuFromArray([{text:"Open",click:function(){n.Managers.ProjectManager.Instance.openSelectedProject()}},{text:"<",click:function(){n.Managers.ProjectManager.Instance.previous()}},{text:">",click:function(){n.Managers.ProjectManager.Instance.next()}},{text:"Delete",click:function(){var t=n.Managers.ProjectManager.Instance;t.deleteSelectedProject()},negative:!0}],0,u.height-100,u.width,100):this.resizeButtons(u);r.beginPath();r.fillStyle="black";r.rect(0,u.height-100,u.width,100);r.fill();for(var f=0;f<i.buttons.length;f++)i.buttons[f].draw(r);return!0}}return Object.defineProperty(i,"Instance",{get:function(){return i._instance||(i._instance=new i),i._instance},enumerable:!0,configurable:!0}),i.prototype.isOver=function(n,t,i){for(var r=0;r<this.buttons.length;r++)this.buttons[r].hover=this.buttons[r].isOver(n,t)?!0:!1;return t>i.height-100},i.prototype.click=function(t){for(var r=n.Managers.ProjectManager.Instance,u=r.currentProject,i=0;i<this.buttons.length;i++)this.buttons[i].isOver(t.clientX,t.clientY-50)&&(this.buttons[i].click(),t instanceof MouseEvent&&t.preventDefault())},i.prototype.resizeButtons=function(n){for(var t=this.buttons,e=t.length,r=n.width/e,u=0,f=100,i=0;i<t.length;i++)t[i].x=u*r+r/20,t[i].y=n.height-100+f/10,t[i].width=r-r/10,t[i].height=8*f/10,u++},i}();t.BottomMenu=i})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(){function t(){this.ID=n.getID();this.order=150;var t=this;t.draw=function(){return!0}}return Object.defineProperty(t,"Instance",{get:function(){return t._instance||(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t}();t.ScoreMenu=i})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(i){function r(){i.apply(this,arguments)}return __extends(r,i),r.prototype.draw=function(i){var r=this.standardChord,u=n.getCurrentChordNotation(r.baseNote,r.rootNote,r.minor,r.annotations),f=u.name;return i.beginPath(),i.fillStyle=t.Colours.black,i.strokeStyle=t.Colours.black,i.textAlign="center",i.fillText(f,this.x,this.y),!0},r}(n.Notation);t.ChordSymbol=i})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(){function t(){this.ID=n.getID();this.x=0;this.order=90;this.hover=!1;this.select=!1}return Object.defineProperty(t,"Instance",{get:function(){return t._instance||(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return-n.ScrollService.Instance.y},set:function(){return},enumerable:!0,configurable:!0}),t.prototype.isOver=function(){return!1},t.prototype.draw=function(){return!0},t}();t.TempoMark=i})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i;(function(i){var r=function(){function r(){this.ID=n.getID();this.y=50;this.width=25;this.order=200;this.buttonHeight=20;this.scrollThumbnail=new i.ScrollThumbnail}return r.prototype.click=function(t){t.clientY<50+this.y+this.buttonHeight?n.ScrollService.Instance.up():t.clientY>50+this.y+this.height-this.buttonHeight&&n.ScrollService.Instance.down()},r.prototype.isOver=function(n,t){var r=n>this.x,u=n<this.x+this.width,f=t>this.y,e=t<this.y+this.height,i=r&&u&&f&&e;return this.isOverTopButton=!1,this.isOverBottomButton=!1,this.isOverMiddle=!1,i&&(t<this.y+this.buttonHeight?(this.scrollThumbnail.visible=!1,this.isOverTopButton=!0):t>this.y+this.height-this.buttonHeight?(this.isOverBottomButton=!0,this.scrollThumbnail.visible=!1):(this.isOverMiddle=!0,this.scrollThumbnail.visible=!0,this.scrollThumbnail.y=t,this.scrollThumbnail.x=this.x-3-this.scrollThumbnail.width)),this.hover=i,i},r.prototype.draw=function(n,i){return this.x=i.width-this.width,this.height=i.height-this.y,n.beginPath(),n.clearRect(this.x,this.y,this.width,this.height),n.fillStyle=t.Colours.lightBlue,this.isOverMiddle&&(n.beginPath(),n.rect(this.x,this.y+this.buttonHeight,this.width,this.height-2*this.buttonHeight),n.fill()),n.beginPath(),n.strokeStyle=t.Colours.black,n.moveTo(this.x,this.y+this.buttonHeight),n.lineTo(this.x,i.height-this.buttonHeight),n.stroke(),n.beginPath(),n.rect(this.x,this.y,this.width,this.buttonHeight),n.moveTo(this.x+this.width/2,this.y+this.buttonHeight*2/3),n.lineTo(this.x+this.width/2,this.y+this.buttonHeight/3),n.moveTo(this.x+this.width/2+3,this.y+this.buttonHeight/2),n.lineTo(this.x+this.width/2,this.y+this.buttonHeight/3),n.moveTo(this.x+this.width/2-3,this.y+this.buttonHeight/2),n.lineTo(this.x+this.width/2,this.y+this.buttonHeight/3),this.isOverTopButton&&n.fill(),n.stroke(),n.beginPath(),n.rect(this.x,i.height-this.buttonHeight,this.width,this.buttonHeight),n.moveTo(this.x+this.width/2,i.height-this.buttonHeight*2/3),n.lineTo(this.x+this.width/2,i.height-this.buttonHeight/3),n.moveTo(this.x+this.width/2+3,i.height-this.buttonHeight/2),n.lineTo(this.x+this.width/2,i.height-this.buttonHeight/3),n.moveTo(this.x+this.width/2-3,i.height-this.buttonHeight/2),n.lineTo(this.x+this.width/2,i.height-this.buttonHeight/3),this.isOverBottomButton&&n.fill(),n.stroke(),!0},r}();i.ScrollBar=r})(i=t.ScrollBar||(t.ScrollBar={}))})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(n){var t;(function(n){var t=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t}(n.ScrollBar);n.FileScroll=t})(t=n.ScrollBar||(n.ScrollBar={}))})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i;(function(i){var r=function(){function i(){this.ID=n.getID();this.width=80;this.height=100;this.invert=!1;this.visible=!1;this.order=201}return i.prototype.click=function(){alert("Scroll thumb")},i.prototype.isOver=function(n,t){var i=n>this.x,r=n<this.x+this.width,u=t>this.y,f=t<this.y+this.height;return i&&r&&u&&f},i.prototype.draw=function(n,i){this.invert=this.y+this.height>i.height?!0:!1;var r=this.invert?this.y-this.height:this.y,f=this.height,u=this.x;return n.strokeStyle=t.Colours.black,n.fillStyle=t.Colours.white,n.lineWidth=2,this.invert?(n.beginPath(),n.moveTo(u,r),n.lineTo(u,r+this.height),n.lineTo(u+this.width+10,r+this.height),n.lineTo(u+this.width,r+this.height-5),n.lineTo(u+this.width,r),n.lineTo(u,r),n.fill(),n.stroke()):(n.beginPath(),n.moveTo(u,r),n.lineTo(u+this.width+10,r),n.lineTo(u+this.width,r+5),n.lineTo(u+this.width,r+f),n.lineTo(u,r+f),n.lineTo(u,r),n.fill(),n.stroke()),n.lineWidth=1,!0},i}();i.ScrollThumbnail=r})(i=t.ScrollBar||(t.ScrollBar={}))})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(n){var t;(function(n){var t=function(n){function t(){n.apply(this,arguments);this.width=25}return __extends(t,n),t}(n.ScrollBar);n.ProjectScroll=t})(t=n.ScrollBar||(n.ScrollBar={}))})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i;(function(i){var r=function(){function n(n,t){this.text=n;this.click=t}return n}(),u;i.ClickableMenuItem=r;u=function(){function i(){this.items=[new r("save",function(){n.Action(n.ActionType.SaveProject)}),new r("plugins",function(){Modal.toggle("plugins")}),new r("report bug",function(){Modal.toggle("report")})];this.ID=n.getID();this.width=100;this.order=500}return Object.defineProperty(i.prototype,"itemHeight",{get:function(){return 25},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this.items.length*this.itemHeight},enumerable:!0,configurable:!0}),i.prototype.draw=function(n){var i,r,u;for(n.globalAlpha=1,n.beginPath(),n.fillStyle=t.Colours.shadowGray,n.rect(this.x+4,this.y+3,this.width,this.height),n.fill(),n.beginPath(),n.fillStyle=t.Colours.white,n.strokeStyle=t.Colours.black,n.rect(this.x,this.y,this.width,this.height),n.fill(),n.stroke(),i=0;i<this.items.length;i++)this.items[i].hover&&(n.beginPath(),n.fillStyle=t.Colours.orange,n.rect(this.x,i*25+this.y,this.width,this.itemHeight),n.fill()),n.beginPath(),r=(i+1)*25+this.y,u=r-8,n.font=t.Fonts.standard,n.textAlign="center",n.fillStyle=t.Colours.black,n.fillText(this.items[i].text,this.x+this.width/2,u),i<this.items.length-1&&(n.beginPath(),n.strokeStyle=t.Colours.gray,n.moveTo(this.x,r),n.lineTo(this.x+this.width,r),n.stroke());return!0},i.prototype.isOver=function(n,t){for(var u=n>this.x,f=n<this.x+this.width,e=t>this.y,o=t<this.y+this.height,r=u&&f&&e&&o,s=Math.floor((t-this.y)/this.itemHeight),i=0;i<this.items.length;i++)this.items[i].hover=r&&i==s?!0:!1;return r},i.prototype.click=function(n){var r=n.clientX,t=n.clientY-50,i=Math.floor((t-this.y)/this.itemHeight);this.items[i].click()},i}();i.RightClickMenu=u})(i=t.RightClickMenus||(t.RightClickMenus={}))})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i;(function(t){var i=function(i){function r(r){i.call(this);this.items=[new t.ClickableMenuItem("open",function(){n.Managers.ProjectManager.Instance.openProjectFromID(n.RightClickMenuService.Instance.Menu.fileID)}),new t.ClickableMenuItem("open in new tab",function(){n.Managers.PageManager.Current.openNewPage(n.Managers.Page.Score,n.RightClickMenuService.Instance.Menu.fileID)}),new t.ClickableMenuItem("properties",function(){var t=n.RightClickMenuService.Instance.Menu.fileID,i=n.getItemFromID(n.Managers.ProjectManager.Instance.allProjects,t);n.ProjectOptionsService.Instance.open(i)}),new t.ClickableMenuItem("download",function(){var i=n.RightClickMenuService.Instance.Menu.fileID,r=n.getItemFromID(n.Managers.ProjectManager.Instance.allProjects,i),t=n.ProjectConverter.compress(r);n.Storage.download(t.name+".score",JSON.stringify(t))}),new t.ClickableMenuItem("delete",function(){n.Managers.ProjectManager.Instance.deleteProjectByID(n.RightClickMenuService.Instance.Menu.fileID)})];this.fileID=r}return __extends(r,i),r}(t.RightClickMenu);t.RightClickFile=i})(i=t.RightClickMenus||(t.RightClickMenus={}))})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i;(function(t){var i=function(i){function r(){i.call(this);this.items.unshift(new t.ClickableMenuItem("properties",function(){var t=n.Managers.ProjectManager.Instance.currentProject;n.ProjectOptionsService.Instance.open(t)}));this.items.unshift(new t.ClickableMenuItem("add a bar",function(){n.NoteControlService.Instance.addBar();n.ScoringService.Instance.refresh()}));this.items.unshift(new t.ClickableMenuItem("edit instruments",function(){n.InstrumentService.Instance.openInstrumentEditor()}));this.items.unshift(new t.ClickableMenuItem("add instrument",function(){n.InstrumentService.Instance.addInstrument()}));this.items.push(new t.ClickableMenuItem("print",function(){n.PrintService.Instance.print()}));this.items.push(new t.ClickableMenuItem("note count",function(){Modal.generateProjectReport()}))}return __extends(r,i),r}(t.RightClickMenu);t.RightClickScore=i})(i=t.RightClickMenus||(t.RightClickMenus={}))})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(){function t(n,t,i){this.running=!1;this.position=n;this.velocity=t;this.radius=i}return Object.defineProperty(t.prototype,"acceleration",{get:function(){return this.running?-.02:.002*this.radius},enumerable:!0,configurable:!0}),t.prototype.update=function(t){this.position.x+=this.velocity.x;this.position.y+=this.velocity.y;var i=new n.Maths.Vector2(t.x-this.position.x,t.y-this.position.y),u=i.abs,r=.002;this.running?(this.velocity.x+=i.x*this.acceleration-this.velocity.x*r,this.velocity.y+=i.y*this.acceleration-this.velocity.y*r):(this.velocity.x+=i.x/u*this.acceleration-this.velocity.x*r,this.velocity.y+=i.y/u*this.acceleration-this.velocity.y*r)},t.prototype.draw=function(n){n.beginPath();var t=n.createRadialGradient(this.position.x,this.position.y,10,this.position.x,this.position.y,this.radius);t.addColorStop(0,"rgba(0,0,0,1)");t.addColorStop(1,"rgba(0,0,0,0.0)");n.fillStyle=t;n.arc(this.position.x,this.position.y,this.radius,0,2*Math.PI);n.fill()},t}(),r;t.Metaball=i;r=function(){function t(t,r){var e;this.ended=!1;var o=r.width,s=r.height,h=o/2,c=s/2,u=Math.min(o,s,600);for(this.metaballs=[],e=0;e<t;e++){var l=h+u*Math.random()-u/2,a=c+u*Math.random()-u/2,v=new n.Maths.Vector2(l,a),f=4,y=f*Math.random()-f/2,p=f*Math.random()-f/2,w=new n.Maths.Vector2(y,p),b=30+u/4*Math.random(),k=new i(v,w,b);this.metaballs.push(k)}}return t.prototype.update=function(t,i){for(var e,r,f=new n.Maths.Vector2(t,i),u=0;u<this.metaballs.length;u++)this.metaballs[u].update(f);if(this.ended){for(e=[],u=0;u<this.metaballs.length;u++)r=this.metaballs[u],r.position.x+r.radius<0||r.position.x-r.radius>f.x*2||r.position.y+r.radius<0||r.position.y-r.radius>f.y*2||e.push(r);this.metaballs=e}},t.prototype.metabalise=function(n,t){for(var u,i=n.getImageData(0,0,t.width,t.height),f=i.data,r=0;r<f.length;r+=4)u=f[r+3],u<180&&(u=0),i.data[r+3]=u;n.putImageData(i,0,0);delete i.data},t.prototype.draw=function(n,t){for(var i=0;i<this.metaballs.length;i++)this.metaballs[i].draw(n);this.metabalise(n,t)},t.prototype.end=function(){this.ended=!0;for(var n=0;n<this.metaballs.length;n++)this.metaballs[n].running=!0},t}();t.MetaballList=r})(t=n.Landing||(n.Landing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(){function i(){(this.ended=!1,this.canvas=document.getElementById("landing-canvas"),this.ctx=this.canvas.getContext("2d"),n.Managers.MachineManager.Instance.machineType==n.Managers.MachineType.Desktop)&&(this.canvas.width=this.canvas.parentElement.clientWidth,this.canvas.height=this.canvas.parentElement.clientHeight,this.metaballs=new t.MetaballList(20,this.canvas),this.run())}return Object.defineProperty(i,"Instance",{get:function(){return i._instance||(i._instance=new i),i._instance},enumerable:!0,configurable:!0}),i.prototype.run=function(){if(this.metaballs.metaballs.length===0){FrontEnd.hideElement(this.canvas.parentElement);return}if(this.canvas.parentElement.className.indexOf("hidden")==-1){this.canvas.width=this.canvas.parentElement.clientWidth;this.canvas.height=this.canvas.parentElement.clientHeight;this.metaballs.update(this.canvas.width/2,this.canvas.height/2);this.metaballs.draw(this.ctx,this.canvas);var n=this;window.requestAnimationFrame(function(){n.run()})}},i.prototype.hide=function(){n.Managers.MachineManager.Instance.machineType!=n.Managers.MachineType.Desktop&&(this.canvas.parentElement.className+=" hidden");this.ended=!0;n.Managers.MachineManager.Instance.machineType==n.Managers.MachineType.Desktop&&(this.metaballs.end(),this.canvas.parentElement.className+=" faded")},i}();t.Landing=i})(t=n.Landing||(n.Landing={}))}(Inknote||(Inknote={})),function(n){var t;(function(n){n.GRAVITY=.4})(t=n.DropCanvas||(n.DropCanvas={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){function u(n,t,r){for(var e,o,f=[],u=0;u<n.length;u++)e=n[u].update(r),e&&(o=n[u].getClosestSpring(t),f.push(new i(o.index,5*n[u].velocity)));return f}function f(n,t){for(var i=0;i<n.length;i++)n[i].draw(t)}var r=function(){function i(n,i){this.x=n;this.y=i;this.tilt=Math.random()*2*Math.PI;this.velocity=0;this.acceleration=t.GRAVITY;this.removeThis=!1}return i.prototype.draw=function(t){var i=this,u,r;t.translate(i.x,i.y);t.rotate(i.tilt);t.translate(-i.x,-i.y);u=t.createLinearGradient(i.x-50,i.y-50,i.x+50,i.y+50);r=20;u.addColorStop(0,n.Drawing.Colours.tan);u.addColorStop(1,n.Drawing.Colours.peach);t.fillStyle=u;t.beginPath();t.moveTo(i.x-50,i.y+50);t.lineTo(i.x+50,i.y+50);t.lineTo(i.x+50,i.y-50);t.lineTo(i.x-r,i.y-50);t.lineTo(i.x-50,i.y-r);t.fill();t.beginPath();t.moveTo(i.x-(r+4),i.y-45);t.lineTo(i.x-45,i.y-45);t.lineTo(i.x-45,i.y-(r+4));t.strokeStyle=n.Drawing.Colours.black;t.fillStyle=n.Drawing.Colours.white;t.fill();t.stroke();t.translate(i.x,i.y);t.rotate(-i.tilt);t.translate(-i.x,-i.y)},i.prototype.getClosestSpring=function(n){for(var i,r=null,u=Infinity,t=0;t<n.length;t++)i=Math.abs(n[t].x-this.x),i<u&&(r=n[t],u=i);return r},i.prototype.update=function(n){var t=!1;return this.y+=this.velocity,this.velocity+=this.acceleration,this.tilt+=.01,n<this.y&&(t=!0),this.removeThis&&(t=!1),t&&(this.removeThis=!0),t},i}(),i;t.DropFile=r;i=function(){function n(n,t){this.index=n;this.strength=t}return n}();t.Splash=i;t.updateFiles=u;t.drawFiles=f})(t=n.DropCanvas||(n.DropCanvas={}))}(Inknote||(Inknote={})),function(n){var t;(function(n){function i(n){for(var t=0;t<n.length;t++)n[t].update();var i=[],r=[],u=.1;for(t=0;t<n.length;t++)t>0&&(i[t]=u*(n[t].y-n[t-1].y),n[t-1].velocity+=i[t]),t<n.length-1&&(r[t]=u*(n[t].y-n[t+1].y),n[t+1].velocity+=r[t]);for(t=0;t<n.length;t++)t>0&&(n[t-1].y+=i[t]),t<n.length-1&&(n[t+1].y+=r[t])}var t=function(){function n(n,t,i,r){this.x=n;this.baseY=t;this.bottomY=i;this.index=r;this.y=20*Math.random()-10;this.tension=.01;this.dampeningFactor=.0001;this.velocity=1*Math.random()-.5}return Object.defineProperty(n.prototype,"acceleration",{get:function(){return-this.y*this.tension-this.velocity*this.dampeningFactor},enumerable:!0,configurable:!0}),n.prototype.update=function(){this.y+=this.velocity;this.velocity+=this.acceleration},n}();n.Spring=t;n.updateSprings=i})(t=n.DropCanvas||(n.DropCanvas={}))}(Inknote||(Inknote={})),function(n){var t;(function(n){var t=function(){function t(n,t,i){this.r=i;this.position=n;this.velocity=t}return Object.defineProperty(t.prototype,"orientation",{get:function(){return Math.atan2(this.velocity.y,this.velocity.x)},enumerable:!0,configurable:!0}),t.prototype.update=function(){this.position.y+=this.velocity.y;this.position.x+=this.velocity.x;this.velocity.y+=n.GRAVITY},t.prototype.draw=function(n){n.beginPath();var i=this.r,r=this.position.x,u=this.position.y,t=this.orientation,f=Math.min(this.velocity.abs/2,4*i);n.beginPath();n.fillStyle="black";n.arc(r,u,i,t-Math.PI/2,t+Math.PI/2);n.lineTo(r+3*f*Math.cos(t+Math.PI),u+3*f*Math.sin(t+Math.PI));n.fill()},t}();n.Droplet=t})(t=n.DropCanvas||(n.DropCanvas={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(){function i(){this.maxSplashTime=200;this.running=!1;this.dropped=!1;this.splashed=!1;this.splashCounter=0;this.finished=!1;this.segmentSize=15;this.springs=[];this.files=[];this.droplets=[];this.splashTime=0}return Object.defineProperty(i,"Instance",{get:function(){return i._instance||(i._instance=new i),i._instance},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"canvas",{get:function(){return this._canvas||(this._canvas=document.getElementById("drag-drop-canvas")),this._canvas},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"ctx",{get:function(){return this._ctx||(this._ctx=this.canvas.getContext("2d")),this._ctx},enumerable:!0,configurable:!0}),i.prototype.start=function(){var r,i,u;if(this.running!=!0){for(this.running=!0,this.dropped=!1,this.splashed=!1,this.splashCounter=0,this.finished=!1,n.Landing.Landing.Instance.ended===!1&&n.Landing.Landing.Instance.hide(),FrontEnd.showElement(document.getElementById("drag-drop")),this.canvas.width=this.canvas.parentElement.clientWidth,this.canvas.height=this.canvas.parentElement.clientHeight,r=Math.floor(this.canvas.width/this.segmentSize),this.springs=[],this.files=[],this.droplets=[],this.springBaseSize=this.canvas.height/6,i=0;i<=r+1;i++)this.springs.push(new t.Spring(i*this.segmentSize,this.springBaseSize,this.canvas.height,i));u=this;this.draw(u)}},i.prototype.draw=function(i){var u,f,e,r;if(i.running==!1){FrontEnd.hideElement(document.getElementById("drag-drop"));return}for(i.ctx.clearRect(0,0,i.canvas.width,i.canvas.height),u=t.updateFiles(i.files,i.springs,i.canvas.height-i.springBaseSize),r=0;r<u.length;r++)i.splash(u[r].index,u[r].strength);for(f=[],r=0;r<i.files.length;r++)i.files[r].y<i.canvas.height?f.push(i.files[r]):i.splashed=!0;for(i.splashed==!0&&(i.splashCounter++,i.splashCounter>i.maxSplashTime&&(i.finished=!0,i.stop())),i.files=f,t.drawFiles(i.files,i.ctx),e=[],r=0;r<i.droplets.length;r++)i.droplets[r].update(),i.droplets[r].draw(i.ctx),i.droplets[r].position.y<i.canvas.height&&e.push(i.droplets[r]);for(i.droplets=e,i.splashTime==0&&i.splash(Math.floor(Math.random()*i.springs.length),2*Math.random()),i.splashTime=(i.splashTime+1)%4,i.ctx.beginPath(),i.ctx.moveTo(0,i.canvas.height),t.updateSprings(i.springs),r=0;r<i.springs.length;r++)i.ctx.lineTo(i.springs[r].x,i.springs[r].bottomY-i.springs[r].baseY-i.springs[r].y);i.ctx.lineTo(i.canvas.width,i.canvas.height);i.ctx.lineTo(0,i.canvas.height);i.ctx.fillStyle=n.Drawing.Colours.black;i.ctx.strokeStyle=n.Drawing.Colours.black;i.ctx.fill();i.ctx.stroke();i.running==!0?window.requestAnimationFrame(function(){i.draw(i)}):FrontEnd.hideElement(document.getElementById("drag-drop"))},i.prototype.drop=function(n,i){this.dropped=!0;this.files.push(new t.DropFile(n,i))},i.prototype.stop=function(){(!this.dropped||this.finished)&&(this.running=!1,FrontEnd.hideElement(document.getElementById("drag-drop")))},i.prototype.splash=function(i,r){var u;if(i>=0&&i<this.springs.length&&(this.springs[i].velocity=-r),r>10)for(u=0;u<Math.floor(r/2);u++){var f=new n.Maths.Vector2(i*this.segmentSize,this.canvas.height),e=new n.Maths.Vector2(10*Math.random()-5,-r*Math.random()/4),o=new t.Droplet(f,e,5*Math.random());this.droplets.push(o)}},i}();t.DropCanvas=i})(t=n.DropCanvas||(n.DropCanvas={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(){function i(){this.ID=n.getID();this.x=0;this.y=500;this.width=500;this.height=100;this.order=199}return i.prototype.isOver=function(){return!1},i.prototype.draw=function(n){return n.globalAlpha=.5,n.beginPath(),n.fillStyle=t.Colours.black,n.strokeStyle=t.Colours.black,n.rect(this.x,this.y,this.width,this.height),n.fill(),n.stroke(),n.globalAlpha=1,!0},i}();t.NoteControlBackground=i})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){function e(t){var i="";switch(t){case n.Model.NoteValue.A:i="h";break;case n.Model.NoteValue.Bb:i="u";break;case n.Model.NoteValue.B:i="j";break;case n.Model.NoteValue.C:i="a";break;case n.Model.NoteValue.Db:i="w";break;case n.Model.NoteValue.D:i="s";break;case n.Model.NoteValue.Eb:i="e";break;case n.Model.NoteValue.E:i="d";break;case n.Model.NoteValue.F:i="f";break;case n.Model.NoteValue.Gb:i="t";break;case n.Model.NoteValue.G:i="g";break;case n.Model.NoteValue.Ab:i="y"}return i.toUpperCase()}var i,r,u,f;(function(n){n[n.WHITE=0]="WHITE";n[n.BLACK=1]="BLACK";n[n.UNASSIGNED=2]="UNASSIGNED"})(t.PianoKeyColour||(t.PianoKeyColour={}));i=t.PianoKeyColour;r=function(){function r(n,t,r,u,f){this.x=n;this.y=t;this.width=r;this.height=u;this.noteValue=f;this.colour=i.UNASSIGNED;this.hover=!1}return r.prototype.isOver=function(n,t){var i=n>this.x,r=n<this.x+this.width,u=t>this.y,f=t<this.y+this.height;return i&&r&&u&&f},r.prototype.draw=function(r){if(r.beginPath(),r.fillStyle=t.Colours.white,r.strokeStyle=t.Colours.black,this.colour==i.BLACK&&(r.fillStyle=t.Colours.black),this.hover==!0&&(r.fillStyle=t.Colours.orange),r.rect(this.x,this.y,this.width,this.height),r.fill(),r.stroke(),n.Managers.MachineManager.Instance.machineType==n.Managers.MachineType.Desktop){r.beginPath();var u=e(this.noteValue);r.textAlign="center";r.font=Math.min(this.width*12/20,this.height/4)+"px Arial";r.fillStyle=this.colour==i.WHITE?t.Colours.black:t.Colours.white;r.fillText(u,this.x+this.width/2,this.y+this.height-2)}},r}();t.PianoKey=r;u=function(n){function t(){n.apply(this,arguments);this.colour=i.WHITE}return __extends(t,n),t}(r);t.WhiteKey=u;f=function(n){function t(){n.apply(this,arguments);this.colour=i.BLACK}return __extends(t,n),t}(r);t.BlackKey=f})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(){function i(){this.ID=n.getID();this.x=0;this.y=500;this.width=500;this.height=100;this.order=200;this.leftHover=!1;this.rightHover=!1;this.octave=4;this.blackKeys=[];this.whiteKeys=[]}return Object.defineProperty(i.prototype,"allKeys",{get:function(){return this.whiteKeys.concat(this.blackKeys)},enumerable:!0,configurable:!0}),i.prototype.isOver=function(n,t){var u=t>this.y&&t<this.y+this.height&&n<this.x+this.width,r,i;if(this.leftHover=!1,this.rightHover=!1,u){for(n<this.width/9?this.leftHover=!0:n>this.width*8/9&&(this.rightHover=!0),r=!1,i=0;i<this.blackKeys.length;i++)this.blackKeys[i].isOver(n,t)?(this.blackKeys[i].hover=!0,r=!0):this.blackKeys[i].hover=!1;for(i=0;i<this.whiteKeys.length;i++)this.whiteKeys[i].hover=r===!1&&this.whiteKeys[i].isOver(n,t)?!0:!1}else for(i=0;i<this.allKeys.length;i++)this.allKeys[i].hover=!1;return u},i.prototype.draw=function(n){var i;n.globalAlpha=.5;n.beginPath();n.fillStyle=t.Colours.white;n.strokeStyle=t.Colours.black;n.rect(this.x,this.y,this.width,this.height);n.fill();n.stroke();n.textBaseline="base";var r=2,u=0,f=0;for(i=1;i<9;i++)n.beginPath(),n.strokeStyle=t.Colours.black,i==1&&this.leftHover?(n.beginPath(),n.fillStyle=t.Colours.orange,n.rect(0,this.y,this.width/9,this.height),n.fill()):i==8&&this.rightHover&&(n.beginPath(),n.fillStyle=t.Colours.orange,n.rect(this.width*8/9,this.y,this.width/9,this.height),n.fill()),i!=8&&(r=(r+1)%12,this.whiteKeys[u]==null&&this.whiteKeys.push(new t.WhiteKey(this.width*i/9,this.y,this.width/9,this.height,r)),this.whiteKeys[u].x=this.width*i/9,this.whiteKeys[u].y=this.y,this.whiteKeys[u].width=this.width/9,this.whiteKeys[u].height=this.height,u++),(i==1||i==2||i==4||i==5||i==6)&&(r=(r+1)%12,this.blackKeys[f]==null&&this.blackKeys.push(new t.BlackKey(this.width*(i+1)/9-this.width/24,this.y,this.width/12,this.height/2,r)),this.blackKeys[f].x=this.width*(i+1)/9-this.width/24,this.blackKeys[f].y=this.y,this.blackKeys[f].width=this.width/12,this.blackKeys[f].height=this.height/2,f++);for(i=0;i<this.whiteKeys.length;i++)this.whiteKeys[i].draw(n);for(i=0;i<this.blackKeys.length;i++)n.globalAlpha=1,this.blackKeys[i].draw(n),n.globalAlpha=.5;return n.strokeStyle=t.Colours.black,n.beginPath(),n.moveTo(this.width/15,this.y+this.height*3/4),n.lineTo(this.width/20,this.y+this.height/2),n.lineTo(this.width/15,this.y+this.height/4),n.stroke(),n.beginPath(),n.moveTo(this.width-this.width/15,this.y+this.height*3/4),n.lineTo(this.width-this.width/20,this.y+this.height/2),n.lineTo(this.width-this.width/15,this.y+this.height/4),n.stroke(),n.beginPath(),n.textAlign="center",n.fillStyle=t.Colours.black,n.font=Math.min(this.width/20,this.height/4)+"px Arial",n.fillText("C"+this.octave,this.width/6,this.y+this.height*3/4),n.globalAlpha=1,!0},i.prototype.click=function(i){if(i.clientX<this.width/9)this.octave--;else if(i.clientX>this.width*8/9)this.octave++;else for(var r=0;r<this.allKeys.length;r++)this.allKeys[r].hover==!0&&(n.ScoringService.Instance.selectID==null||n.ScoringService.Instance.SelectedItem instanceof t.Bar?n.NoteControlService.Instance.addNote(new n.Model.Note(this.allKeys[r].noteValue,this.octave,n.NoteControlService.Instance.lengthControl.selectedLength)):n.NoteControlService.Instance.editNoteValueAndOctave(this.allKeys[r].noteValue,this.octave))},i}();t.Piano=i})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(){function i(){this.ID=n.getID();this.x=0;this.y=500;this.width=500;this.height=100;this.order=200;this.attached=[];this.selectedLength=3;this.attached.push(new t.Breve(!0));this.attached.push(new t.SemiBreve(!0));this.attached.push(new t.Minim(!0));this.attached.push(new t.Crotchet(!0));this.attached.push(new t.Quaver(!0));this.attached.push(new t.SemiQuaver(!0));this.attached.push(new t.DemiSemiQuaver(!0));this.attached.push(new t.HemiDemiSemiQuaver(!0))}return i.prototype.isOver=function(n,t){return t>this.y&&t<this.y+this.height&&n<this.x+this.width},i.prototype.click=function(i){for(var u,f=i.clientX,e=this.width/8,r=0;r<8;r++)f>r*e&&f<(r+1)*e&&(this.selectedLength=r);u=n.ScoringService.Instance.SelectedItem;u!=null&&(u instanceof t.Note||u instanceof t.Rest)&&n.NoteControlService.Instance.editNoteLength()},i.prototype.draw=function(n,i){var f,u,r;for(n.globalAlpha=.5,n.beginPath(),n.fillStyle=t.Colours.white,n.rect(this.x,this.y,this.width,this.height),n.fill(),f=this.width,u=f/8,r=0;r<8;r++)n.beginPath(),n.fillStyle=t.Colours.white,this.selectedLength==r&&(n.fillStyle=t.Colours.orange),n.strokeStyle=t.Colours.black,n.rect(r*u,this.y,u,this.height),n.fill(),n.stroke(),this.attached[r].y=this.y+this.height*3/4,this.attached[r].x=r*u+u/2,this.attached[r].draw(n,i);return n.globalAlpha=1,!0},i}();t.LengthControlBar=i})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(){function i(){this.x=0;this.y=500;this.width=500;this.height=100;this.order=200;this.attached=[];this.ID="note_control";this.selectedLength=3}return i.prototype.isOver=function(n,t){var i=t>this.y&&t<this.y+this.height&&n<this.x+this.width&&n>this.x;return this.hover=i,i},i.prototype.click=function(t){var i=t.clientX;n.NoteControlService.Instance.addRest()},i.prototype.draw=function(i){i.globalAlpha=.5;i.beginPath();i.fillStyle=t.Colours.white;this.hover&&(i.fillStyle=t.Colours.orange);i.rect(this.x,this.y,this.width,this.height);i.fill();var u=new n.Model.Rest(n.NoteControlService.Instance.lengthControl.selectedLength),r=n.getDrawingItemFromRest(u);return r.y=this.y+this.height/2,r.x=this.x+this.width/2,r.draw(i),!0},i}();t.RestControl=i})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(){function i(){this.x=0;this.y=500;this.width=500;this.height=100;this.order=200;this.attached=[];this.ID="note_control";this.selectedLength=3}return i.prototype.isOver=function(n,t){var i=t>this.y&&t<this.y+this.height&&n<this.x+this.width&&n>this.x;return this.hover=i,i},i.prototype.click=function(){n.NoteControlService.Instance.deleteSelected()},i.prototype.draw=function(n){n.globalAlpha=.5;n.beginPath();n.fillStyle=t.Colours.white;this.hover&&(n.globalAlpha=.7);n.rect(this.x,this.y,this.width,this.height);n.fill();n.beginPath();var i=10;return n.lineWidth=4,this.hover&&(n.lineWidth=6,i=12),n.globalAlpha=255,n.strokeStyle=t.Colours.brightRed,n.moveTo(this.x+this.width/2-i,this.y+this.height/2-i),n.lineTo(this.x+this.width/2+i,this.y+this.height/2+i),n.moveTo(this.x+this.width/2-i,this.y+this.height/2+i),n.lineTo(this.x+this.width/2+i,this.y+this.height/2-i),n.stroke(),n.lineWidth=1,!0},i}();t.DeleteNoteControl=i})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(){function i(){this.ID=n.getID();this.x=0;this.y=0;this.width=0;this.height=0;this.order=200}return i.prototype.isOver=function(n,t){var r=n<this.x+this.width,u=n>this.x,f=t<this.y+this.height,e=t>this.y,i=r&&u&&f&&e;return this.hover=i,i},i.prototype.click=function(){n.NoteControlService.Instance.hidden?n.NoteControlService.Instance.show():n.NoteControlService.Instance.hide()},i.prototype.draw=function(i){return i.beginPath(),i.fillStyle=t.Colours.black,this.hover&&(i.fillStyle=t.Colours.orange),i.rect(this.x,this.y,this.width,this.height),i.fill(),i.beginPath(),i.fillStyle=t.Colours.white,i.textAlign="center",i.font=t.Fonts.standard,i.textBaseline="middle",n.NoteControlService.Instance.hidden?i.fillText("+",this.x+this.width/2,this.y+this.height/2):i.fillText("-",this.x+this.width/2,this.y+this.height/2),i.textBaseline="bottom",!0},i}();t.Minimise=i})(t=n.Drawing||(n.Drawing={}))}(Inknote||(Inknote={})),function(n){function t(n,t){if(typeof window!=typeof undefined){var i=document.getElementById("log"),r=document.createElement("div");r.className=t;r.textContent=n;r.onclick=function(n){var t=n.target;t.remove()};i.appendChild(r);setTimeout(function(){if(i.hasChildNodes()){var n=i.childNodes[0];i.removeChild(n)}},3e3)}}function r(r,u){if(u==i.Error){console.log("%c"+r,"color:red");t(r,"error");return}var f=n.TempDataService?n.TempDataService.Instance.currentData.loggingLevel:3;u==i.Warning?(console.log("%c"+r,"color: orange"),f>=2&&t(r,"warning")):(console.log(r),f>=3&&t(r,"entry"))}(function(n){n[n.Error=0]="Error";n[n.Text=1]="Text";n[n.Warning=2]="Warning"})(n.MessageType||(n.MessageType={}));var i=n.MessageType;n.log=r}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(){function t(){}return Object.defineProperty(t,"Instance",{get:function(){return t._instance||(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_cookieJSON",{get:function(){var n,t;return typeof document==typeof undefined?{}:(n=document.cookie,n==""||n==null)?{}:(t=JSON.parse(n),typeof t!="object")?{}:t},enumerable:!0,configurable:!0}),t.prototype.getItem=function(n){return this._cookieJSON[n]},t.prototype._setStringItem=function(t,i){var r=this._cookieJSON;r[t]=i;document.cookie=JSON.stringify(r);n.log("saved "+t)},t.prototype.setItem=function(t,i){typeof i!="string"&&(i=JSON.stringify(i));try{this._setStringItem(t,i)}catch(r){n.log("saving cookie failed.",n.MessageType.Warning);console.log(r)}},t}();t.CookieManager=i})(t=n.Storage||(n.Storage={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){function r(t){return typeof localStorage=="undefined"?(n.log("Local storage is undefined",n.MessageType.Error),null):JSON.parse(localStorage.getItem("inknote-"+t))}function u(t,i){if(!n.Managers.SettingsManager.Current.testMode){if(!localStorage)return n.log("Local storage is undefined",n.MessageType.Error),null;localStorage.setItem("inknote-"+t,JSON.stringify(i))}}function f(){if(n.Managers.SettingsManager.Current.testMode)return[];var t=r(i.settings);return t instanceof Array==!0&&n.allItemsAre(t,function(t){return t instanceof n.Setting})?t:(n.log("localStorage settings are not saved in the correct format",n.MessageType.Warning),[])}function e(){if(n.Managers.SettingsManager.Current.testMode)return[n.Testing.$TEST$_compressedProject];var t=r(i.projects);return t instanceof Array==!0&&n.allItemsAre(t,function(n){return!!n.ID&&!!n.name})?t:(n.log("localStorage projects are not saved in the correct format"),[])}function o(t){var f,r;if(u(i.projects,t),n.Managers.PluginManager)for(f=n.getItemsWhere(n.Managers.PluginManager.Instance.plugins,function(n){return n.active&&n.allowOnSave&&n.onSave!=null}),r=0;r<f.length;r++)f[r].onSave();n.log("saved projects")}function s(){u(i.plugins,n.Managers.PluginManager.Instance.getCompressedPlugins());n.log("saved plugins")}function h(){var n=r(i.plugins);return n==null||n==undefined?[]:n}function c(){u(i.synths,n.Audio.SynthManager.Instance.getSynths());n.log("saved synths")}function l(){var t=r(i.synths),e,u,f;if(t==null||t==undefined)return[];for(e=[],u=0;u<t.length;u++)f=new n.Audio.Synth(t[u].name),f.gain=t[u].gain,f.ID=t[u].ID,f.name=t[u].name,f.oscillatorType=t[u].oscillatorType,e.push(f);return e}function a(){u(i.temp,n.TempDataService.Instance.currentData);n.log("saved temp data")}function v(){var t=r(i.temp);return t==null||t==undefined?new n.TempData:t}var i={settings:"settings",projects:"projects",plugins:"plugins",synths:"synths",temp:"temp"};t.getSettings=f;t.getProjects=e;t.saveProjects=o;t.savePlugins=s;t.getPlugins=h;t.saveSynths=c;t.getSynths=l;t.saveTemp=a;t.getTemp=v})(t=n.Storage||(n.Storage={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){function i(n,t){var i=document.createElement("a");i.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t));i.setAttribute("download",n);i.style.display="none";document.body.appendChild(i);i.click();document.body.removeChild(i)}if(typeof document!="undefined"){document.body.ondrag=function(){return!1};document.body.ondrop=function(t){var u,e,i,r,f;for(t.preventDefault(),n.DropCanvas.DropCanvas.Instance.drop(t.clientX,t.clientY),u=t.dataTransfer.files,e=t.dataTransfer.getData("utf8"),i=0;i<u.length;i++)r=u[i],f=new FileReader,f.onload=function(t){var i,u,f,e;if(console.log(t.target),n.log("loaded"),i=r,u=t.target.result,i.name.indexOf(".score")==-1)n.log("incorrect file type",n.MessageType.Error),n.check("'"+r.name+"' is of an incorrect fileType. Only .score files are accepted",null);else try{f=JSON.parse(u);e=n.ProjectConverter.decompress(f);n.Managers.ProjectManager.Instance.addProject(e,function(t){n.Managers.ProjectManager.Instance.setCurrentProject(t.ID)})}catch(t){n.log("incorrect file format",n.MessageType.Error)}},f.readAsText(r);return!1};document.body.ondragend=function(t){return t.preventDefault(),n.DropCanvas.DropCanvas.Instance.drop(t.clientX,t.clientY),!1};document.body.ondragstart=function(n){return n.preventDefault(),!1};document.body.ondragenter=function(n){return n.preventDefault(),!1};document.body.ondragover=function(t){return t.preventDefault(),n.DropCanvas.DropCanvas.Instance.start(),!1};document.getElementById("drag-drop-canvas").ondragleave=function(t){return t.preventDefault(),n.DropCanvas.DropCanvas.Instance.stop(),!1}}t.download=i})(t=n.Storage||(n.Storage={}))}(Inknote||(Inknote={})),function(n){var t=function(){function t(){}return Object.defineProperty(t,"Instance",{get:function(){return t._instance||(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentData",{get:function(){return this._currentData||(this._currentData=n.Storage.getTemp()),this._currentData},enumerable:!0,configurable:!0}),t.prototype.update=function(){n.Storage.saveTemp()},t}();n.TempDataService=t}(Inknote||(Inknote={})),function(n){function t(t,i,r){var e,o,l,u,s,f,h,c;n.CONFIRM_IS_OPEN=!0;e=document.getElementById("confirm-cover");FrontEnd.showElement(e);o=document.getElementById("confirm-box");FrontEnd.showElement(o);l=document.getElementById("confirm-text");l.innerText=t;u=document.getElementById("confirm-ok");s=function(){FrontEnd.hideElement(o);FrontEnd.hideElement(e);i&&i();setTimeout(function(){n.CONFIRM_IS_OPEN=!1},300)};u.onclick=s;u.onmouseup=function(){u.removeEventListener("click",s)};u.focus();f=document.getElementById("confirm-cancel");h=function(n){n.preventDefault();u.focus()};f.onblur=h;c=function(){FrontEnd.hideElement(o);FrontEnd.hideElement(e);r&&r();setTimeout(function(){n.CONFIRM_IS_OPEN=!1},300)};f.onclick=c;f.onmouseup=function(){f.removeEventListener("click",c);f.removeEventListener("blur",h)}}n.CONFIRM_IS_OPEN=!1;n.check=t}(Inknote||(Inknote={})),function(n){function t(n,t){for(var i=0;i<n.length;i++)if(n[i].ID==t)return i;return null}function i(n,t){for(var i=0;i<n.length;i++)if(n[i].ID==t)return n[i];return null}n.getIndexFromID=t;n.getItemFromID=i}(Inknote||(Inknote={})),function(n){function i(i){if(i&&t.Instance.y-t.Instance.scrollSpeed<0)return t.Instance.y=0,!1;if(i)return!0;switch(n.Managers.PageManager.Current.page){case n.Managers.Page.File:var u=n.Managers.ProjectManager.Instance.allProjects.length,r={x:window.innerWidth,y:window.innerHeight-100},f=Math.floor(r.x/200),e=Math.ceil(u/f)*200+100;return e>t.Instance.y+t.Instance.scrollSpeed+r.y;case n.Managers.Page.Score:return t.Instance.y<n.ScoringService.Instance.maxScrollPosition;default:return!1}}n.canScroll=i;var t=function(){function t(){this.x=0;this.y=0;this.scrollSpeed=30}return Object.defineProperty(t,"Instance",{get:function(){return t._instance||(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ScrollBar",{get:function(){if(n.Managers.PageManager.Current.page!=t._lastPageType){t._lastPageType=n.Managers.PageManager.Current.page;switch(t._lastPageType){case n.Managers.Page.File:t._scrollBar=new n.Drawing.ScrollBar.FileScroll;break;case n.Managers.Page.Score:t._scrollBar=new n.Drawing.ScrollBar.ProjectScroll;break;case n.Managers.Page.Form:case n.Managers.Page.List:default:t._scrollBar=new n.Drawing.ScrollBar.ScrollBar}}return t._scrollBar},enumerable:!0,configurable:!0}),t.prototype.showScrollBar=function(){return!1},t.prototype.up=function(){i(!0)&&(this.y=this.y-this.scrollSpeed)},t.prototype.down=function(){i(!1)&&(this.y=Math.max(0,this.scrollSpeed+this.y))},t}();n.ScrollService=t}(Inknote||(Inknote={})),function(n){var t=function(){function t(){this.drawing=new n.Drawing.Licence}return Object.defineProperty(t,"Instance",{get:function(){return t._instance||(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t}();n.LicenceService=t}(Inknote||(Inknote={})),function(n){function t(n){return n.sort(function(n,t){return n.order-t.order}),n}function i(t,i,r){var u=n.ScrollService.Instance;return t.isOver(i.clientX-u.x,i.clientY-50,r)}n.sortByOrder=t;n.mouseIsOver=i}(Inknote||(Inknote={})),function(n){var t=function(){function t(){}return Object.defineProperty(t,"Instance",{get:function(){return t._instance||(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.copyItem=function(t){return t instanceof n.Model.Note?n.getNoteOfDistance(t,0):t instanceof n.Model.Rest?new n.Model.Rest(t.length):t instanceof n.Model.Text?new n.Model.Text(t.content):null},t.prototype.copyDrawItem=function(t){for(var r,o,f,e,u=n.Managers.ProjectManager.Instance.currentProject,i=0;i<u.instruments.length;i++)for(r=0;r<u.instruments[i].bars.length;r++)for(o=u.instruments[i].bars[r],f=0;f<o.items.length;f++)if(e=u.instruments[i].bars[r].items[f],e.ID==t.ID)return this.copyItem(e);return null},t.prototype.copy=function(){var i,t,u;if(this.clipboard=[],i=n.ScoringService.Instance.SelectedItem,i instanceof n.Drawing.Bar){var f=new n.Model.Bar,e=n.Managers.ProjectManager.Instance.currentProject,r=null;for(t=0;t<e.instruments.length;t++)if(r=n.getItemFromID(e.instruments[t].bars,i.ID),r!=null)break;for(t=0;t<r.items.length;t++)u=this.copyItem(r.items[t]),u&&f.items.push(u);this.clipboard.push(f);return}this.clipboard.push(this.copyDrawItem(i));return},t.prototype.cut=function(){this.copy();n.NoteControlService.Instance.deleteSelected()},t.prototype.pasteItem=function(t){var f=n.ScoringService.Instance.SelectedItem,u,r,i;if(n.ScoringService.Instance.SelectedItem instanceof n.Drawing.Bar){for(u=n.Managers.ProjectManager.Instance.currentProject,r=null,i=0;i<u.instruments.length;i++)if(r=n.getItemFromID(u.instruments[i].bars,f.ID),r!=null)break;if(r.items=[],t instanceof n.Model.Bar)for(i=0;i<t.items.length;i++)r.items.push(this.copyItem(t.items[i]))}},t.prototype.paste=function(){n.UndoService.Instance.store();for(var t=0;t<this.clipboard.length;t++)this.pasteItem(this.clipboard[t]);n.ScoringService.Instance.refresh()},t}();n.ClipboardService=t}(Inknote||(Inknote={})),function(n){var t=function(){function t(){}return Object.defineProperty(t,"Instance",{get:function(){return t._instance||(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Menu",{get:function(){return this._menu||(this._menu=new n.Drawing.RightClickMenus.RightClickMenu),this._menu},enumerable:!0,configurable:!0}),t.prototype.openMenu=function(t,i,r){var u=new n.Drawing.RightClickMenus.RightClickMenu,f;n.Managers.PageManager.Current.page==n.Managers.Page.File&&n.anyItemIs(n.Managers.ProjectManager.Instance.allProjects,function(t){return t.ID==n.Managers.ProjectManager.Instance.hoverID})&&(u=new n.Drawing.RightClickMenus.RightClickFile(n.Managers.ProjectManager.Instance.hoverID),n.Managers.ProjectManager.Instance.selectID=n.Managers.ProjectManager.Instance.hoverID);n.Managers.PageManager.Current.page==n.Managers.Page.Score&&(u=new n.Drawing.RightClickMenus.RightClickScore);f=r.width>t+u.width;u.x=f?t:t-u.width;u.y=r.height>i+u.height?i:i-u.height;this._menu=u;this.visible=!0},t}();n.RightClickMenuService=t}(Inknote||(Inknote={})),function(n){var t=function(){function t(i){this._items=[];this._canvas=document.getElementById(i);this._ctx=this._canvas.getContext("2d");var r=this;this.draw=function(){var i,t;if(n.Landing.Landing.Instance.ended===!1){requestAnimationFrame(r.draw);return}if(r._canvas.width=r._canvas.parentElement.clientWidth,r._canvas.height=r._canvas.parentElement.clientHeight-50,n.Managers.SettingsManager.Current.displayID===!0&&n.Managers.PageManager.Current.page==n.Managers.Page.Score&&r._ctx.fillText(n.ScoringService.Instance.selectID,10,10),r.arrange(),r._items.push(n.LicenceService.Instance.drawing),n.Managers.MachineManager.Instance.machineType==n.Managers.MachineType.Desktop&&n.ScrollService.Instance.showScrollBar()&&(r._items.push(n.ScrollService.ScrollBar),n.ScrollService.ScrollBar.scrollThumbnail.visible&&r._items.push(n.ScrollService.ScrollBar.scrollThumbnail)),n.RightClickMenuService.Instance.visible==!0&&r._items.push(n.RightClickMenuService.Instance.Menu),n.sortByOrder(r._items),n.Managers.PluginManager)for(i=n.getItemsWhere(n.Managers.PluginManager.Instance.plugins,function(n){return n.active&&n.allowBeforeDraw&&n.beforeDraw!=null}),t=0;t<i.length;t++)i[t].beforeDraw(r._ctx,r._canvas);for(t=0;t<r._items.length;t++)if(r._items[t].draw(r._ctx,r._canvas)===!1){n.log("Drawing failed on item "+r._items[t].ID);return}if(n.Managers.PluginManager)for(i=n.getItemsWhere(n.Managers.PluginManager.Instance.plugins,function(n){return n.active&&n.allowOnDraw&&n.onDraw!=null}),t=0;t<i.length;t++)i[t].onDraw(r._ctx,r._canvas);n.Audio.AudioService&&n.Audio.AudioService.Instance.update();requestAnimationFrame(r.draw)};r.draw();t._instance=r}return Object.defineProperty(t,"Instance",{get:function(){return t._instance},enumerable:!0,configurable:!0}),t.prototype.setItems=function(n){this._items=n},Object.defineProperty(t.prototype,"canvas",{get:function(){return this._canvas},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"items",{get:function(){return this._items},enumerable:!0,configurable:!0}),t.prototype.arrange=function(){switch(n.Managers.PageManager.Current.page){case n.Managers.Page.Score:this._items=n.ProjectConverter.toDrawing(this);break;case n.Managers.Page.File:this._items=n.FileConverter.toDrawing(this)}this.items.push(n.Drawing.Background.Instance)},t}();n.DrawService=t}(Inknote||(Inknote={})),function(n){function i(t){for(var i,r=20,u=0;u<t.items.length;u++)i=t.items[u],i instanceof n.Model.Clef&&(r+=n.requiredClefSpace(i,10)),i instanceof n.Model.Note&&(r+=n.requiredNoteSpace(i,10)),i instanceof n.Model.Rest&&(r+=n.requiredRestSpace(i,10)),i instanceof n.Model.TimeSignature&&(r+=n.requiredTimeSignatureSpace(i,10));return r}function r(n){for(var t,r,e,f=[],u=0;u<n[0].bars.length;u++){for(t=0,r=0;r<n.length;r++)e=i(n[r].bars[u]),t=Math.max(t,e);f.push(t)}return f}function u(n,i){for(var f=[],r=new t,u=0;u<n.length;u++)r.minLength+n[u]>i&&(f.push(r),r=new t),r.minLength+=n[u],r.barIndices.push(u),r.barLengths.push(n[u]);return f.push(r),f}var t=function(){function n(){this.minLength=0;this.barLengths=[];this.barIndices=[]}return n}(),f=function(){function t(){this._refresh=!1;this._items=[];this.maxScrollPosition=0;this.oldScrollY=0;this.refresh()}return Object.defineProperty(t,"Instance",{get:function(){return t._instance||(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.addItem=function(n){this._items.push(n)},t.prototype.refresh=function(){this._refresh=!0},t.prototype.updateItems=function(){var ht,d,it,y,g,a,rt,v,f,ft,t,p,et,nt,ot,w,tt,o,e,b,st,k,ct;if(!n.DrawService.Instance){n.log("draw service not instantiated",n.MessageType.Error);return}if(this.oldScrollY=0,ht=n.Managers.ProjectManager.Instance.currentProject,this._projectID=ht.ID,this._items=[],d=n.getItemsWhere(ht.instruments,function(n){return n.visible}),d.length!==0){var yt=r(d),i=180,s=50;n.DrawService.Instance.canvas.width<600&&(s=0);var h=0,lt=n.DrawService.Instance.canvas.width-2*s,c=0,at=u(yt,lt);for(it=0;it<at.length;it++){for(y=at[it],g=0;g<d.length;g++){for(a=d[g],c=a.clefAdditionalPosition?a.clefAdditionalPosition:0,rt=new n.Drawing.Stave(i,a.name),rt.x=s,rt.width=lt,this.addItem(rt),v=0;v<y.barIndices.length;v++){var vt=y.barLengths[v],ut=a.bars[y.barIndices[v]],l=new n.Drawing.Bar;for(l.ID=ut.ID,l.height=40,l.y=i,l.x=s+h,l.width=vt,g==0&&y.barIndices[v]%5==4&&(l.barNumber=y.barIndices[v]+1),n.TimeSignatureService.Instance.barHasError(ut,a)&&(l.hasError=!0),this.addItem(l),f=20,ft=0;ft<ut.items.length;ft++){if(t=ut.items[ft],t instanceof n.Model.Clef&&(p=n.Drawing.getDrawingFromClef(t),p.ID=t.ID,p.x=s+h+f,p.y=i+5*p.drawPosition,c=5*t.positionFromTreble,a.clefAdditionalPosition=c,this.addItem(p),f+=n.requiredClefSpace(t,10)),t instanceof n.Model.TimeSignature&&(et=t,nt=new n.Drawing.TimeSignature(et.top,et.bottom),nt.ID=et.ID,nt.x=s+h+f,nt.y=i+20,this.addItem(nt),f+=n.requiredTimeSignatureSpace(t,10)),t instanceof n.Model.Note){for(ot=n.Model.IsBlackKey(t.value),w=n.getIntervalDistance(new n.Model.Note(n.Model.NoteValue.F,5,n.Model.NoteLength.Crotchet),t),ot&&(tt=new n.Drawing.Flat,tt.x=s+h+f,tt.y=i-5*w+c,this.addItem(tt),f+=10),o=n.getDrawingItemFromNote(t),o.x=s+h+f,o.y=i-5*w+c,e=5*w-c;e<=-50;e+=5)e/10===Math.round(e/10)&&(b=new n.Drawing.LedgerLine(o.x,i-e),this.addItem(b),o.attach(b));for(e=5*w-c;e>=10;e-=5)e/10===Math.round(e/10)&&(b=new n.Drawing.LedgerLine(o.x,i-e),this.addItem(b),o.attach(b));o.isPlaying=t.isPlaying;o.stemUp=-5*w+c>=20;ot&&o.attach(tt);this.addItem(o);f+=n.requiredNoteSpace(t,10);ot&&(f-=10)}t instanceof n.Model.Rest&&(st=n.getDrawingItemFromRest(t),st.x=s+h+f,st.y=i+20,this.addItem(st),f+=n.requiredRestSpace(t,10));t instanceof n.Model.Chord;t instanceof n.Model.Text&&(k=new n.Drawing.DrawText,k.content=t.content,k.ID=t.ID,ct=this._items[this._items.length-1],k.x=ct.x,k.y=Math.max(ct.y+20,i+70),this.addItem(k))}h+=vt}i+=120;h=0}i+=60}this.maxScrollPosition=i-200}},Object.defineProperty(t.prototype,"SelectedItem",{get:function(){for(var n=0;n<this._items.length;n++)if(this._items[n].ID==this.selectID&&this._items[n].attachedToID==null)return this._items[n];return null},enumerable:!0,configurable:!0}),t.prototype.getPrintItems=function(){return this._items},t.prototype.getItems=function(){var i,t;for(this._projectID!=n.Managers.ProjectManager.Instance.currentProject.ID&&this.refresh(),this._refresh&&this.updateItems(),i=[],t=0;t<this._items.length;t++)this._items[t].y=this._items[t].y+this.oldScrollY-n.ScrollService.Instance.y,this._items[t].y>-50&&this._items[t].y<n.DrawService.Instance.canvas.height+50&&i.push(this._items[t]);return this.oldScrollY=n.ScrollService.Instance.y,this._refresh=!1,i},t.prototype.cursorLeft=function(){for(var i,r=null,t=0;t<this._items.length;t++)if(!(this._items[t]instanceof n.Drawing.Stave)){if(i=this._items[t].ID,i==this.selectID){this.selectID=r;break}r=i}},t.prototype.cursorRight=function(){for(var i,r=null,u=!1,t=0;t<this._items.length;t++)if(!(this._items[t]instanceof n.Drawing.Stave)){if(i=this._items[t].ID,r==this.selectID&&i!=r){this.selectID=i;u=!0;break}r=i}u||(this.selectID=null)},t}();n.ScoringService=f}(Inknote||(Inknote={})),function(n){var t;(function(t){function f(r){for(var h,c,o,l,s=n.Managers.ProjectManager.Instance.currentProject,e=[],f=n.ScoringService.Instance.getItems(),u=0;u<f.length;u++){if(h=f[u].ID===n.ScoringService.Instance.hoverID,c=f[u].ID===n.ScoringService.Instance.selectID,f[u].hover=h,f[u].select=c,f[u]instanceof n.Notation)for(o=0;o<f[u].attached.length;o++)f[u].attached[o].hover=h,f[u].attached[o].select=c;e.push(f[u])}return(l=n.NoteControlService.Instance.getItems(r),e=e.concat(l),!s)?(e.push(i),e):(t.name.name=s.name,t.name.ID=s.ID,t.name.hover=t.name.ID===n.Managers.ProjectManager.Instance.hoverID,t.name.select=t.name.ID===n.Managers.ProjectManager.Instance.selectID,t.name.select&&n.Managers.MachineManager.Instance.machineType!==n.Managers.MachineType.Desktop&&e.push(n.Drawing.Keyboard.Instance),e.push(t.name),s.pause&&e.push(i),e)}function r(t){var i=new n.Compressed.CompressedProject(t.name),r;for(i.ID=t.ID,i.name=t.name,i.inknoteVersion=n.Managers.VersionManager.Instance.version,i.colour=t.colour,i.composer=t.composer,i.arrangedBy=t.arrangedBy,i.notes=t.notes,i.bpm=t.bpm,r=0;r<t.instruments.length;r++)i.instruments.push(e(t.instruments[r]));return i}function e(t){var i=new n.Compressed.Instrument(t.name),r;for(i.v=t.visible,i.synthID=t.synthID,i.synthName=t.synthName,r=0;r<t.bars.length;r++)i.bars.push(o(t.bars[r]));return i}function o(t){for(var u,f,e,o,y,p,r=new n.Compressed.Bar,i=0;i<t.items.length;i++)t.items[i]instanceof n.Model.Note&&(u=h(t.items[i]),r.items.push(u)),t.items[i]instanceof n.Model.Rest&&(f=c(t.items[i]),r.items.push(f)),t.items[i]instanceof n.Model.Chord&&(e=s(t.items[i]),r.items.push(e)),t.items[i]instanceof n.Model.Clef&&(o=l(t.items[i]),r.items.push(o)),t.items[i]instanceof n.Model.TimeSignature&&(y=a(t.items[i]),r.items.push(y)),t.items[i]instanceof n.Model.Text&&(p=v(t.items[i]),r.items.push(p));return r}function s(t){for(var i,f,u=[],r=0;r<t.notes.length;r++)i=t.notes[r],f=new n.Compressed.CompressedNote(i.value,i.octave,i.length),u.push(f);return new n.Compressed.CompressedChord(u)}function h(t){return new n.Compressed.CompressedNote(t.value,t.octave,t.length)}function c(t){return new n.Compressed.CompressedRest(t.length)}function l(t){var i;return t instanceof n.Model.FrenchViolinClef&&(i=n.Compressed.CompressedClefType.FRENCH_VIOLIN),t instanceof n.Model.TrebleClef&&(i=n.Compressed.CompressedClefType.TREBLE),t instanceof n.Model.SopranoClef&&(i=n.Compressed.CompressedClefType.SOPRANO),t instanceof n.Model.MezzoSopranoClef&&(i=n.Compressed.CompressedClefType.MEZZ_SOPRANO),t instanceof n.Model.AltoClef&&(i=n.Compressed.CompressedClefType.ALTO),t instanceof n.Model.TenorClef&&(i=n.Compressed.CompressedClefType.TENOR),t instanceof n.Model.BaritoneClef&&(i=n.Compressed.CompressedClefType.BARITONE),t instanceof n.Model.BassClef&&(i=n.Compressed.CompressedClefType.BASS),t instanceof n.Model.SubbassClef&&(i=n.Compressed.CompressedClefType.SUBBASS),new n.Compressed.CompressedClef(i)}function a(t){return new n.Compressed.CompressedTimeSignature(t.top,t.bottom)}function v(t){var i=new n.Compressed.CompressedText;return i.c=t.content,i}function y(n){for(var u,i=[],t=0;t<n.length;t++)u=r(n[t]),i.push(u);return i}function u(t){var i,r;if(t.inknoteVersion!==n.Managers.VersionManager.Instance.version&&(n.log("project: "+t.name+" is of version "+t.inknoteVersion,n.MessageType.Warning),n.log("this may cause errors when decompressing this saved files",n.MessageType.Warning)),i=new n.Project(t.name),i.ID=t.ID,i.instruments=[],i.colour=t.colour,i.composer=t.composer,i.arrangedBy=t.arrangedBy,i.notes=t.notes,t.bpm&&(i.bpm=t.bpm),t.instruments)for(r=0;r<t.instruments.length;r++)i.instruments.push(p(t.instruments[r]));return i}function p(t){var i=new n.Model.Instrument(t.name),r;for(i.visible=t.v,i.synthID=t.synthID,i.synthName=t.synthName,r=0;r<t.bars.length;r++)i.bars.push(w(t.bars[r]));return i}function w(t){for(var u,f,e,o,s,h,r=new n.Model.Bar,i=0;i<t.items.length;i++)t.items[i].i==n.Compressed.ItemIdentifier.NOTE?(u=k(t.items[i]),r.items.push(u)):t.items[i].i==n.Compressed.ItemIdentifier.REST?(f=d(t.items[i]),r.items.push(f)):t.items[i].i==n.Compressed.ItemIdentifier.CHORD?(e=b(t.items[i]),r.items.push(e)):t.items[i].i==n.Compressed.ItemIdentifier.CLEF?(o=g(t.items[i]),r.items.push(o)):t.items[i].i==n.Compressed.ItemIdentifier.TIMESIGNATURE?(s=tt(t.items[i]),r.items.push(s)):t.items[i].i==n.Compressed.ItemIdentifier.TEXT?(h=nt(t.items[i]),r.items.push(h)):(n.log("object in bar unidentified",n.MessageType.Warning),console.log(t.items[i]));return r}function b(t){for(var i,f,u=[],r=0;r<t.notes.length;r++)i=t.notes[r],f=new n.Model.Note(i.v,i.o,i.l),u.push(f);return new n.Model.Chord(u)}function k(t){return new n.Model.Note(t.v,t.o,t.l)}function d(t){return new n.Model.Rest(t.l)}function g(t){var i;return t.v==n.Compressed.CompressedClefType.FRENCH_VIOLIN&&(i=new n.Model.FrenchViolinClef),t.v==n.Compressed.CompressedClefType.TREBLE&&(i=new n.Model.TrebleClef),t.v==n.Compressed.CompressedClefType.SOPRANO&&(i=new n.Model.SopranoClef),t.v==n.Compressed.CompressedClefType.MEZZ_SOPRANO&&(i=new n.Model.MezzoSopranoClef),t.v==n.Compressed.CompressedClefType.ALTO&&(i=new n.Model.AltoClef),t.v==n.Compressed.CompressedClefType.TENOR&&(i=new n.Model.TenorClef),t.v==n.Compressed.CompressedClefType.BARITONE&&(i=new n.Model.BaritoneClef),t.v==n.Compressed.CompressedClefType.BASS&&(i=new n.Model.BassClef),t.v==n.Compressed.CompressedClefType.SUBBASS&&(i=new n.Model.SubbassClef),i}function nt(t){return new n.Model.Text(t.c)}function tt(t){return new n.Model.TimeSignature(t.t,t.b)}function it(n){for(var r,i=[],t=0;t<n.length;t++)r=u(n[t]),i.push(r);return i}var i=new n.Drawing.LoadingSplash;t.name=new n.Drawing.Name("");t.toDrawing=f;t.compress=r;t.compressAll=y;t.decompress=u;t.decompressAll=it})(t=n.ProjectConverter||(n.ProjectConverter={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){function r(t){for(var r,e=[],f=n.Managers.ProjectManager.Instance.allProjects,c=t.canvas,l=Math.floor(c.width/200),o=0,s=0,h=!1,u=0;u<f.length;u++)r=new n.Drawing.File(f[u].name),r.ID=f[u].ID,f[u].ID==n.Managers.ProjectManager.Instance.hoverID&&(r.hover=!0),f[u].ID==n.Managers.ProjectManager.Instance.selectID&&(r.select=!0,h=!0),r.x=o*200+100,r.y=s*200+100-n.ScrollService.Instance.y,r.colour=f[u].colour,e.push(r),o++,o>=l&&(o=0,s++);return h&&n.Managers.MachineManager.Instance.machineType!=n.Managers.MachineType.Desktop&&e.push(n.Drawing.BottomMenu.Instance),n.Managers.ProjectManager.Instance.currentProject.pause&&e.push(i),e}var i=new n.Drawing.LoadingSplash;t.toDrawing=r})(t=n.FileConverter||(n.FileConverter={}))}(Inknote||(Inknote={})),function(n){function t(t,i){for(var e=i,f,r,u;e<0;)e+=12;if(f=new n.Model.Note(t.value,t.octave,t.length),Math.round(i)!=i)throw new Error("Number of semitones must be an integer");if(f.value=(t.value+e)%12,i>0)for(r=1;r<=i;r++)u=(t.value+r)%12,u==n.Model.NoteValue.C&&f.octave++;if(i<0)for(r=1;r>=i;r--){for(u=t.value+r;u<0;)u+=12;u==n.Model.NoteValue.B&&f.octave--}return f}function i(n){return t(n,4)}function r(n){return i(n)}function u(n){return t(n,3)}function f(n){return t(n,6)}function e(n){return t(n,7)}function o(n){return t(n,10)}function s(n){return t(n,11)}function h(t,i){var o=(i.octave-t.octave)*7,e=t.value,s=t.value<n.Model.NoteValue.C?t.value+12:t.value,h=i.value<n.Model.NoteValue.C?i.value+12:i.value,u=h-s,f=0,r;if(u>0)for(r=0;r<u;r++)n.Model.IsBlackKey((r+e)%12)||f++;else for(r=0;r>u;r--)n.Model.IsBlackKey((r+11+e)%12)||f--;return o+f}function c(i,r){var o=0,e,u,f;if(r>=0)for(u=0;u<r;u++)for(f=!1;!f;)e=t(i,o),f=n.Model.IsWhiteKey(e.value),o++;else for(u=0;u>r;u--)for(f=!1;!f;)e=t(i,o),f=n.Model.IsWhiteKey(e.value),o--;return e}n.getNoteOfDistance=t;n.getThird=i;n.getMajorThird=r;n.getMinorThird=u;n.getFlatFifth=f;n.getFifth=e;n.getSeventh=o;n.getMajorSeventh=s;n.getIntervalDistance=h;n.getNoteFromStaveDifference=c}(Inknote||(Inknote={})),function(n){function t(t,i){var r=n.getNoteOfDistance(t,i);t.value=r.value;t.octave=r.octave}function i(n,i){for(var r=0;r<n.notes.length;r++)t(n.notes[r],i)}n.transposeNote=t;n.transposeChord=i}(Inknote||(Inknote={})),function(n){function t(n,t){var i=t;return i+t}function i(t){var i=null;switch(t.length){case n.Model.NoteLength.Breve:i=new n.Drawing.BreveRest;break;case n.Model.NoteLength.SemiBreve:i=new n.Drawing.SemiBreveRest;break;case n.Model.NoteLength.Minim:i=new n.Drawing.MinimRest;break;case n.Model.NoteLength.Crotchet:i=new n.Drawing.CrotchetRest;break;case n.Model.NoteLength.Quaver:i=new n.Drawing.QuaverRest;break;case n.Model.NoteLength.SemiQuaver:i=new n.Drawing.SemiQuaverRest;break;case n.Model.NoteLength.DemiSemiQuaver:i=new n.Drawing.DemiSemiQuaverRest;break;case n.Model.NoteLength.HemiDemiSemiQuaver:i=new n.Drawing.HemiDemiSemiQuaverRest}return i.ID=t.ID,i}n.requiredRestSpace=t;n.getDrawingItemFromRest=i}(Inknote||(Inknote={})),function(n){function t(n,t){return n.value==t.value&&n.octave==t.octave&&n.length==t.length}function i(n,t){return n.value==t.value&&n.octave==t.octave}function r(t,i){var r=i;return t.length>n.Model.NoteLength.Crotchet&&(r+=i),n.Model.IsBlackKey(t.value)&&(r+=10),r+i}function u(t){var i=null,r=!0;switch(t.length){case n.Model.NoteLength.Breve:i=new n.Drawing.Breve(r);break;case n.Model.NoteLength.SemiBreve:i=new n.Drawing.SemiBreve(r);break;case n.Model.NoteLength.Minim:i=new n.Drawing.Minim(r);break;case n.Model.NoteLength.Crotchet:i=new n.Drawing.Crotchet(r);break;case n.Model.NoteLength.Quaver:i=new n.Drawing.Quaver(r);break;case n.Model.NoteLength.SemiQuaver:i=new n.Drawing.SemiQuaver(r);break;case n.Model.NoteLength.DemiSemiQuaver:i=new n.Drawing.DemiSemiQuaver(r);break;case n.Model.NoteLength.HemiDemiSemiQuaver:i=new n.Drawing.HemiDemiSemiQuaver(r);break;default:i=new n.Drawing.Crotchet(r)}return i.ID=t.ID,i}n.notesAreEqual=t;n.notePitchesAreEqual=i;n.requiredNoteSpace=r;n.getDrawingItemFromNote=u}(Inknote||(Inknote={})),function(n){function i(){return 40}function t(n,t){var i=n.clefType==t.clefType,r=n.drawLocation==t.drawLocation,u=n.positionFromTreble==t.positionFromTreble;return i&&r&&u}function r(i,r){var u=[],e,f,o,s;for(u.push(new n.Model.FrenchViolinClef),u.push(new n.Model.TrebleClef),u.push(new n.Model.SopranoClef),u.push(new n.Model.MezzoSopranoClef),u.push(new n.Model.AltoClef),u.push(new n.Model.TenorClef),u.push(new n.Model.BaritoneClef),u.push(new n.Model.BassClef),u.push(new n.Model.SubbassClef),e=null,f=0;f<u.length;f++)o=u[f],t(i,o)&&(r===!0?(s=f==0?f=u.length-1:f-1,e=u[s]):e=u[(f+1)%u.length]);return e.ID=i.ID,e}n.requiredClefSpace=i;n.areSameClefs=t;n.getNextClef=r}(Inknote||(Inknote={})),function(n){function i(){return 30}function t(t){switch(t){case n.Model.NoteLength.Breve:return 8;case n.Model.NoteLength.SemiBreve:return 4;case n.Model.NoteLength.Minim:return 2;case n.Model.NoteLength.Crotchet:return 1;case n.Model.NoteLength.Quaver:return 1/2;case n.Model.NoteLength.SemiQuaver:return 1/4;case n.Model.NoteLength.DemiSemiQuaver:return 1/8;case n.Model.NoteLength.HemiDemiSemiQuaver:return 1/16}return 0}n.requiredTimeSignatureSpace=i;n.getCrotchetsFromNoteLength=t;var r=function(){function i(){}return Object.defineProperty(i,"Instance",{get:function(){return i._instance||(i._instance=new i),i._instance},enumerable:!0,configurable:!0}),i.prototype.barIsFull=function(i,r){for(var f,o,s,e=new n.Model.TimeSignature(4,4),u=0;u<r.bars.length;u++){for(f=0;f<r.bars[u].items.length;f++)r.bars[u].items[f]instanceof n.Model.TimeSignature&&(e=r.bars[u].items[f]);if(r.bars[u].ID===i.ID)break}return o=n.getItemsWhere(i.items,function(t){var i=t instanceof n.Model.Rest,r=t instanceof n.Model.Note,u=t instanceof n.Model.Chord;return i||r}),s=n.sum(o,function(n){return t(n.length)}),s>=e.top},i.prototype.barHasError=function(i,r){for(var f,o,s,e=new n.Model.TimeSignature(4,4),u=0;u<r.bars.length;u++){for(f=0;f<r.bars[u].items.length;f++)r.bars[u].items[f]instanceof n.Model.TimeSignature&&(e=r.bars[u].items[f]);if(r.bars[u].ID===i.ID)break}return o=n.getItemsWhere(i.items,function(t){var i=t instanceof n.Model.Rest,r=t instanceof n.Model.Note,u=t instanceof n.Model.Chord;return i||r}),s=n.sum(o,function(n){return t(n.length)}),s!=e.top},i}();n.TimeSignatureService=r}(Inknote||(Inknote={})),function(n){function t(t,i){for(var r=0;r<i.notes.length;r++)if(n.notePitchesAreEqual(t,i.notes[r]))return!0;return!1}function i(t){var i=[t,n.getMajorThird(t),n.getFifth(t)];return new n.Model.Chord(i)}function r(t){var i=[t,n.getMinorThird(t),n.getFifth(t)];return new n.Model.Chord(i)}n.noteIsInChord=t;n.getMajorTriad=i;n.getMinorTriad=r}(Inknote||(Inknote={})),function(n){function t(t,i,r,u){switch(n.Managers.SettingsManager.Instance.getCurrentSetting().notationType){case n.NotationType.Standard:return new n.ChordNotation.StandardChordNotation(t,i,r,u);case n.NotationType.UPPER_lower:return new n.ChordNotation.UPPER_lowerChordNotation(t,i,r,u);case n.NotationType.DoReMi:return new n.ChordNotation.DoReMiChordNotation(t,i,r,u);default:return new n.ChordNotation.StandardChordNotation(t,i,r,u)}}n.getCurrentChordNotation=t}(Inknote||(Inknote={})),function(n){function t(){throw new Error("Not fully implemented");}n.identifyChord=t}(Inknote||(Inknote={})),function(n){var t=function(){function t(){this.piano=new n.Drawing.Piano;this.background=new n.Drawing.NoteControlBackground;this.lengthControl=new n.Drawing.LengthControlBar;this.minimise=new n.Drawing.Minimise;this.restControl=new n.Drawing.RestControl;this.deleteNoteControl=new n.Drawing.DeleteNoteControl;this.x=0;this.hidden=n.TempDataService.Instance.currentData.noteControlsHidden;this.hiddenY=0;this.firstOpen=!0;this.ID="note_control";this.piano.ID=this.ID;this.background.ID=this.ID;this.lengthControl.ID=this.ID;this.minimise.ID=this.ID}return Object.defineProperty(t,"Instance",{get:function(){return t._instance||(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.hide=function(){this.hidden=!0;n.TempDataService.Instance.currentData.noteControlsHidden=!0;n.TempDataService.Instance.update()},t.prototype.show=function(){this.hidden=!1;n.TempDataService.Instance.currentData.noteControlsHidden=!1;n.TempDataService.Instance.update()},t.prototype.getItems=function(n){this.hidden?this.hiddenY>n.canvas.height/2||this.firstOpen?this.hiddenY=n.canvas.height/2:this.hiddenY<n.canvas.height/2&&(this.hiddenY+=10):this.hiddenY>0?this.hiddenY-=10:this.hiddenY=0;this.y=n.canvas.height/2+this.hiddenY;this.width=Math.min(n.canvas.width,800);this.height=n.canvas.height/2;var t=[];return this.background.width=this.width,this.background.height=this.height,this.background.y=this.y,t.push(this.background),this.restControl.y=this.y,this.restControl.width=this.width/8,this.restControl.height=this.height/4,t.push(this.restControl),this.deleteNoteControl.y=this.y,this.deleteNoteControl.x=this.x+this.width*7/8,this.deleteNoteControl.width=this.width/8,this.deleteNoteControl.height=this.height/4,t.push(this.deleteNoteControl),this.lengthControl.y=this.y+this.height/4,this.lengthControl.width=this.width,this.lengthControl.height=this.height/4,t.push(this.lengthControl),this.piano.width=this.width,this.piano.height=this.height/2,this.piano.y=this.y+this.height/2,t.push(this.piano),this.minimise.width=40,this.minimise.height=20,this.minimise.x=this.x,this.minimise.y=this.y-this.minimise.height,t.push(this.minimise),this.firstOpen=!1,t},t.prototype.addInstrument=function(t){var i;n.UndoService.Instance.store();var r=n.Managers.ProjectManager.Instance.currentProject,f=r.instruments[0].bars.length,u=new n.Model.Instrument(t);for(i=0;i<f;i++)this.addBarToInstrument(u);r.instruments.push(u);n.ScoringService.Instance.refresh()},t.prototype.addBarToInstrument=function(t){var i=new n.Model.Bar;t.bars.length==0&&(i.items.push(new n.Model.TrebleClef),i.items.push(new n.Model.TimeSignature(4,4)));t.bars.push(i)},t.prototype.addBar=function(){for(var i=n.Managers.ProjectManager.Instance.currentProject,t=0;t<i.instruments.length;t++)this.addBarToInstrument(i.instruments[t])},t.prototype.addNoteToBar=function(t,i){var u,r,o,f,e,s;for(n.UndoService.Instance.store(),t+=5,u=n.Managers.ProjectManager.Instance.currentProject,r=0;r<u.instruments.length;r++)for(o=new n.Model.TrebleClef,f=0;f<u.instruments[r].bars.length;f++){for(e=0;e<u.instruments[r].bars[f].items.length;e++)s=u.instruments[r].bars[f].items[e],s instanceof n.Model.Clef&&(o=s);if(u.instruments[r].bars[f].ID==i){var h=o.positionFromTreble,c=Math.round(t/5),l=new n.Model.Note(n.Model.NoteValue.F,5,this.lengthControl.selectedLength),a=n.getNoteFromStaveDifference(l,h-c);u.instruments[r].bars[f].items.push(a)}}n.ScoringService.Instance.refresh()},t.prototype.addNote=function(t){var i,r,u,f,e,o;if(n.UndoService.Instance.store(),i=n.Managers.ProjectManager.Instance.currentProject,n.Audio.AudioService&&n.Audio.AudioService.Instance.playNote(t),n.ScoringService.Instance.SelectedItem instanceof n.Drawing.Bar)for(r=0;r<i.instruments.length;r++)for(u=0;u<i.instruments[r].bars.length;u++)if(f=i.instruments[r].bars[u],f.ID==n.ScoringService.Instance.selectID){if(n.TimeSignatureService.Instance.barIsFull(f,i.instruments[r]))if(i.instruments[r].bars[u+1])if(i.instruments[r].bars[u+1].items.length==0)f=i.instruments[r].bars[u+1];else return;else this.addBar(),f=i.instruments[r].bars[u+1];f.items.push(t);n.ScoringService.Instance.selectID=f.ID;n.ScoringService.Instance.refresh();return}e=i.instruments[0];e.bars.length==0&&this.addBar();o=e.bars[e.bars.length-1];n.TimeSignatureService.Instance.barIsFull(o,e)&&(this.addBar(),o=e.bars[e.bars.length-1]);o.items.push(t);n.ScoringService.Instance.refresh()},t.prototype.addRest=function(){var t,o,i,r,u,f,e;if(n.UndoService.Instance.store(),t=n.Managers.ProjectManager.Instance.currentProject,o=new n.Model.Rest(this.lengthControl.selectedLength),n.ScoringService.Instance.SelectedItem instanceof n.Drawing.Bar)for(i=0;i<t.instruments.length;i++)for(r=0;r<t.instruments[i].bars.length;r++)if(u=t.instruments[i].bars[r],u.ID==n.ScoringService.Instance.selectID){if(n.TimeSignatureService.Instance.barIsFull(u,t.instruments[i]))if(t.instruments[i].bars[r+1])if(t.instruments[i].bars[r+1].items.length==0)u=t.instruments[i].bars[r+1];else return;else this.addBar(),u=t.instruments[i].bars[r+1];u.items.push(o);n.ScoringService.Instance.selectID=u.ID;n.ScoringService.Instance.refresh();return}f=t.instruments[0];f.bars.length==0&&this.addBar();e=f.bars[f.bars.length-1];n.TimeSignatureService.Instance.barIsFull(e,f)&&(this.addBar(),e=f.bars[f.bars.length-1]);e.items.push(o);n.ScoringService.Instance.refresh()},t.prototype.editNoteLength=function(){var r,i,u,o,f,t,e;for(n.UndoService.Instance.store(),r=n.Managers.ProjectManager.Instance.currentProject,i=0;i<r.instruments.length;i++)for(u=0;u<r.instruments[i].bars.length;u++)for(o=r.instruments[i].bars[u],f=0;f<o.items.length;f++)if(t=o.items[f],t.ID==n.ScoringService.Instance.selectID)if(t instanceof n.Model.Note)t.length=this.lengthControl.selectedLength;else if(t instanceof n.Model.Rest)t.length=this.lengthControl.selectedLength;else if(t instanceof n.Model.Chord)for(e=0;e<t.notes.length;e++)t.notes[e].length=this.lengthControl.selectedLength;n.ScoringService.Instance.refresh()},t.prototype.editCurrentClef=function(t){var u,i,f,e,r,o;for(n.UndoService.Instance.store(),u=n.Managers.ProjectManager.Instance.currentProject,i=0;i<u.instruments.length;i++)for(f=0;f<u.instruments[i].bars.length;f++)for(e=u.instruments[i].bars[f],r=0;r<e.items.length;r++)o=e.items[r],o.ID==n.ScoringService.Instance.selectID&&o instanceof n.Model.Clef&&(e.items[r]=n.getNextClef(o,t));n.ScoringService.Instance.refresh()},t.prototype.deleteSelected=function(){n.UndoService.Instance.store();n.ScoringService.Instance.SelectedItem instanceof n.Drawing.Note||n.ScoringService.Instance.SelectedItem instanceof n.Drawing.Rest||n.ScoringService.Instance.SelectedItem instanceof n.Drawing.DrawText?t.Instance.deleteItem():n.ScoringService.Instance.SelectedItem instanceof n.Drawing.Bar&&n.BarService.Instance.deleteSelectedBar()},t.prototype.deleteItem=function(){for(var i,r,u,s,f,e,o=n.Managers.ProjectManager.Instance.currentProject,t=0;t<o.instruments.length;t++)for(i=null,r=0;r<o.instruments[t].bars.length;r++){for(u=o.instruments[t].bars[r],s=[],f=0;f<u.items.length;f++)e=u.items[f],e.ID==n.ScoringService.Instance.selectID?n.ScoringService.Instance.selectID=i?i.ID:null:s.push(e),i=e;u.items=s}n.ScoringService.Instance.refresh()},t.prototype.editNoteValueAndOctave=function(t,i){var e,f,o,c,s,r,h,u;for(n.UndoService.Instance.store(),e=n.Managers.ProjectManager.Instance.currentProject,f=[],u=0;u<e.instruments.length;u++)for(o=0;o<e.instruments[u].bars.length;o++)for(c=e.instruments[u].bars[o],s=0;s<c.items.length;s++)if(r=c.items[s],r.ID==n.ScoringService.Instance.selectID)if(r instanceof n.Model.Note)r.value=t,r.octave=i,r.length=this.lengthControl.selectedLength,f.push(r);else if(!(r instanceof n.Model.Rest)&&r instanceof n.Model.Chord)for(h=0;h<r.notes.length;h++)f.push(r.notes[h]);if(n.Audio.AudioService)for(u=0;u<f.length;u++)n.Audio.AudioService.Instance.playNote(f[u]);n.ScoringService.Instance.refresh()},t.prototype.noteValueUp=function(){var f,u,e,o,s,t,i,r;for(n.UndoService.Instance.store(),f=n.Managers.ProjectManager.Instance.currentProject,u=0;u<f.instruments.length;u++)for(e=0;e<f.instruments[u].bars.length;e++)for(o=f.instruments[u].bars[e],s=0;s<o.items.length;s++)if(t=o.items[s],t.ID==n.ScoringService.Instance.selectID||n.ScoringService.Instance.selectID==o.ID)if(t instanceof n.Model.Note)r=t.value+1,t.value=r%12,t.octave=r%12==n.Model.NoteValue.C?t.octave+1:t.octave;else if(!(t instanceof n.Model.Rest)&&t instanceof n.Model.Chord)for(i=0;i<t.notes.length;i++)r=t.notes[i].value+1,t.notes[i].value=r%12,t.notes[i].octave=r%12==n.Model.NoteValue.C?t.notes[i].octave+1:t.notes[i].octave;n.ScoringService.Instance.refresh()},t.prototype.noteValueDown=function(){var f,u,e,o,s,t,i,r;for(n.UndoService.Instance.store(),f=n.Managers.ProjectManager.Instance.currentProject,u=0;u<f.instruments.length;u++)for(e=0;e<f.instruments[u].bars.length;e++)for(o=f.instruments[u].bars[e],s=0;s<o.items.length;s++)if(t=o.items[s],t.ID==n.ScoringService.Instance.selectID||n.ScoringService.Instance.selectID==o.ID)if(t instanceof n.Model.Note)r=t.value+11,t.value=r%12,t.octave=r%12==n.Model.NoteValue.B?t.octave-1:t.octave;else if(!(t instanceof n.Model.Rest)&&t instanceof n.Model.Chord)for(i=0;i<t.notes.length;i++)r=t.notes[i].value+11,t.notes[i].value=r%12,t.notes[i].octave=r%12==n.Model.NoteValue.B?t.notes[i].octave-1:t.notes[i].octave;n.ScoringService.Instance.refresh()},t}();n.NoteControlService=t}(Inknote||(Inknote={})),function(n){var t=function(){function t(){}return Object.defineProperty(t,"Instance",{get:function(){return t._instance||(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.deleteSelectedBar=function(){for(var r,u,e,f=!1,s=0,o=null,i=n.Managers.ProjectManager.Instance.currentProject.instruments,t=0;t<i.length;t++)for(r=0;r<i[t].bars.length;r++){if(u=i[t].bars[r],u.ID==n.ScoringService.Instance.SelectedItem.ID){if(u.items.length==0){for(f=!0,n.ScoringService.Instance.selectID=o?o.ID:null,e=0;e<i.length;e++)i[e].bars[r].items.length>0&&(f=!1);f==!0&&(s=r)}else u.items=[],n.ScoringService.Instance.refresh();break}o=u}if(f===!0)for(t=0;t<i.length;t++)i[t].bars.splice(s,1),n.ScoringService.Instance.refresh()},t}();n.BarService=t}(Inknote||(Inknote={})),function(n){var t=function(){function n(){this.currentProject=null;this.container=document.getElementById("project-options-details")}return Object.defineProperty(n,"Instance",{get:function(){return n._instance||(n._instance=new n),n._instance},enumerable:!0,configurable:!0}),n.prototype.addRowWithData=function(n,t,i,r){var f=document.createElement("div"),e,u;f.className="form-row";e=document.createElement("span");e.className="label";e.textContent=n;f.appendChild(e);u=document.createElement("input");u.value=t;u.onchange=i;r==!0&&(u.type="number");f.appendChild(u);this.container.appendChild(f)},n.prototype.open=function(t){var f,r,u,i;this.currentProject=t;this.container.innerHTML="";f=document.createElement("h1");f.textContent=t.name;this.container.appendChild(f);r=document.createElement("div");r.className="form-row";u=document.createElement("span");u.className="label";u.textContent="tag colour:";r.appendChild(u);i=document.createElement("input");i.type="color";i.value=t.colour;i.onchange=function(){n.Instance.currentProject.colour=i.value};r.appendChild(i);this.container.appendChild(r);this.addRowWithData("composed by:",t.composer,function(t){n.Instance.currentProject.composer=t.target.value});this.addRowWithData("arranged by:",t.arrangedBy,function(t){n.Instance.currentProject.arrangedBy=t.target.value});this.addRowWithData("notes:",t.notes,function(t){n.Instance.currentProject.notes=t.target.value});this.addRowWithData("tempo:",t.bpm,function(t){n.Instance.currentProject.bpm=parseInt(t.target.value)},!0);Modal.toggle("project-options")},n}();n.ProjectOptionsService=t}(Inknote||(Inknote={})),function(n){var t=function(){function t(){}return Object.defineProperty(t,"Instance",{get:function(){return t._instance||(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.addInstrument=function(){var t=prompt("What is the name of the new instrument?");t!=""&&t!=null&&n.NoteControlService.Instance.addInstrument(t);t==""&&n.check("Your instrument name cannot be empty",null,null)},t.prototype.openInstrumentEditor=function(){function i(){var w=document.getElementById("instrument-list"),u,r,f,y,e,h,p,o,c,s,l,a,v;for(w.innerHTML="",u=n.Managers.ProjectManager.Instance.currentProject.instruments,r=0;r<u.length;r++){for(f=document.createElement("div"),f.className="form-row",y=document.createElement("input"),y.value=u[r].name,y.setAttribute("data-id",u[r].ID),y.onkeyup=function(t){for(var u=t.target,f=u.getAttribute("data-id"),r=n.Managers.ProjectManager.Instance.currentProject,i=0;i<r.instruments.length;i++)r.instruments[i].ID==f&&(r.instruments[i].name=u.value);n.ScoringService.Instance.refresh()},e=document.createElement("select"),e.setAttribute("data-id",u[r].ID),h=n.Audio.SynthManager.Instance.getSynths(),p=document.createElement("option"),p.value="",p.text="none",u[r].synthName||u[r].synthID||(p.selected=!0),e.appendChild(p),e.onchange=function(t){for(var u=t.target,e=u.getAttribute("data-id"),r=n.Managers.ProjectManager.Instance.currentProject,i=0;i<r.instruments.length;i++)if(r.instruments[i].ID==e)if(u.value=="")r.instruments[i].synthName=null,r.instruments[i].synthID=null;else{var f=u.value.indexOf("|"),o=u.value.substring(0,f),s=u.value.substring(f+1);r.instruments[i].synthName=s;r.instruments[i].synthID=o}},o=0;o<h.length;o++)c=document.createElement("option"),c.value=h[o].ID+"|"+h[o].name,c.textContent=h[o].name,e.appendChild(c),h[o].ID==u[r].synthID&&(c.selected=!0,e.value=c.value);s=document.createElement("input");s.type="checkbox";s.checked=u[r].visible;s.setAttribute("data-id",u[r].ID);s.className+=" small-width";s.onclick=function(t){for(var u=t.target,f=u.getAttribute("data-id"),r=n.Managers.ProjectManager.Instance.currentProject,i=0;i<r.instruments.length;i++)r.instruments[i].ID==f&&(r.instruments[i].visible=u.checked);n.ScoringService.Instance.refresh()};l=document.createElement("span");a=document.createElement("span");l.textContent="▲";a.textContent="▼";l.className+=" button";a.className+=" button";l.setAttribute("data-id",u[r].ID);a.setAttribute("data-id",u[r].ID);l.onclick=function(n){var r=n.target,u=r.getAttribute("data-id");t.Instance.moveUpFromID(u);i()};a.onclick=function(n){var r=n.target,u=r.getAttribute("data-id");t.Instance.moveDownFromID(u);i()};v=document.createElement("span");v.textContent="x";v.className+=" button negative";v.setAttribute("data-id",u[r].ID);v.onclick=function(n){var r=n.target,u=r.getAttribute("data-id");t.Instance.deleteFromID(u,function(){i()})};f.appendChild(y);f.appendChild(e);f.appendChild(s);f.appendChild(l);f.appendChild(a);f.appendChild(v);w.appendChild(f)}}Modal.toggle("instruments");i()},t.prototype.moveUpFromID=function(t){for(var r=n.Managers.ProjectManager.Instance.currentProject,u=[],i=0;i<r.instruments.length;i++)r.instruments[i+1]&&r.instruments[i+1].ID==t?(u.push(r.instruments[i+1]),u.push(r.instruments[i]),i++):u.push(r.instruments[i]);r.instruments=u;n.ScoringService.Instance.refresh()},t.prototype.moveDownFromID=function(t){for(var r=n.Managers.ProjectManager.Instance.currentProject,u=[],i=0;i<r.instruments.length;i++)r.instruments[i].ID==t&&r.instruments[i+1]?(u.push(r.instruments[i+1]),u.push(r.instruments[i]),i++):u.push(r.instruments[i]);r.instruments=u;n.ScoringService.Instance.refresh()},t.prototype.deleteFromID=function(t,i){n.check("Are you sure you want to delete this instrument?",function(){for(var r=n.Managers.ProjectManager.Instance.currentProject,f=[],u=0;u<r.instruments.length;u++)r.instruments[u].ID!=t&&f.push(r.instruments[u]);r.instruments=f;i();n.ScoringService.Instance.refresh()})},t}();n.InstrumentService=t}(Inknote||(Inknote={})),function(n){var t=function(){function t(){this._storage=[]}return Object.defineProperty(t,"Instance",{get:function(){return t._instance||(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.store=function(){var t=n.Managers.ProjectManager.Instance.currentProject,i=n.ProjectConverter.compress(t);for(this._storage.push(i);this._storage.length>10;)this._storage.shift()},t.prototype.undo=function(){if(this._storage.length>0){var t=n.ProjectConverter.decompress(this._storage.pop());n.Managers.ProjectManager.Instance.currentProjectOverride=t;n.ScoringService.Instance.refresh()}else n.log("You have reached the maximum number of undos",n.MessageType.Warning)},t}();n.UndoService=t}(Inknote||(Inknote={})),function(n){var t=function(){function n(){}return Object.defineProperty(n,"Instance",{get:function(){return n._instance||(n._instance=new n),n._instance},enumerable:!0,configurable:!0}),n.prototype.$get=function(n,t,i){var r=new XMLHttpRequest;r.open("GET",n,!0);r.onload=t;r.onerror=i;r.send()},n.prototype.post=function(n,t,i,r){var u=new XMLHttpRequest;u.open("POST",n,!0);u.setRequestHeader("X-Requested-With","XMLHttpRequest");u.setRequestHeader("content-type","application/json");u.onload=i;u.onerror=r;u.send(t)},n}();n.HttpService=t}(Inknote||(Inknote={})),function(n){var t=function(){function t(){}return Object.defineProperty(t,"Instance",{get:function(){return t._instance||(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.print=function(){n.check("open printable version?",function(){var f=n.Managers.ProjectManager.Instance.currentProject,e=n.Managers.PageManager.Current.openNewPage(n.Managers.Page.Print,f.ID),s=document.createElement("html"),h=document.createElement("body"),i,o,c,t,l,r,u;for(s.appendChild(h),i=document.createElement("div"),i.id="main",h.appendChild(i),o=document.createElement("h1"),o.textContent=f.name,i.appendChild(o),e.document.write(s.outerHTML),e.document.title="print "+f.name,c=e.document.getElementById("main"),t=document.createElement("canvas"),c.appendChild(t),l=t.getContext("2d"),t.width=n.DrawService.Instance.canvas.width,r=n.ScoringService.Instance.getPrintItems(),t.height=n.maxOutOf(r,function(n){return n.y})+100,u=0;u<r.length;u++)r[u].draw(l,t,1)},function(){n.log("print cancelled")})},t}();n.PrintService=t}(Inknote||(Inknote={})),function(n){var t;(function(t){function r(n){switch(n){case i.sine:return"sine";case i.sawtooth:return"sawtooth";case i.triangle:return"triangle";case i.square:return"square";default:return"sine"}}var i,u;(function(n){n[n.sine=0]="sine";n[n.sawtooth=1]="sawtooth";n[n.triangle=2]="triangle";n[n.square=3]="square";n[n.custome=4]="custome"})(t.SoundType||(t.SoundType={}));i=t.SoundType;t.getSoundType=r;u=function(){function t(n,t,r){this.isSilent=!1;this.finished=!1;this.note=null;this.soundType=i.sine;this.frequency=n;this.playTime=t;this.lifeTime=t+1e3;r&&(this.soundType=r)}return t.prototype.play=function(t,i){if(this.oscillator=t.createOscillator(),this.oscillator.type=r(this.soundType),this.synth&&(this.oscillator.type=r(this.synth.oscillatorType)),this.gain=t.createGain(),this.gain.gain.value=.3,this.oscillator.connect(this.gain),this.synth){var u=this.synth;u.setInput(this.gain);u.connectTo(i,t)}else this.gain.connect(i);this.oscillator.frequency.value=this.frequency;this.oscillator.start(0);this.startTime=new Date;this.note.isPlaying=!0;n.ScoringService.Instance.refresh()},t.prototype.mute=function(){this.isSilent=!0;this.gain.gain.value=0;this.note.isPlaying=!1;n.ScoringService.Instance.refresh()},t.prototype.stop=function(){this.finished=!0;this.oscillator.disconnect();this.gain.disconnect();this.gain.numberOfOutputs},t.prototype.update=function(){var n=(new Date).getTime(),t=this.startTime.getTime();n-t>this.playTime?this.mute():n-t>this.lifeTime?this.stop():this.gain.gain.value*=.95},t}();t.Sound=u})(t=n.Audio||(n.Audio={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){function i(t){var i,u=t.value,r;switch(u){case n.Model.NoteValue.C:i=261.63;break;case n.Model.NoteValue.Db:i=277.18;break;case n.Model.NoteValue.D:i=293.66;break;case n.Model.NoteValue.Eb:i=311.13;break;case n.Model.NoteValue.E:i=329.63;break;case n.Model.NoteValue.F:i=349.23;break;case n.Model.NoteValue.Gb:i=369.99;break;case n.Model.NoteValue.G:i=392;break;case n.Model.NoteValue.Ab:i=415.3;break;case n.Model.NoteValue.A:i=440;break;case n.Model.NoteValue.Bb:i=466.16;break;case n.Model.NoteValue.B:i=493.88}return r=t.octave,i*Math.pow(2,r-4)}t.getFrequencyFromNote=i})(t=n.Audio||(n.Audio={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){function i(t,i){var r=6e4/i,u=n.getCrotchetsFromNoteLength(t);return u*r}function r(n,t){return i(n.length,t)}t.getPlayingTimeFromNoteLength=i;t.getPlayingTime=r})(t=n.Audio||(n.Audio={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){function i(t){for(var i,r,e,u=[],f=0;f<t.length;f++)for(i=t[f],r=0,i instanceof n.Model.Note?(r=n.getCrotchetsFromNoteLength(i.length)*16,u.push(i),r--):i instanceof n.Model.Rest?r=n.getCrotchetsFromNoteLength(i.length)*16:i instanceof n.Model.Chord&&(r=n.getCrotchetsFromNoteLength(i.notes[0].length)*16,u.push(i),r--),e=0;e<r;e++)u.push(null);return u}var r=function(){function r(){this.context=this.isAudioWorking?new AudioContext:null;this.playing=!1;this.init()}return Object.defineProperty(r,"Instance",{get:function(){return r._instance||(r._instance=new r),r._instance},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isAudioWorking",{get:function(){return typeof AudioContext=="function"},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bpm",{get:function(){var t=n.Managers.ProjectManager.Instance.currentProject;return t?t.bpm:120},enumerable:!0,configurable:!0}),r.prototype.init=function(){this.isAudioWorking&&(this.destination=this.context.destination,this.masterGain&&this.masterGain.disconnect(),this.masterGain=this.context.createGain(),this.masterGain.gain.value=.3,this.waveShaper&&this.waveShaper.disconnect(),this.waveShaper=this.context.createWaveShaper(),this.masterGain.connect(this.waveShaper),this.waveShaper.connect(this.destination),this.sounds=[],this.timeSignature=new n.Model.TimeSignature(4,4),this.playing=!1,this.barIndex=0,this.beatIndex=0,this.indexChanged=null)},r.prototype.toggle=function(){this.playing?this.stop():this.play()},r.prototype.play=function(){var f,r,t,i,u;if(this.isAudioWorking&&n.Managers.PageManager.Current.page==n.Managers.Page.Score)for(this.playing=!0,f=n.ScoringService.Instance.selectID,r=n.Managers.ProjectManager.Instance.currentProject,t=0;t<r.instruments.length;t++)if(r.instruments[t].visible===!0)for(i=0;i<r.instruments[t].bars.length;i++){if(r.instruments[t].bars[i].ID===f){this.barIndex=i;return}for(u=0;u<r.instruments[t].bars[i].items.length;u++)if(r.instruments[t].bars[i].items[u].ID===f){this.barIndex=i;this.beatIndex=0;return}}},r.prototype.playSound=function(n){this.isAudioWorking&&(this.sounds.push(n),n.play(this.context,this.masterGain))},r.prototype.playNote=function(n,i){if(this.isAudioWorking){var u=t.getFrequencyFromNote(n),f=t.getPlayingTime(n,this.bpm),r=new t.Sound(u,f);i&&(r.synth=i);r.note=n;this.playSound(r)}},r.prototype.playNotes=function(){var e,o,r,u;if(this.isAudioWorking&&(e=t.getPlayingTimeFromNoteLength(n.Model.NoteLength.HemiDemiSemiQuaver,this.bpm),o=new Date,!this.indexChanged||!(o.getTime()-this.indexChanged.getTime()<e))){if(r=n.Managers.ProjectManager.Instance.currentProject,this.barIndex>=r.instruments[0].bars.length){this.stop();return}for(u=0;u<r.instruments.length;u++){var h=r.instruments[u].bars[this.barIndex],f=r.instruments[u],c=f.synthID?t.SynthManager.Instance.getSynth(f.synthID,f.synthName):null,l=n.getItemsWhere(h.items,function(t){return t instanceof n.Model.Note||t instanceof n.Model.Rest}),a=i(l),s=a[this.beatIndex];s instanceof n.Model.Note&&this.playNote(s,c)}this.beatIndex+1>=this.timeSignature.top*16&&this.barIndex++;this.beatIndex=(this.beatIndex+1)%(this.timeSignature.top*16);this.indexChanged=new Date}},r.prototype.updateSounds=function(){if(this.isAudioWorking)for(var n=0;n<this.sounds.length;n++)this.sounds[n].update()},r.prototype.removeFinishedSounds=function(){var t,n;if(this.isAudioWorking){for(t=[],n=0;n<this.sounds.length;n++)this.sounds[n].finished||t.push(this.sounds[n]);this.sounds=t}},r.prototype.pause=function(){this.playing=!1},r.prototype.clearSounds=function(){if(this.isAudioWorking)for(var n=0;n<this.sounds.length;n++)this.sounds[n].stop()},r.prototype.stop=function(){this.isAudioWorking&&(this.playing=!1,this.clearSounds(),this.init())},r.prototype.update=function(){this.isAudioWorking&&(n.Managers.PageManager.Current.page!=n.Managers.Page.Score&&this.playing===!0&&this.stop(),this.playing===!0&&this.playNotes(),this.updateSounds(),this.removeFinishedSounds())},r}();t.AudioService=r})(t=n.Audio||(n.Audio={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(){function i(i){if(this.name=i,this.ID=n.getID(),this.oscillatorType=t.SoundType.sine,!i)throw new Error("A synth must have a name!");}return i.prototype.setInput=function(n){this.input=n},Object.defineProperty(i.prototype,"gain",{get:function(){return this.mixGain?this.mixGain.gain.value:1},set:function(n){this.mixGain&&(this.mixGain.gain.value=n)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"delay",{get:function(){return this.delayNode?this.delayNode.delayTime.value:.1},set:function(n){this.delayNode&&(this.delayNode.delayTime.value=n)},enumerable:!0,configurable:!0}),i.prototype.connectTo=function(n,t){var i,r,u;if(!n)throw Error("must specify node when connecting synth");if(!t)throw Error("must specify audioContext when connecting synth");if(!this.input)throw Error("the input must be set first, before connecting the synth to further items");if(this.connectedTo==n){this.input.connect(this.dryGain);this.input.connect(this.delayNode);return}this.connectedTo=n;i=t.createGain();i.gain.value=.5;this.dryGain=t.createGain();this.delayNode=t.createDelay(1);this.delayNode.delayTime.value=.1;this.mixGain=t.createGain();this.gain&&(this.mixGain.gain.value=this.gain);r=t.createBiquadFilter();u=t.createDynamicsCompressor();this.input.connect(this.dryGain);this.input.connect(this.delayNode);this.delayNode.connect(i);i.connect(this.delayNode);this.dryGain.connect(this.mixGain);i.connect(this.mixGain);this.mixGain.connect(n)},i}();t.Synth=i})(t=n.Audio||(n.Audio={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(){function i(){if(this.synths=[],this.synths=n.Storage.getSynths(),this.synths.length==0){var i=new t.Synth("Standard synth");i.oscillatorType=t.SoundType.sine;i.gain=1;this.synths.push(i)}}return Object.defineProperty(i,"Instance",{get:function(){return i._instance||(i._instance=new i),i._instance},enumerable:!0,configurable:!0}),i.prototype.addSynth=function(n){this.synths.push(n)},i.prototype.getSynths=function(){return this.synths},i.prototype.deleteSynth=function(t,i,r){var u=this;n.check("are you sure you want to delete this synth?",function(){var e=u.getSynth(t,i),f;e&&(f=[],f=n.getItemsWhere(u.synths,function(n){return n!=e}),u.synths=f,r())})},i.prototype.getSynthFromID=function(t){return n.getItemFromID(this.synths,t)},i.prototype.getSynthFromName=function(n){for(var t=0;t<this.synths.length;t++)if(this.synths[t].name==n)return this.synths[t];return null},i.prototype.getSynth=function(n,i){var r=this.getSynthFromID(n),u;return(r||(r=this.getSynthFromName(i)),!r)?(u=new t.Synth(i),this.addSynth(u),u):r},i}();t.SynthManager=i})(t=n.Audio||(n.Audio={}))}(Inknote||(Inknote={})),function(n){var t;(function(n){var t=function(){function t(){}return Object.defineProperty(t,"Instance",{get:function(){return t._instance||(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.setSynth=function(i,r){t.Instance.synth=n.SynthManager.Instance.getSynth(i,r)},t.prototype.changeWaveShape=function(t){this.synth.oscillatorType=n.SoundType[t]},t.prototype.changeGain=function(n){this.synth.gain=n},t.prototype.changeDelay=function(n){this.synth.delay=n},t}();n.SynthService=t})(t=n.Audio||(n.Audio={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=new n.Compressed.CompressedProject("TestCompressed"),r,u;i.ID="42";r=new n.Compressed.Instrument("Violin");u=new n.Compressed.Instrument("Guitar");i.instruments=[r,u];t.$TEST$_compressedProject=i})(t=n.Testing||(n.Testing={}))}(Inknote||(Inknote={})),function(n){var t;(function(n){var t=function(){function n(){this.version="0.1"}return Object.defineProperty(n,"Instance",{get:function(){return n._instance||(n._instance=new n),this._instance},enumerable:!0,configurable:!0}),n}();n.VersionManager=t})(t=n.Managers||(n.Managers={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){typeof screen!="undefined"&&(screen.lockOrientationUniversal=screen.lockOrientation||screen.mozLockOrientation||screen.msLockOrientation,screen.lockOrientationUniversal?screen.lockOrientationUniversal("landscape-primary")||n.log("orientation lock failed in this browser",n.MessageType.Warning):n.log("lockOrientation undefined in this browser",n.MessageType.Warning)),function(n){n[n.Desktop=0]="Desktop";n[n.Tablet=1]="Tablet";n[n.Mobile=2]="Mobile"}(t.MachineType||(t.MachineType={}));var i=t.MachineType,r=function(){function n(){var n=!1;(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(n=!0);this.machineType=n?i.Mobile:i.Desktop}return Object.defineProperty(n,"Instance",{get:function(){return n._instance||(n._instance=new n),n._instance},enumerable:!0,configurable:!0}),n}();t.MachineManager=r})(t=n.Managers||(n.Managers={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){function r(n){switch(n){case i.Score:return"Score";case i.Form:return"Form";case i.File:return"File";case i.List:return"List";case i.Licence:return"Licence";case i.Print:return"Print"}}var i,u;(function(n){n[n.Score=0]="Score";n[n.Form=1]="Form";n[n.File=2]="File";n[n.List=3]="List";n[n.Licence=4]="Licence";n[n.Print=5]="Print"})(t.Page||(t.Page={}));i=t.Page;u=function(){function u(){this.openPageFromURL()}return Object.defineProperty(u.prototype,"page",{get:function(){return this._page},set:function(u){var f="?"+r(u);Menu.isMenuOpen&&Menu.toggle();Menu.closeAllSubMenus();n.RightClickMenuService.Instance.visible=!1;n.ScrollService&&n.ScrollService.Instance&&(n.ScrollService.Instance.x=0,n.ScrollService.Instance.y=0);u==i.Score?(FrontEnd.showElement(document.getElementById("play")),FrontEnd.showElement(document.getElementById("mouse-control"))):(FrontEnd.hideElement(document.getElementById("play")),FrontEnd.hideElement(document.getElementById("mouse-control")),MouseControl.SelectMouseType(0));switch(u){case i.Print:case i.Score:f+="="+t.ProjectManager.Instance.currentProject.ID;break;case i.Licence:window.location.href="./licence";return}window.history.pushState(null,f,f);this._page=u},enumerable:!0,configurable:!0}),Object.defineProperty(u,"Current",{get:function(){return u._current||(u._current=new u),u._current},enumerable:!0,configurable:!0}),u.prototype.openNewPage=function(n,t){var i="?";return console.log(i),i+=r(n),i+="=",i+=t,window.open(i)},u.prototype.openPageFromURL=function(){for(var t,u=window.location.search.replace("?",""),r=u.split("&"),n=0;n<r.length;n++)t=r[n].split("="),i[t[0]]&&(this.page=i[t[0]]);this._page==null&&(this.page=i.Score)},u}();t.PageManager=u})(t=n.Managers||(n.Managers={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(){function t(){this._settings=[];t._instance&&n.log("Error: Instantiation failed. Use SettingsManager.Current() instead of new.");t._instance=this}return Object.defineProperty(t,"Current",{get:function(){return t.Instance.getCurrentSetting()},enumerable:!0,configurable:!0}),t.prototype.getCurrentSetting=function(){var i=t.Instance;return i._currentSetting||((!i._settings||i._settings.length<1)&&i.addSetting(new n.Setting("Default")),i.setCurrentSetting(i.getSettings()[0])),i._currentSetting},t.prototype.setCurrentSetting=function(n){this._currentSetting=n},t.prototype.getSettings=function(){return this._settings},t.prototype.setSettings=function(n){this._settings=n},t.prototype.addSettings=function(n){this._settings=this._settings.concat(n)},t.prototype.addSetting=function(n){this._settings=this._settings.concat(n)},Object.defineProperty(t,"Instance",{get:function(){return this._instance||(this._instance=new t),t._instance},enumerable:!0,configurable:!0}),t}();t.SettingsManager=i})(t=n.Managers||(n.Managers={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(){function i(){this._projects=[]}return i.prototype.addProjects=function(n){this._projects=this._projects.concat(n)},i.prototype.addProject=function(t,i){var r=this,u=n.anyItemIs(this._projects,function(n){return n.ID==t.ID});u?n.check("an item already exists with this ID. Change this project's ID and continue?",function(){t.ID=n.getID();r._projects.push(t);i&&i(t)},function(){return}):(this._projects.push(t),i&&i(t))},i.prototype.setCurrentProject=function(t){this._currentProject=n.getItemFromID(this._projects,t)},Object.defineProperty(i,"Instance",{get:function(){return i._instance||(i._instance=new i),i._instance},enumerable:!0,configurable:!0}),i.prototype.openProjectFromURL=function(){for(var t,r=window.location.search.replace("?",""),i=r.split("&"),n=0;n<i.length;n++)t=i[n].split("="),t[0]=="Score"&&this.setCurrentProject(t[1])},Object.defineProperty(i.prototype,"currentProject",{get:function(){return this._currentProject||(this._currentProject=new n.Project),this._currentProject},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentProjectOverride",{set:function(t){n.log("current project overriden",n.MessageType.Warning);n.log(this._currentProject.ID+" -> "+t.ID,n.MessageType.Error);this._currentProject=t;var i=this,r=n.getFirstItemWhere(this._projects,function(n){return n.ID==i._currentProject.ID}),u=this._projects.indexOf(r);this._projects[u]=t},enumerable:!0,configurable:!0}),i.prototype.save=function(){var t=this,f=n.anyItemIs(this._projects,function(n){return n.ID==t._currentProject.ID}),i,r,u;f===!0?(i=n.getFirstItemWhere(this._projects,function(n){return n.ID==t._currentProject.ID}),r=this._projects.indexOf(i),this._projects[r]=this._currentProject):this._projects.push(this._currentProject);u=n.ProjectConverter.compressAll(this._projects);n.Storage.saveProjects(u)},Object.defineProperty(i.prototype,"allProjects",{get:function(){return this._projects},enumerable:!0,configurable:!0}),i.prototype.deleteSelectedProject=function(){this.deleteProjectByID(this.selectID)},i.prototype.deleteProjectByID=function(t){var r=n.getIndexFromID(this._projects,t),u=n.getItemFromID(this._projects,t),f=u.name,i=this;n.check('Are you sure you want to delete project "'+f+'"',function(){r!=null&&i._projects.splice(r,1);u.ID==i._currentProject.ID&&(i._currentProject=i._projects.length>0?n.last(i._projects):null);setTimeout(function(){i.currentProject.pause=!1},100)},function(){n.log('"'+f+'" deletion cancelled')})},i.prototype.openSelectedProject=function(){this.setCurrentProject(this.selectID);t.PageManager.Current.page=t.Page.Score;t.ProjectManager.Instance._currentProject.pause=!1;this.selectID=null},i.prototype.openProjectFromID=function(n){this.setCurrentProject(n);t.PageManager.Current.page=t.Page.Score;t.ProjectManager.Instance._currentProject.pause=!1;this.selectID=null},i.prototype.next=function(){var t=this._projects,i;if(t.length<2){this.selectID=t[0].ID;return}i=n.getIndexFromID(t,this.selectID);this.selectID=i==t.length-1||i==null?t[0].ID:t[i+1].ID},i.prototype.previous=function(){var t=this._projects,i,r;if(t.length<2){this.selectID=t[0].ID;return}i=n.getIndexFromID(t,this.selectID);i==0||i==null?(r=n.last(t),this.selectID=r.ID):this.selectID=t[i-1].ID},i}();t.ProjectManager=i})(t=n.Managers||(n.Managers={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i=function(){function t(){this._plugins=[];this._pluginNames=[]}return Object.defineProperty(t,"Instance",{get:function(){return t._instance||(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"plugins",{get:function(){return this._plugins},enumerable:!0,configurable:!0}),t.prototype.getCompressedPlugins=function(){for(var i,u,r=this.plugins,f=[],t=0;t<r.length;t++)i=new n.Plugins.Compressed.InknotePlugin(r[t].name),i.ID=r[t].ID,i.active=r[t].active,i.allowOnDraw=r[t].allowOnDraw,i.allowOnSave=r[t].allowOnSave,u=this.findPluginNameByName(r[t].name),i.URL=u.URL,i.description=u.description,f.push(i);return f},t.prototype.addPlugin=function(n){this._plugins.push(n)},Object.defineProperty(t.prototype,"pluginNames",{get:function(){return this._pluginNames},enumerable:!0,configurable:!0}),t.prototype.addPluginName=function(n,t){this._pluginNames.push(n);t!==!0&&this.generatePluginHtml()},t.prototype.addPluginNames=function(n){for(var t in n)this.addPluginName(n[t],!0);this.generatePluginHtml()},t.prototype.removePlugin=function(n){for(var i=[],t=0;t<this._plugins.length;t++)this._plugins[t].ID!=n&&i.push(this._plugins[t]);this._plugins=i},t.prototype.setPluginNameVal=function(t,i){this._pluginNames[t].active=i;this.generatePluginHtml();setTimeout(function(){n.Storage.savePlugins()},200)},t.prototype.generateListHtml=function(){var e=this,o=document.getElementById("plugin-list-items"),f,r,i,u,t;o.innerHTML="";for(f in this._pluginNames)r=this._pluginNames[f],i=document.createElement("div"),i.className="plugin-list-item",u=document.createElement("div"),u.innerText=r.name+" - "+r.description,u.style.display="inline-block",t=document.createElement("input"),t.type="checkbox",t.checked=r.active,t.id="plugin-"+f,t.onclick=function(t){var i=t.target;i.checked?n.check("Are you sure you want this plugin?",function(){e.setPluginNameVal(i.id.split("-")[1],i.checked)},function(){i.checked=!i.checked}):e.setPluginNameVal(i.id.split("-")[1],i.checked)},i.appendChild(t),i.appendChild(u),o.appendChild(i)},t.prototype.getPluginsWithEvents=function(){for(var r,i=n.getItemsWhere(this._plugins,function(n){return n.active}),u=[],t=0;t<i.length;t++)r=i[t].getExistingFunctions(),r.length>0&&u.push({name:i[t].name,functions:r});return u},t.prototype.getPluginsByEvents=function(){for(var n,i,f,e,r,o,t=[],s=this.getPluginsWithEvents(),u=0;u<s.length;u++)for(n=s[u],i=0;i<n.functions.length;i++){for(f=n.functions[i],e=!1,r=0;r<t.length;r++)o=t[r],o.event==f&&(o.plugins.push(n.name),e=!0);e==!1&&t.push({event:f,plugins:[n.name]})}return t},t.prototype.setPluginOnSaveAllow=function(t,i){var r=t.split("...")[1],u=this.findPluginByName(r);u.allowOnSave=i;setTimeout(function(){n.Storage.savePlugins()},200)},t.prototype.setPluginOnDrawAllow=function(t,i){var r=t.split("...")[1],u=this.findPluginByName(r);u.allowOnDraw=i;setTimeout(function(){n.Storage.savePlugins()},200)},t.prototype.setPluginOnBeforeDrawAllow=function(t,i){var r=t.split("...")[1],u=this.findPluginByName(r);u.allowBeforeDraw=i;setTimeout(function(){n.Storage.savePlugins()},200)},t.prototype.generateEventListHtml=function(){var e=this,o=this.getPluginsByEvents(),s=document.getElementById("plugin-event-list"),r,l,u,t,n,i,f,a;for(s.innerHTML="<h3>Events<\/h3>",r=0;r<o.length;r++){var v=o[r].event,h=o[r].plugins,c=document.createElement("div");for(c.innerText=v,c.className="plugin-list-item",s.appendChild(c),l=document.createElement("div"),u=0;u<h.length;u++)if(t=this.findPluginByName(h[u]),t!=null){n=document.createElement("input");n.type="checkbox";switch(v){case"before draw":n.checked=t.allowBeforeDraw;i=t.name;n.id="ondraw..."+i;n.onclick=function(n){var t=n.target;e.setPluginOnBeforeDrawAllow(t.id,t.checked)};break;case"on draw":n.checked=t.allowOnDraw;i=t.name;n.id="ondraw..."+i;n.onclick=function(n){var t=n.target;e.setPluginOnDrawAllow(t.id,t.checked)};break;case"on save":n.checked=t.allowOnSave;i=t.name;n.id="onsave..."+i;n.onclick=function(n){var t=n.target;e.setPluginOnSaveAllow(t.id,t.checked)}}f=document.createElement("div");f.appendChild(n);a=document.createElement("span");a.innerText=h[u];f.appendChild(a);l.appendChild(f)}s.appendChild(l)}},t.prototype.generateAdvancedHtml=function(){},t.prototype.generatePluginHtml=function(){typeof document!="undefined"&&(this.generateListHtml(),this.generateEventListHtml(),this.generateAdvancedHtml())},t.prototype.findPluginByName=function(t){var i=n.getItemsWhere(this._plugins,function(n){return n.name==t});return i.length==0?null:i[0]},t.prototype.findPluginNameByName=function(t){var i=n.getItemsWhere(this._pluginNames,function(n){return n.name==t});return i.length==0?null:i[0]},t}();t.PluginManager=i})(t=n.Managers||(n.Managers={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){(function(n){n[n.NORMAL=0]="NORMAL";n[n.PENCIL=1]="PENCIL";n[n.TEXT=2]="TEXT"})(t.MouseType||(t.MouseType={}));var i=t.MouseType,r=function(){function t(){this._currentMouse=i.NORMAL}return Object.defineProperty(t,"Instance",{get:function(){return t._instance||(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentMouse",{get:function(){return this._currentMouse},set:function(t){t==i.PENCIL?(n.DrawService.Instance.canvas.className=n.DrawService.Instance.canvas.className.replace(/textMode/g,""),n.DrawService.Instance.canvas.className.indexOf("pencilMode")==-1&&(n.DrawService.Instance.canvas.className+=" pencilMode")):t==i.TEXT?(n.DrawService.Instance.canvas.className=n.DrawService.Instance.canvas.className.replace(/pencilMode/g,""),n.DrawService.Instance.canvas.className.indexOf("textMode")==-1&&(n.DrawService.Instance.canvas.className+=" textMode")):n.DrawService.Instance.canvas.className=n.DrawService.Instance.canvas.className.replace(/pencilMode/g,"").replace(/textMode/g,"");this._currentMouse=t},enumerable:!0,configurable:!0}),t}();t.MouseManager=r})(t=n.Managers||(n.Managers={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t){this.name=t;this.ID=n.getID();this.allowOnSave=!0;this.allowOnDraw=!0}return t}();t.InknotePlugin=i})(i=t.Compressed||(t.Compressed={}))})(t=n.Plugins||(n.Plugins={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){var r=function(){function t(n,t,i){this.name=n;this.URL=t;this.description=i;this._active=!1;this.hasOpenedURL=!1}return Object.defineProperty(t.prototype,"active",{get:function(){return this._active},set:function(t){var r,i,u;this.hasOpenedURL?(r=n.Managers.PluginManager.Instance.findPluginByName(this.name),r.active=t,n.Managers.PluginManager.Instance.generatePluginHtml()):(i=document.createElement("script"),i.src=this.URL,i.onload=function(){return n.Managers.PluginManager.Instance.generatePluginHtml(),!1},u=document.getElementsByTagName("head")[0],u.appendChild(i),this.hasOpenedURL=!0);this._active=t},enumerable:!0,configurable:!0}),t}(),i;t.InknotePluginName=r;i=function(){function t(t){this.name=t;this.ID=n.getID();this._active=!0;this.allowOnSave=!0;this.allowBeforeDraw=!0;this.allowOnDraw=!0;var i=n.Managers.PluginManager.Instance.findPluginNameByName(t);i?(i.allowOnDraw!=null&&(this.allowOnDraw=i.allowOnDraw),i.allowOnSave!=null&&(this.allowOnSave=i.allowOnSave),i.allowBeforeDraw!=null&&(this.allowBeforeDraw=i.allowBeforeDraw),this.active=i.active):this.active=!1}return Object.defineProperty(t.prototype,"active",{get:function(){return this._active},set:function(n){this._active=n;n&&(this.allowOnDraw=!0,this.allowOnSave=!0,this.allowBeforeDraw=!0)},enumerable:!0,configurable:!0}),t.prototype.getExistingFunctions=function(){var n=[];return this.onSave&&n.push("on save"),this.onDraw&&n.push("on draw"),this.beforeDraw&&n.push("before draw"),n},t}();t.InknotePlugin=i})(t=n.Plugins||(n.Plugins={}))}(Inknote||(Inknote={})),function(n){var t;(function(t){function h(n){return new t.InknotePluginName(n.name,n.URL,n.description)}var s=[new t.InknotePluginName("snow background","./scripts/plugins/instances/snow-back.js","covers the background with snow"),new t.InknotePluginName("plugin2","./scripts/plugins/instances/plugin2.js","testing on draw"),new t.InknotePluginName("data storage","./scripts/plugins/instances/data-storage.js","testing on save")],r,i,f,o,u,e;for(n.Managers.PluginManager.Instance.addPluginNames(s),r=n.Storage.getPlugins(),i=0;i<r.length;i++)f=h(r[i]),o=n.Managers.PluginManager.Instance.findPluginNameByName(f.name),o||n.Managers.PluginManager.Instance.addPluginName(f),u=n.Managers.PluginManager.Instance.findPluginNameByName(r[i].name),e=r[i],u.active=r[i].active,u.allowOnDraw=e.allowOnDraw,u.allowOnSave=e.allowOnSave;typeof document!="undefined"&&setTimeout(function(){n.Managers.PluginManager.Instance.generatePluginHtml()},300)})(t=n.Plugins||(n.Plugins={}))}(Inknote||(Inknote={})),function(n){function i(i,o){n.ScrollService.Instance.x=0;n.ScrollService.Instance.y=0;n.Managers.ProjectManager.Instance.currentProject.pause=!0;n.Managers.ProjectManager.Instance.selectID="";switch(i){case t.NewProject:r();break;case t.OpenProject:u();break;case t.SaveProject:f();break;case t.ToPage:o||(o=n.Managers.Page.Score);e(o);break;default:n.log("Unknown action type",n.MessageType.Error)}setTimeout(function(){n.Managers.ProjectManager.Instance.currentProject.pause=!1},100)}function r(){var t=new n.Project("Untitled");n.Managers.ProjectManager.Instance.addProject(t,function(t){n.Managers.ProjectManager.Instance.setCurrentProject(t.ID);n.Managers.PageManager.Current.page=n.Managers.Page.Score;n.Managers.ProjectManager.Instance.currentProject.pause=!0})}function u(){n.Managers.PageManager.Current.page=n.Managers.Page.File}function f(){n.Managers.ProjectManager.Instance.save();n.Storage.saveSynths()}function e(t){n.Managers.PageManager.Current.page=t}(function(n){n[n.NewProject=0]="NewProject";n[n.OpenProject=1]="OpenProject";n[n.SaveProject=2]="SaveProject";n[n.ToPage=3]="ToPage"})(n.ActionType||(n.ActionType={}));var t=n.ActionType;n.Action=i}(Inknote||(Inknote={})),function(n){function i(n){return new t(n.identifier,n.pageX,n.pageY)}var t=function(){function n(n,t,i){this.identifier=n;this.pageX=t;this.pageY=i}return n}(),r=function(){function t(t){this.drawService=t;this.touchCopies=[];var i=this;this.drawService.canvas.onmouseover=function(){i.drawService.canvas.onmousemove=function(n){i.hover(n)}};this.drawService.canvas.onmouseout=function(){i.drawService.canvas.onmousemove=null};this.drawService.canvas.onclick=function(t){n.Managers.MachineManager.Instance.machineType==n.Managers.MachineType.Desktop&&i.click(t)};this.drawService.canvas.ondblclick=function(n){i.dblClick(n)};this.drawService.canvas.onmousedown=function(n){i.mouseDown(n,t)};this.drawService.canvas.oncontextmenu=function(n){i.rightClick(n)};this.drawService.canvas.addEventListener("touchstart",function(n){i.touchStart(n,i.drawService);var t=n.touches[0];i.click(t)},!1)}return t.prototype.hover=function(t){var i,o,u;if(n.Managers.MouseManager.Instance.currentMouse!=n.Managers.MouseType.PENCIL&&n.Managers.MouseManager.Instance.currentMouse!==n.Managers.MouseType.TEXT){var r=this.drawService.items,f=!1,e=[];for(i=0;i<r.length;i++)n.mouseIsOver(r[i],t,this.drawService.canvas)&&(n.Managers.PageManager.Current.page==n.Managers.Page.Score&&r[i]instanceof n.Notation&&e.push(r[i]),o=r[i].ID,n.Managers.ProjectManager.Instance.hoverID=o,f=!0,this.drawService.canvas.style.cursor="url('../assets/pointer.png'), pointer");u=e.sort(function(n,t){return t.order-n.order});n.ScoringService.Instance.hoverID=u.length>0?u[0].ID:null;f||(n.Managers.ProjectManager.Instance.hoverID=null,this.drawService.canvas.style.cursor="")}},t.prototype.pencilClick=function(t){var r=n.ScoringService.Instance.getItems(),u=n.getItemsWhere(r,function(t){return t instanceof n.Drawing.Bar}),i=n.getFirstItemWhere(u,function(n){return n.isOver(t.clientX,t.clientY-50)});i&&n.NoteControlService.Instance.addNoteToBar(t.clientY-50-i.y,i.ID);i||n.log("the pencil can only be used to place notes within a bar")},t.prototype.textClick=function(t){for(var r,u,o,h,s,c=n.ScoringService.Instance.getItems(),l=n.getItemsWhere(c,function(t){return t instanceof n.Drawing.Note}),a=n.getItemWithMin(l,function(i){return n.Maths.pythagoras(t.clientX-i.x,t.clientY-50-i.y)}),e=new n.Model.Text("add text"),f=n.Managers.ProjectManager.Instance.currentProject,i=0;i<f.instruments.length;i++)for(r=0;r<f.instruments[i].bars.length;r++)for(u=0;u<f.instruments[i].bars[r].items.length;u++)if(o=f.instruments[i].bars[r],h=o.items[u],h.ID==a.ID){if(s=prompt("text to be added:",e.content),s==null){n.log("adding text cancelled",n.MessageType.Warning);return}e.content=s;o.items.splice(u+1,0,e);n.ScoringService.Instance.refresh();return}n.log("text click not registered",n.MessageType.Error)},t.prototype.click=function(t){var i,r,f;if(n.Managers.MouseManager.Instance.currentMouse==n.Managers.MouseType.PENCIL){this.pencilClick(t);return}if(n.Managers.MouseManager.Instance.currentMouse==n.Managers.MouseType.TEXT){this.textClick(t);return}var e=this.drawService.items,o=!1,s=[],u=[];for(i=0;i<e.length;i++)u.push(e[i]);for(u.sort(function(n,t){return t.order-n.order}),i=0;i<u.length;i++)if(n.mouseIsOver(u[i],t,this.drawService.canvas)){if(r=u[i].ID,r==n.RightClickMenuService.Instance.Menu.ID){n.RightClickMenuService.Instance.Menu.click(t);n.RightClickMenuService.Instance.visible=!1;return}if(r==n.NoteControlService.Instance.ID){t.clientY-50>n.NoteControlService.Instance.piano.y?n.NoteControlService.Instance.piano.click(t):t.clientY-50<n.NoteControlService.Instance.y?n.NoteControlService.Instance.minimise.click(t):n.NoteControlService.Instance.restControl.isOver(t.clientX,t.clientY-50)?n.NoteControlService.Instance.restControl.click(t):n.NoteControlService.Instance.deleteNoteControl.isOver(t.clientX,t.clientY-50)?n.NoteControlService.Instance.deleteNoteControl.click(t):n.NoteControlService.Instance.lengthControl.click(t);return}if(r===n.Drawing.Keyboard.Instance.ID){n.Drawing.Keyboard.Instance.click(t);return}if(r===n.Drawing.BottomMenu.Instance.ID){n.Drawing.BottomMenu.Instance.click(t);return}if(r===n.ScrollService.ScrollBar.ID){n.ScrollService.ScrollBar.click(t);return}if(r===n.ScrollService.ScrollBar.scrollThumbnail.ID){n.ScrollService.ScrollBar.scrollThumbnail.click(t);return}if(r===n.LicenceService.Instance.drawing.ID){n.LicenceService.Instance.drawing.click(t);return}n.Managers.PageManager.Current.page==n.Managers.Page.Score&&u[i]instanceof n.Notation&&s.push(u[i]);n.Managers.ProjectManager.Instance.selectID=r;o=!0}f=s.sort(function(n,t){return t.order-n.order});n.ScoringService.Instance.selectID=f.length>0?f[0].ID:null;o||(n.ScrollService.ScrollBar.scrollThumbnail.visible=!1,n.Managers.ProjectManager.Instance.selectID=null,n.RightClickMenuService.Instance.visible=!1)},t.prototype.dblClick=function(){n.Managers.PageManager.Current.page==n.Managers.Page.File&&n.Managers.ProjectManager.Instance.selectID&&n.Managers.ProjectManager.Instance.openSelectedProject()},t.prototype.mouseDown=function(t,i){var r=function(t){(t.movementY>0&&n.canScroll(!0)||t.movementY<0&&n.canScroll(!1))&&(n.ScrollService.Instance.y-=t.movementY);i.canvas.style.cursor="url('../assets/grabbing.png'), -webkit-grabbing"};i.canvas.addEventListener("mousemove",r,!1);i.canvas.onmouseup=function(){i.canvas.removeEventListener("mousemove",r,!1);i.canvas.style.cursor=""};i.canvas.onmouseout=function(){i.canvas.removeEventListener("mousemove",r,!1);i.canvas.style.cursor=""}},t.prototype.getTouchCopyByID=function(n){for(var t=0;t<this.touchCopies.length;t++)if(this.touchCopies[t].identifier==n)return this.touchCopies[t];return null},t.prototype.touchStart=function(t,r){var e=t.touches,u,o,f;for(this.touchCopies=[],u=0;u<e.length;u++)this.touchCopies.push(i(e[u]));o=this;f=function(t){for(var e=t.changedTouches,u=0;u<e.length;u++){var i=e[u],r=o.getTouchCopyByID(i.identifier),s=i.pageX-r.pageX,f=i.pageY-r.pageY;(f>0&&n.canScroll(!0)||f<0&&n.canScroll(!1))&&(n.ScrollService.Instance.y-=f);r.pageX=i.pageX;r.pageY=i.pageY}};r.canvas.addEventListener("touchmove",f,!1);r.canvas.addEventListener("touchend",function(){r.canvas.removeEventListener("touchmove",f,!1)},!1);r.canvas.addEventListener("touchleave",function(){r.canvas.removeEventListener("touchmove",f,!1)},!1)},t.prototype.rightClick=function(t){n.RightClickMenuService.Instance.openMenu(t.clientX,t.clientY-50,this.drawService.canvas);t.preventDefault()},t}();n.CanvasControl=r}(Inknote||(Inknote={})),function(n){typeof window!="undefined"&&(window.onmousewheel=function(t){if(Modal.isModalOpen!==!0){var i=!1;t.wheelDelta>0&&(i=!0);i?n.ScrollService.Instance.up():n.ScrollService.Instance.down()}})}(Inknote||(Inknote={})),function(n){function i(t){var u=n.Managers.ProjectManager.Instance,r=u.currentProject,i=null;if(!n.ProjectConverter.name.select)switch(t.keyCode){case 65:i=n.Model.NoteValue.C;break;case 87:i=n.Model.NoteValue.Db;break;case 83:i=n.Model.NoteValue.D;break;case 69:i=n.Model.NoteValue.Eb;break;case 68:i=n.Model.NoteValue.E;break;case 70:i=n.Model.NoteValue.F;break;case 84:i=n.Model.NoteValue.Gb;break;case 71:i=n.Model.NoteValue.G;break;case 89:i=n.Model.NoteValue.Ab;break;case 72:i=n.Model.NoteValue.A;break;case 85:i=n.Model.NoteValue.Bb;break;case 74:i=n.Model.NoteValue.B;break;case 37:n.ScoringService.Instance.cursorLeft();break;case 39:n.ScoringService.Instance.cursorRight();break;case 38:n.NoteControlService.Instance.noteValueUp();break;case 40:n.NoteControlService.Instance.noteValueDown();break;case 46:n.NoteControlService.Instance.deleteSelected();break;case 32:n.Audio.AudioService.Instance.toggle();break;case 188:case 219:n.NoteControlService.Instance.piano.octave--;break;case 190:case 221:n.NoteControlService.Instance.piano.octave++;break;default:n.log("key pressed: "+t.keyCode)}if(i!=null&&(n.ScoringService.Instance.selectID==null||n.ScoringService.Instance.SelectedItem instanceof n.Drawing.Bar?n.NoteControlService.Instance.addNote(new n.Model.Note(i,n.NoteControlService.Instance.piano.octave,n.NoteControlService.Instance.lengthControl.selectedLength)):n.NoteControlService.Instance.editNoteValueAndOctave(i,n.NoteControlService.Instance.piano.octave)),n.ScoringService.Instance.SelectedItem instanceof n.Drawing.Clef)switch(t.keyCode){case 38:n.NoteControlService.Instance.editCurrentClef(!0);break;case 40:n.NoteControlService.Instance.editCurrentClef(!1)}if(u.selectID==r.ID){t.keyCode==13?u.selectID=null:n.countWhere([16,17,18,20],function(n){return n==t.keyCode})>0||(r.name=t.keyCode==8?r.name.substr(0,r.name.length-1):t.keyCode==46?"":n.pascalCase(r.name+String.fromCharCode(t.keyCode)));t.preventDefault();return}t.preventDefault();switch(t.keyCode){case 77:Menu.toggle();return;case 78:n.Action(n.ActionType.NewProject,n.Managers.Page.Score);return}}function r(t){var i=n.Managers.ProjectManager.Instance,r=i.currentProject;t.keyCode==13?i.openSelectedProject():t.keyCode==38?n.ScrollService.Instance.up():t.keyCode==40?n.ScrollService.Instance.down():t.keyCode==37?i.previous():t.keyCode==39?i.next():t.keyCode==46&&i.deleteSelectedProject();switch(t.keyCode){case 77:Menu.toggle();return;case 78:n.Action(n.ActionType.NewProject,n.Managers.Page.Score);return}}var t=[];typeof document!="undefined"&&typeof window!="undefined"&&(document.onkeydown=function(i){(t.push(i.keyCode),n.CONFIRM_IS_OPEN)||Modal.isModalOpen!==!0&&(n.anyItemIs(t,function(n){return n==17})&&(i.keyCode==67&&n.ClipboardService.Instance.copy(),i.keyCode==86&&n.ClipboardService.Instance.paste(),i.keyCode==88&&n.ClipboardService.Instance.cut(),i.keyCode==90&&n.UndoService.Instance.undo(),i.keyCode==83&&(n.Action(n.ActionType.SaveProject),i.preventDefault()),i.keyCode==80&&(n.PrintService.Instance.print(),i.preventDefault())),i.keyCode==8&&i.preventDefault())},window.onkeyup=function(u){if((t=n.getItemsWhere(t,function(n){return n!=u.keyCode}),!n.anyItemIs(t,function(n){return n==17}))&&!n.CONFIRM_IS_OPEN&&Modal.isModalOpen!==!0)switch(n.Managers.PageManager.Current.page){case n.Managers.Page.File:r(u);break;case n.Managers.Page.Score:i(u)}})}(Inknote||(Inknote={})),function(n){function r(n){var r=n.className,u=r.indexOf("hidden")!=-1;u?i(n):t(n)}function t(n){var t=n.className,i=t.indexOf("hidden")!=-1;i||(n.className=n.className.trim(),n.className=n.className+" hidden")}function i(n){var t=n.className,i=t.indexOf("hidden")!=-1;i&&(n.className=n.className.replace(/hidden/g,""))}function u(n){var t=n.className,i=t.indexOf("select")!=-1;i&&(n.className=n.className.replace(/select/g,""))}function f(n){var t=n.className,i=t.indexOf("select")!=-1;i||(n.className=n.className+" select")}function e(n,t){var i=n.className,r=i.indexOf(t)!=-1;r||(n.className=n.className+" "+t)}function o(n,t){var i=n.className,r=i.indexOf(t)!=-1;r&&(n.className=n.className.replace(t,""))}function s(n,t){var i=n.className,r=i.indexOf(t)!=-1;n.className=r?n.className.replace(t,""):n.className+" "+t}n.toggleElement=r;n.hideElement=t;n.showElement=i;n.deSelect=u;n.select=f;n.addClass=e;n.removeClass=o;n.toggleClass=s}(FrontEnd||(FrontEnd={})),function(n){function r(){for(var t=0;t<n.scoreItems.length;t++)Inknote.Managers.PageManager.Current.page==Inknote.Managers.Page.Score?FrontEnd.showElement(n.scoreItems[t]):FrontEnd.hideElement(n.scoreItems[t]);for(t=0;t<n.desktopItems.length;t++)Inknote.Managers.MachineManager.Instance.machineType==Inknote.Managers.MachineType.Desktop?FrontEnd.showElement(n.desktopItems[t]):FrontEnd.hideElement(n.desktopItems[t])}function f(){n.isMenuOpen||u();n.isMenuOpen=!n.isMenuOpen;r();FrontEnd.toggleClass(t,"open");FrontEnd.toggleClass(i,"open")}function u(n){var i,t;if(!n||n.currentTarget==n.target)for(i=document.getElementsByClassName("sub-menu"),t=0;t<i.length;t++)FrontEnd.removeClass(i[t],"open")}function e(n){FrontEnd.addClass(document.getElementById(n),"open")}function o(n){FrontEnd.removeClass(i,"open");FrontEnd.removeClass(t,"open");FrontEnd.removeClass(document.getElementById(n),"open")}n.isMenuOpen=!1;var t,i;typeof window!=typeof undefined&&(n.scoreItems=document.getElementsByClassName("score-item"),n.desktopItems=document.getElementsByClassName("desktop-item"),t=document.getElementsByClassName("menu-button")[0],i=document.getElementById("main-menu"));n.updateMenuItems=r;n.toggle=f;n.closeAllSubMenus=u;n.openSubMenu=e;n.closeSubMenu=o}(Menu||(Menu={})),function(n){function r(t){var i=document.getElementById(t);n.isModalOpen=!n.isModalOpen;FrontEnd.toggleElement(i);FrontEnd.toggleElement(document.getElementById("modal-cover"))}function u(){for(var i=document.getElementsByClassName("modal"),t=0;t<i.length;t++)i[t].className.indexOf("hidden")==-1&&FrontEnd.hideElement(i[t]);n.isModalOpen=!1;FrontEnd.hideElement(document.getElementById("modal-cover"))}function t(t){var i=document.getElementById(t);n.isModalOpen=!1;FrontEnd.hideElement(i);FrontEnd.hideElement(document.getElementById("modal-cover"))}function f(t){var i=document.getElementById(t);n.isModalOpen=!0;FrontEnd.showElement(i);FrontEnd.showElement(document.getElementById("modal-cover"))}function i(){var n=document.getElementById("report-text"),i=document.getElementById("report-checkbox");n.value="";i.checked=!1;t("report")}function e(){var r=document.getElementById("report-text"),u=document.getElementById("report-checkbox"),f=r.value,e=u.checked;if(!e){Inknote.log("a robot is trying to submit a bug report",Inknote.MessageType.Warning);return}if(!f){Inknote.check("You cannot send a bug report without a description. Please try again.",function(){},function(){i()});return}var n=Inknote.getID(),o={id:n,subject:"Bug: #"+n,posts:[]},s={user:"Anonymous",threadID:n,message:f,time:(new Date).toISOString().replace(/T/," ").replace(/\..+/,"")},h=JSON.stringify(o),c=JSON.stringify(s);Inknote.HttpService.Instance.post(Inknote.Managers.SettingsManager.Current.serverURL+"/threads",h,function(){Inknote.log("bug report thread created",Inknote.MessageType.Text);Inknote.HttpService.Instance.post(Inknote.Managers.SettingsManager.Current.serverURL+"/posts",c,function(){Inknote.log("bug report submitted",Inknote.MessageType.Text)},function(){Inknote.log("sending bug report failed",Inknote.MessageType.Error)})},function(){Inknote.log("failed to create thread",Inknote.MessageType.Error)});r.value="";u.checked=!1;t("report")}function o(){var e=Inknote.Managers.ProjectManager.Instance.currentProject,o=document.getElementById("project-report-details"),p,h,c,r,s,l,u,a,v,w,t,b,f,y,i;for(o.innerHTML="",p=document.createElement("h2"),p.textContent=e.name+" report",o.appendChild(p),h=document.createElement("div"),h.className="form-row",h.textContent="bars: "+e.instruments[0].bars.length,o.appendChild(h),c=0,r=[],t=0;t<12;t++)r.push({count:0});for(t=0;t<e.instruments.length;t++)for(s=0;s<e.instruments[t].bars.length;s++)for(l=0;l<e.instruments[t].bars[s].items.length;l++)if(u=e.instruments[t].bars[s].items[l],u instanceof Inknote.Model.Note)c++,r[u.value].count++;else if(u instanceof Inknote.Model.Chord)for(c+=u.notes.length,a=0;a<u.notes.length;a++)r[u.notes[a].value].count++;for(v=document.createElement("div"),v.className="form-row",v.textContent="notes: "+c,o.appendChild(v),w=Inknote.maxOutOf(r,function(n){return n.count}),t=0;t<12;t++)b=Inknote.Model.GetNoteNameFromNoteValue(t)+": "+r[t].count,f=document.createElement("div"),f.className="form-row",f.style.clear="both",f.style.background="rgba(190,190,190,0.1)",o.appendChild(f),y=document.createElement("span"),y.style.display="inline-block",y.textContent=b,f.appendChild(y),i=document.createElement("span"),i.style.display="inline-block",i.style.height="18px",i.style.width=Math.round(200*r[t].count/w)+"px",i.style.background="red",i.style.position="absolute",i.style.right="0",f.appendChild(i);n.show("project-report")}n.isModalOpen=!1;n.toggle=r;n.hideAllModals=u;n.hide=t;n.show=f;n.cancelReport=i;n.submitReport=e;n.generateProjectReport=o}(Modal||(Modal={})),function(n){var t;(function(){var t,n;if(typeof window!=typeof undefined)for(t=document.getElementsByName("logLevel"),n=0;n<t.length;n++)t[n].value==Inknote.TempDataService.Instance.currentData.loggingLevel+""&&(t[n].checked=!0),t[n].onclick=function(n){var t=n.target;Inknote.TempDataService.Instance.currentData.loggingLevel=parseInt(t.value);Inknote.TempDataService.Instance.update()}})(t=n.SettingsModal||(n.SettingsModal={}))}(Modal||(Modal={})),function(n){var t;(function(n){function t(n,t){for(var f,e,o=n,r=document.getElementsByClassName("plugin-menu-item"),u=["plugin-list","plugin-event-list","plugin-advanced"],i=0;i<r.length;i++)FrontEnd.deSelect(r[i]);for(i=0;i<u.length;i++)f=document.getElementById(u[i]),FrontEnd.hideElement(f);e=document.getElementById(t);FrontEnd.showElement(e);FrontEnd.select(o)}n.PluginMenuClick=t})(t=n.Plugins||(n.Plugins={}))}(Actions||(Actions={})),function(n){function f(){var n=Inknote.Audio.SynthService.Instance.synth,r=document.getElementById("synth-wave-shape"),t,i;r.value=Inknote.Audio.getSoundType(n.oscillatorType);t=document.getElementById("synth-gain");t.valueAsNumber=n.gain;i=document.getElementById("synth-delay");i.valueAsNumber=n.delay}function t(){var i=Inknote.Audio.SynthManager.Instance.getSynths(),s=document.getElementById("synth-list"),t,r,e,o,u,f;for(s.innerHTML="",t=0;t<i.length;t++)r=document.createElement("div"),r.className="form-row",e=document.createElement("span"),e.textContent=i[t].ID,e.className="list-column",r.appendChild(e),o=document.createElement("span"),o.textContent=i[t].name,o.className="list-column",r.appendChild(o),u=document.createElement("div"),u.className="button",u.textContent="edit",u.setAttribute("data-id",i[t].ID),u.setAttribute("data-name",i[t].name),u.onclick=function(t){var i=t.target,r=i.getAttribute("data-id"),u=i.getAttribute("data-name");Inknote.Audio.SynthService.setSynth(r,u);n.getSynthValues();Modal.toggle("synth");Modal.toggle("synth-edit")},r.appendChild(u),f=document.createElement("div"),f.className="button negative",f.textContent="x",f.setAttribute("data-id",i[t].ID),f.setAttribute("data-name",i[t].name),f.onclick=function(t){var i=t.target,r=i.getAttribute("data-id"),u=i.getAttribute("data-name");Inknote.Audio.SynthManager.Instance.deleteSynth(r,u,function(){n.loadSynthData()})},r.appendChild(f),s.appendChild(r)}function e(){var r=prompt("What is the name of your new synth?"),i=new Inknote.Audio.Synth(r);Inknote.Audio.SynthManager.Instance.addSynth(i);t();Inknote.Audio.SynthService.setSynth(i.ID,i.name);n.getSynthValues();Modal.toggle("synth");Modal.toggle("synth-edit")}var i,r,u;n.getSynthValues=f;n.loadSynthData=t;n.addSynth=e;typeof window!=typeof undefined&&(i=document.getElementById("synth-wave-shape"),i.onchange=function(n){var t=n.target,i=t.value;Inknote.Audio.SynthService.Instance.changeWaveShape(i)},r=document.getElementById("synth-gain"),r.onchange=function(n){var t=n.target,i=t.valueAsNumber;Inknote.Audio.SynthService.Instance.changeGain(i)},u=document.getElementById("synth-delay"),u.onchange=function(n){var t=n.target,i=t.valueAsNumber;Inknote.Audio.SynthService.Instance.changeDelay(i)},t())}(SynthBindings||(SynthBindings={})),function(n){function r(n){for(var i=document.getElementsByClassName("mouse-option"),t=0;t<i.length;t++)FrontEnd.deSelect(i[t]),parseInt(i[t].getAttribute("data-val"))==n&&FrontEnd.select(i[t]);Inknote.Managers.MouseManager.Instance.currentMouse=n}var i,t;if(n.SelectMouseType=r,typeof window!=typeof undefined)for(i=document.getElementsByClassName("mouse-option"),t=0;t<i.length;t++)i[t].onclick=function(t){var i=t.target,r=parseInt(i.getAttribute("data-val"));n.SelectMouseType(r)}}(MouseControl||(MouseControl={})),function(n){typeof window!="undefined"&&(window.onresize=function(){n.ScoringService.Instance.refresh();n.ScoringService.Instance.maxScrollPosition<n.ScrollService.Instance.y&&(n.ScrollService.Instance.y=n.ScoringService.Instance.maxScrollPosition-100)})}(Inknote||(Inknote={})),function(n){var t;(function(t){var i,r,e;if(typeof document!="undefined"){i=n.Managers.SettingsManager.Instance;r=new n.Setting("Default");i.addSetting(r);i.addSettings(n.Storage.getSettings());var o=n.DrawingSettings.Instance,u=n.Managers.ProjectManager.Instance,f=n.ProjectConverter.decompressAll(n.Storage.getProjects());u.addProjects(f);u.openProjectFromURL();t.x=new n.DrawService("my-canvas");e=new n.CanvasControl(t.x)}})(t=n.Main||(n.Main={}))}(Inknote||(Inknote={}));typeof window!="undefined"&&(Inknote.Managers.SettingsManager.Current.testMode?(console.log("%cWARNING","color: white; border: 1px solid black; font-size: 40px; padding: 0 10px; background: red; text-shadow: 1px 1px 0 black;"),console.log("%cthis app is running in test mode","font-size: 15px; font-family: 'Courier New'")):(console.log("%cWARNING","color: white; border: 1px solid black; font-size: 40px; padding: 0 10px; background: red; text-shadow: 1px 1px 0 black;"),console.log("%cthis is the developer console","font-size: 15px; font-family: 'Courier New'"),console.log("%conly use this if you know what you are doing","font-size: 15px; font-family: 'Courier New'")));
//# sourceMappingURL=@script.min.js.map
